(self.webpackChunkmy_recake=self.webpackChunkmy_recake||[]).push([[713],{2051:function(t,e){var n,r;void 0===(r="function"==typeof(n=function(){"use strict";function e(t,e,n){var r=new XMLHttpRequest;r.open("GET",t),r.responseType="blob",r.onload=function(){a(r.response,e,n)},r.onerror=function(){console.error("could not download file")},r.send()}function n(t){var e=new XMLHttpRequest;e.open("HEAD",t,!1);try{e.send()}catch(t){}return 200<=e.status&&299>=e.status}function r(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(e){var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(n)}}var i="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,o=i.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),a=i.saveAs||("object"!=typeof window||window!==i?function(){}:"download"in HTMLAnchorElement.prototype&&!o?function(t,o,a){var s=i.URL||i.webkitURL,u=document.createElement("a");u.download=o=o||t.name||"download",u.rel="noopener","string"==typeof t?(u.href=t,u.origin===location.origin?r(u):n(u.href)?e(t,o,a):r(u,u.target="_blank")):(u.href=s.createObjectURL(t),setTimeout(function(){s.revokeObjectURL(u.href)},4e4),setTimeout(function(){r(u)},0))}:"msSaveOrOpenBlob"in navigator?function(t,i,o){if(i=i||t.name||"download","string"!=typeof t)navigator.msSaveOrOpenBlob(function(t,e){return void 0===e?e={autoBom:!1}:"object"!=typeof e&&(console.warn("Deprecated: Expected third argument to be a object"),e={autoBom:!e}),e.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob(["\ufeff",t],{type:t.type}):t}(t,o),i);else if(n(t))e(t,i,o);else{var a=document.createElement("a");a.href=t,a.target="_blank",setTimeout(function(){r(a)})}}:function(t,n,r,a){if((a=a||open("","_blank"))&&(a.document.title=a.document.body.innerText="downloading..."),"string"==typeof t)return e(t,n,r);var s="application/octet-stream"===t.type,u=/constructor/i.test(i.HTMLElement)||i.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||s&&u||o)&&"undefined"!=typeof FileReader){var h=new FileReader;h.onloadend=function(){var t=h.result;t=c?t:t.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=t:location=t,a=null},h.readAsDataURL(t)}else{var l=i.URL||i.webkitURL,f=l.createObjectURL(t);a?a.location=f:location.href=f,a=null,setTimeout(function(){l.revokeObjectURL(f)},4e4)}});i.saveAs=a.saveAs=a,t.exports=a})?n.apply(e,[]):n)||(t.exports=r)},7713:(t,e,n)=>{"use strict";n.r(e),n.d(e,{AdminModule:()=>xp});var r=n(1116),i=n(5366),o=n(766),a=n(7112),s=n(4369),u=n(7307),c=n(168),h=n(667),l=n(7064);let f=(()=>{class t{constructor(t){this.router=t,this.loading=!0}ngOnInit(){}logout(){confirm("Keluar aplikasi?")&&(localStorage.removeItem("appToken"),this.router.navigate(["/login"]))}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(o.F0))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-admin"]],decls:28,vars:9,consts:[["color","primary",1,"example-header"],["mat-icon-button","",3,"click"],[1,"uk-width-expand"],["mat-button","",3,"click"],[1,"admin-container"],["mode","side",1,"sidenav-left",3,"position","opened","fixedInViewport","fixedTopGap","fixedBottomGap"],["sidenav",""],["routerLink","/admin/dashboard"],["matListIcon",""],["matLine",""],["routerLink","/admin/product"],["mode","side",1,"example-sidenav",3,"position","fixedInViewport","fixedTopGap","fixedBottomGap"],[2,"padding","20px","background-color","#d7ccc8"]],template:function(t,e){if(1&t){const t=i.EpF();i.ynx(0),i.TgZ(1,"mat-toolbar",0),i.TgZ(2,"button",1),i.NdJ("click",function(){return i.CHM(t),i.MAs(12).toggle()}),i.TgZ(3,"mat-icon"),i._uU(4,"menu"),i.qZA(),i.qZA(),i.TgZ(5,"span"),i._uU(6,"Recake"),i.qZA(),i._UZ(7,"div",2),i.TgZ(8,"button",3),i.NdJ("click",function(){return e.logout()}),i._uU(9,"Logout"),i.qZA(),i.qZA(),i.TgZ(10,"mat-sidenav-container",4),i.TgZ(11,"mat-sidenav",5,6),i.TgZ(13,"mat-nav-list"),i.TgZ(14,"mat-list-item",7),i.TgZ(15,"mat-icon",8),i._uU(16,"receipt"),i.qZA(),i.TgZ(17,"h3",9),i._uU(18,"Resep"),i.qZA(),i.qZA(),i.TgZ(19,"mat-list-item",10),i.TgZ(20,"mat-icon",8),i._uU(21,"edit_note"),i.qZA(),i.TgZ(22,"h3",9),i._uU(23,"Penulis"),i.qZA(),i.qZA(),i.qZA(),i.qZA(),i._UZ(24,"mat-sidenav",11,6),i.TgZ(26,"mat-sidenav-content",12),i._UZ(27,"router-outlet"),i.qZA(),i.qZA(),i.BQk()}2&t&&(i.xp6(11),i.Q6J("position","start")("opened",!0)("fixedInViewport",!0)("fixedTopGap",60)("fixedBottomGap",0),i.xp6(13),i.Q6J("position","end")("fixedInViewport",!0)("fixedTopGap",60)("fixedBottomGap",0))},directives:[a.Ye,s.lW,u.Hw,c.TM,c.JX,h.Hk,h.Tg,o.rH,h.Nh,l.X2,c.Rh,o.lC],styles:[""]}),t})();var d=n(2797);let p=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-dashboard"]],decls:269,vars:0,consts:[[1,"example-card"],["mat-card-avatar","",1,"example-header-image"],["mat-card-image","","src","https://1.bp.blogspot.com/-_72emwM-7uE/XrPi-4DtFvI/AAAAAAAAG8Y/rByYTDh5MkcxFNZwMEcYRgT1057GYbggwCLcBGAsYHQ/s1600/aneka-resep-kue-kering-untuk-lebaran-2020-unik-dan-cantik.jpg","alt","Photo of a recake"],["src","https://www.puratos.co.id/content/dam/indonesia/images/products/Tegral%20Satin%20Cr%C3%A8me%20Cake%20Red%20Velvet.jpg/_jcr_content/renditions/original","border","4","align","center",2,"width","500px","height","400px"],["src","https://www.resepmasakterbaru.com/wp-content/uploads/2020/09/resep-cheese-cake-lembut-empuk.jpg","border","4","align","center",2,"width","500px","height","400px"],["src","https://dapurkintamani.com/wp-content/uploads/2020/09/blackforest-cake-resep.webp","border","4","align","center",2,"width","500px","height","400px"],["src","https://akcdn.detik.net.id/community/media/visual/2020/07/01/pancake-amerika-2.jpeg?w=700&q=90","border","4","align","center",2,"width","500px","height","400px"],["src","https://www.unileverfoodsolutions.co.id/dam/global-ufs/mcos/SEA/calcmenu/recipes/ID-recipes/desserts-&-bakery/milk-pie/main-header.jpg","border","4","align","center",2,"width","500px","height","400px"],["mat-button",""]],template:function(t,e){1&t&&(i.TgZ(0,"mat-card",0),i.TgZ(1,"mat-card-header"),i._UZ(2,"div",1),i.TgZ(3,"mat-card-title"),i._uU(4,"Welcome to Recake"),i.qZA(),i.TgZ(5,"mat-card-subtitle"),i._uU(6,"Web Applikasi Resep Kue"),i.qZA(),i.qZA(),i._UZ(7,"img",2),i.TgZ(8,"mat-card-content"),i.TgZ(9,"p"),i._uU(10,"Resep kue diatas dapat anda lihat dibawah ini"),i.qZA(),i.TgZ(11,"h3"),i.TgZ(12,"b"),i._uU(13,"Resep Kue Nastar"),i.qZA(),i.qZA(),i.TgZ(14,"p"),i._uU(15,"Bahan: 400 gram terigu protein sedang, 150 gram gula halus, 2 kuning telur, 300 gram margarin, 30 gram susu bubuk, Selai nanas secukupnya untuk isian, Keju parut secukupnya untuk taburan, 1 kuning telur, 1 sdt madu, 1 sdt minyak, 1 tetes pewarna kuning."),i.qZA(),i.TgZ(16,"p"),i._uU(17,"Cara membuat: "),i.qZA(),i.TgZ(18,"ol"),i.TgZ(19,"li"),i._uU(20,"Campur bahan kecuali selai dan keju."),i.qZA(),i.TgZ(21,"li"),i._uU(22,"Aduk sampai kalis."),i.qZA(),i.TgZ(23,"li"),i._uU(24,"Ambil sedikit adonan, bulatkan dan pipihkan. "),i.qZA(),i.TgZ(25,"li"),i._uU(26,"Isi dengan selai nanas dan bulatkan lagi. "),i.qZA(),i.TgZ(27,"li"),i._uU(28,"Oles dengan campuran kuning telur. "),i.qZA(),i.TgZ(29,"li"),i._uU(30,"Taburi keju. "),i.qZA(),i.TgZ(31,"li"),i._uU(32,"Tata di atas loyang yang sudah diolesi dengan mentega. "),i.qZA(),i.TgZ(33,"li"),i._uU(34,"Oven kurang lebih 10 menit sambil sesekali dilihat agar tak hangus. "),i.qZA(),i.qZA(),i.TgZ(35,"h3"),i.TgZ(36,"b"),i._uU(37,"Resep Kue Putri Salju Keju"),i.qZA(),i.qZA(),i.TgZ(38,"p"),i._uU(39,"Bahan: 400 gram tepung terigu protein sedang, 100 gram tepung maizena, 3 butir kuning telur, 300 gram butter (boleh diganti Blue Band Cake dan Cookies), 40 gram susu bubuk, 150 gram keju cheddar parut, 120 gram gula halus, Gula halus secukupnya."),i.qZA(),i.TgZ(40,"p"),i._uU(41,"Cara membuat: "),i.qZA(),i.TgZ(42,"ol"),i.TgZ(43,"li"),i._uU(44,"Kocok mentega, gula halus, dan kuning telur dengan mixer berkecepatan rendah selama 2 menit. "),i.qZA(),i.TgZ(45,"li"),i._uU(46,"Matikan mixer, kemudian masukkan keju parut dan aduk rata. "),i.qZA(),i.TgZ(47,"li"),i._uU(48,"Masukkan campuran terigu, tepung maizena, dan susu bubuk. "),i.qZA(),i.TgZ(49,"li"),i._uU(50,"Aduk rata dengan spatula sampai adonan cukup bisa diuleni. "),i.qZA(),i.TgZ(51,"li"),i._uU(52,"Cetak adonan sesuai selera, kemudian susun di loyang yang sudah diolesi margarin atau dialasi kertas roti. "),i.qZA(),i.TgZ(53,"li"),i._uU(54,"Panggang putri salju dengan suhu 150 derajat Celcius hingga matang, kurang lebih 20 menit. "),i.qZA(),i.TgZ(55,"li"),i._uU(56,"Gulingkan putri salju pada gula donat secukupnya. Setelah dingin masukkan ke dalam toples. "),i.qZA(),i.qZA(),i.TgZ(57,"h3"),i.TgZ(58,"b"),i._uU(59,"Resep Kue Kastangel"),i.qZA(),i.qZA(),i.TgZ(60,"p"),i._uU(61,"Bahan: 300 gram menteg, 350 gram tepung terigu protein sedang, 300 gram keju parut, 50 gram tepung maizena, 2 sdm susu bubuk, 2 butir kuning telur. "),i.qZA(),i.TgZ(62,"p"),i._uU(63,"Cara membuat: "),i.qZA(),i.TgZ(64,"ol"),i.TgZ(65,"li"),i._uU(66,"Aduk tepung terigu, maizena, dan susu bubuk hingga merata, kemudian sisihkan. "),i.qZA(),i.TgZ(67,"li"),i._uU(68,"Kocok mentega menggunakan mixer hingga lembut, matikan mixer. "),i.qZA(),i.TgZ(69,"li"),i._uU(70,"Masukkan 200 gr keju parut ke dalam mentega, lalu aduk rata dengan spatula. "),i.qZA(),i.TgZ(71,"li"),i._uU(72,"Masukkan campuran tepung ke dalam adonan basah, sambil diayak, kemudian aduk rata. "),i.qZA(),i.TgZ(73,"li"),i._uU(74,"Letakkan adonan di atas talenan, kemudian gilas tipis dan cetak sesuai selera menggunakan cetakan kastengel. "),i.qZA(),i.TgZ(75,"li"),i._uU(76,"Susun kue di atas loyang, olesi permukaan dengan kuning telur, dan taburi keju secukupnya. "),i.qZA(),i.TgZ(77,"li"),i._uU(78,"Panggang kue dalam oven dengan suhu 130\xb0 C hingga kue kering terlihat kuning kecoklatan. "),i.qZA(),i.qZA(),i.TgZ(79,"h3"),i.TgZ(80,"b"),i._uU(81,"Resep Kue Kacang"),i.qZA(),i.qZA(),i.TgZ(82,"p"),i._uU(83,"Bahan: 250 gram kacang tanah sanggrai, 400 gram Terigu, 150 gram Gula halus, 1 sendok teh garam, 200 gram Minyak goreng, 2 sdm Butter Margarin (untuk polesan), 2 Buah kuning telur (untuk polesan)."),i.qZA(),i.TgZ(84,"p"),i._uU(85,"Cara membuat: "),i.qZA(),i.TgZ(86,"ol"),i.TgZ(87,"li"),i._uU(88,"Langkah pertama, tumbuk atau blender kacang tanah yang telah disangrai hingga menjadi halus. "),i.qZA(),i.TgZ(89,"li"),i._uU(90,"Dalam wadah lain campurkan bahan-bahan seperti gua halus, tepung terigu, kacang tanah, minyak goreng dan berikan garam kemudian aduk hingga merata. "),i.qZA(),i.TgZ(91,"li"),i._uU(92,"Lalu simpanlah dahulu adonan ini dalam lemari es selama kurang lebih 1 jam dengan ditutup menggunakan plastik wrap. "),i.qZA(),i.TgZ(93,"li"),i._uU(94,"Setelah didiamkan ambil adonan dan diamkan sementara dalam suhu ruangan kemudian adonan siap dicetak menggunakan cetakan kue sesuai selera. "),i.qZA(),i.TgZ(95,"li"),i._uU(96,"Ambil loyang yang telah dilumuri mentega dan tepung terigu kemudian tempatkan adonan kue dalam loyang , campurkan kedua bahan olesan kemudian berikan polesan sebelum dipanggang dibagian atasnya. "),i.qZA(),i.TgZ(97,"li"),i._uU(98,"Terakhir panggang dalam oven selama kurang lebih 25 menit dalam suhu 170 derajat celcius. Keluarkan dan angkat dari loyang dinginkan kemudian sajikan. "),i.qZA(),i.qZA(),i.TgZ(99,"h3"),i.TgZ(100,"b"),i._uU(101,"Resep Donat"),i.qZA(),i.qZA(),i.TgZ(102,"p"),i._uU(103,"Bahan: 500 gram tepung terigu protein tinggi, 100 gram gula pasir, 11 gram atau 1 bungkus ragi instan, 1/4 sdt baking powder, 1/2 sdt garam, 2 kuning telur, 100 gram mentega, 250 ml susu cair, Mentega, Cokelat yang sudah ditim.Meises cokelat, Selai, Gula halus."),i.qZA(),i.TgZ(104,"p"),i._uU(105,"Cara membuat: "),i.qZA(),i.TgZ(106,"ol"),i.TgZ(107,"li"),i._uU(108,"Campur tepung terigu, gula, ragi instan, baking powder dan garam, aduk dengan tangan. "),i.qZA(),i.TgZ(109,"li"),i._uU(110,"Tambahkan kuning telur, uleni hingga berbentuk butiran halus. "),i.qZA(),i.TgZ(111,"li"),i._uU(112,"Tuangkan susu cair sedikit demi sedikit. Uleni hingga tercampur rata. "),i.qZA(),i.TgZ(113,"li"),i._uU(114,"4.Tambahkan mentega, uleni lagi dengan gerakan memutar, sesekali banting adonan. Lakukan hingga adonan licin dan kalis, kurang lebih 15 menit. "),i.qZA(),i.TgZ(115,"li"),i._uU(116,"Kumpulkan adonan menjadi satu dalam baskom. Tutupi dengan kain bersih, diamkan selama 1 jam. "),i.qZA(),i.TgZ(117,"li"),i._uU(118,"Tinju-tinju adonan hingga udara keluar dan adonan kempes. "),i.qZA(),i.TgZ(119,"li"),i._uU(120,"Bagi adonan menjadi 30 bagian, buat bulatan seperti bola. Diamkan lagi selama 10 menit. "),i.qZA(),i.TgZ(121,"li"),i._uU(122,"Lubangi masing-masing adonan, untuk hasil terbaik, lakukan dengan tangan. "),i.qZA(),i.TgZ(123,"li"),i._uU(124,"Goreng donat dalam minyak panas menggunakan api kecil-sedang. Goreng satu bagian hingga menguning, lalu balik hingga semua bagian berwarna kuning keemasan. "),i.qZA(),i.TgZ(125,"li"),i._uU(126,"Angkat, tiriskan dan tunggu hingga dingin. Selanjutnya hias dengan toping sesuai selera. "),i.qZA(),i.qZA(),i.TgZ(127,"h3"),i.TgZ(128,"b"),i._uU(129,"Resep Red Velvet Cake Kukus"),i.qZA(),i.qZA(),i._UZ(130,"img",3),i._UZ(131,"p"),i.TgZ(132,"p"),i._uU(133,"Bahan: 3 butir telur, 120 grm tepung terigu, 100 grm gula pasir, 1 bungkus susu Dancow putih, 1 bungkus SKM putih, 100 ml Minyak makan /minyak goreng, 1/4 SDM garam 1 SDM Cacao coklat, 1 botol Vanili, 1/2 sdm sp, 1/4 SDM soda kue, Beberapa tetes pewarna makanan merah, Butter cream dan keju cheddar"),i.qZA(),i.TgZ(134,"p"),i._uU(135,"Cara membuat: "),i.qZA(),i.TgZ(136,"ol"),i.TgZ(137,"li"),i._uU(138,"Campur bahan kering tepung,cacao,susu Dancow, soda kue"),i.qZA(),i.TgZ(139,"li"),i._uU(140,"Mixer telor,gula dan sampai putih berjejak"),i.qZA(),i.TgZ(141,"li"),i._uU(142,"Lalu masukkan bahan kering sambil diayak lalu di aduk dengan spatula"),i.qZA(),i.TgZ(143,"li"),i._uU(144,"Bila sudah tercampur rata masukkan minyak makan/minyak goreng dan sedikit garam karna kita tdk memakai margarin"),i.qZA(),i.TgZ(145,"li"),i._uU(146,"Lalu aduk balik menggunakan spatula,masukkan susu kental manis aduk lagi lalu masukkan pewarna merah aduk balik"),i.qZA(),i.TgZ(147,"li"),i._uU(148,"Tuang di loyang yg telah di oles minyak makan lalu kukus selama 25-30 menit,tutup dengan kain bersih.. bila di tusuk tdk lengket berarti sudah matang"),i.qZA(),i.TgZ(149,"li"),i._uU(150,"Bila sudah matang masukkan kedalam freezer sampai dingin lalu belah dua cake oles butter cream di tengahnya lalu tumpuk..oles lagi butter cream di atasnya lalu larutkan keju,masukkan lagi kedalam kulkas sebentar lalu sajikan"),i.qZA(),i.qZA(),i.TgZ(151,"h3"),i.TgZ(152,"b"),i._uU(153,"Resep Cheese Cake"),i.qZA(),i.qZA(),i._UZ(154,"img",4),i._UZ(155,"p"),i.TgZ(156,"p"),i._uU(157,"Bahan: 125 gram tepung terigu protein sedang, 200 gram margarin atau mentega, 100 gram susu bubuk, 450 gram cream cheese, 3 sdm tepung meizena, 220 gram gula pasir, 1/2 sdt garam, 6 butir telur ayam, 1 sdm cake emulsifier"),i.qZA(),i.TgZ(158,"p"),i._uU(159,"Cara membuat:"),i.qZA(),i.TgZ(160,"ol"),i.TgZ(161,"li"),i._uU(162,"Siapkan tepung terigu didalam sebuah wadah"),i.qZA(),i.TgZ(163,"li"),i._uU(164,"Tambahkan susu bubuk, tepung meizena, dan garam, lalu kocok sampai merata dan ayak"),i.qZA(),i.TgZ(165,"li"),i._uU(166,"Aduk cream cheese dengan margarin sampai kalis"),i.qZA(),i.TgZ(167,"li"),i._uU(168,"Kemudian gula pasir, telur,dan cake emulsifier dikocok di dalam wadah lain sampai kembang."),i.qZA(),i.TgZ(169,"li"),i._uU(170,"Satukan tepung yang sudah tercampur tadi dengan cream cheese yang sudah dicampur juga, aduklah sampai rata."),i.qZA(),i.TgZ(171,"li"),i._uU(172,"Masukkan adonan ke dalam sebuah loyang yang telah terolesi margarin atau teralasi kertas roti agar nantinya tidak menempel atau lengket, kemudian pangganglah dengan oven bersuhu sekitar180 derajat"),i.qZA(),i.TgZ(173,"li"),i._uU(174,"Tunggu sampai 45 menit hingga cake matang."),i.qZA(),i.TgZ(175,"li"),i._uU(176,"Setalah matang, lalu angkat dan dinginkan."),i.qZA(),i.TgZ(177,"li"),i._uU(178,"Cheese cake siap dinikmati!"),i.qZA(),i.qZA(),i.TgZ(179,"h3"),i.TgZ(180,"b"),i._uU(181,"Resep Black Forest Cake"),i.qZA(),i.qZA(),i._UZ(182,"img",5),i._UZ(183,"p"),i.TgZ(184,"p"),i._uU(185,"Bahan: 8 kuning telur, 7 telur antero (telur utuh), 200 gr gula pasir halus, 15 gr cake emulsifier, 1 sdt vanilla, 100 gr terigu protein sedang, 25 gr maizena, 25 gr coklat bubuk, 15 gr susu bubuk full cream, 150 gr margarin/butter lelehkan, 1-2 sdm chocolate pasta black forest "),i.qZA(),i.TgZ(186,"p"),i._uU(187,"Cara membuat: "),i.qZA(),i.TgZ(188,"ol"),i.TgZ(189,"li"),i._uU(190,"Panaskan oven 180 derajat Celcius. Siapkan 3 buah loyang ukuran 24 cm, olesi dengan margarin/minyak oles loyang, alasi bawahnya dengan kertas roti/baking paper, olesi lagi dengan margarin/minyak oles loyang. Sisihkan."),i.qZA(),i.TgZ(191,"li"),i._uU(192,"Kocok kuning telur, telur utuh, gula pasir dan cake emulsifier hingga mengembang dan kental berjejak."),i.qZA(),i.TgZ(193,"li"),i._uU(194,"Masukkan campuran terigu, maizena, susu bubuk dan vanilla yang sudah diayak secara bertahap. Aduk balik dengan spatula atau mixer kecepatan rendah sampai tercampur rata."),i.qZA(),i.TgZ(195,"li"),i._uU(196,"Masukkan margarin/butter leleh dan chocolate pasta black forest. Aduk balik dengan spatula hingga benar-benar tercampur rata dan homogen."),i.qZA(),i.TgZ(197,"li"),i._uU(198,"Tuang ke dalam 3 buah loyang yang sudah disiapkan dengan sama rata."),i.qZA(),i.TgZ(199,"li"),i._uU(200,"Panggang dalam oven sampai matang, sekitar 25 menit hingga permukaannya tidak lengket dan membal saat disentuh."),i.qZA(),i.TgZ(201,"li"),i._uU(202,"Keluarkan dari oven, segera keluarkan dari loyang dan dinginkan."),i.qZA(),i.qZA(),i.TgZ(203,"h3"),i.TgZ(204,"b"),i._uU(205,"Resep Pancake"),i.qZA(),i.qZA(),i._UZ(206,"img",6),i._UZ(207,"p"),i.TgZ(208,"p"),i._uU(209,"Bahan: 225 g tepung terigu protein sedang, 2 sdt baking powder, 1/2 sdt garam, 1 sdt gula pasir, 2 butir telur ayam yang besar, 30 g mentega tawar lelehkan, 300 ml susu cair, mentega untuk olesan, Potongan buah segar (strawberry, apel, pisang) untuk pelengkap, Madu/sirop maple"),i.qZA(),i.TgZ(210,"p"),i._uU(211,"Cara membuat: "),i.qZA(),i.TgZ(212,"ol"),i.TgZ(213,"li"),i._uU(214,"Campur tepung terigu dengan baking powder, garam dan gula dalam mangkuk. Aduk rata."),i.qZA(),i.TgZ(215,"li"),i._uU(216,"Kocok telur hingga berbuih, tambahkan mentega cair dan susu."),i.qZA(),i.TgZ(217,"li"),i._uU(218,"Buat cerukan dalam tepung, tuangkan campuran telur sedikit demi sedikit sambil aduk dengan kocokan kawat hingga licin."),i.qZA(),i.TgZ(219,"li"),i._uU(220,"Diamkan adonan selama 15 menit."),i.qZA(),i.TgZ(221,"li"),i._uU(222,"Panaskan wajan datar, olesi sedikit mentega."),i.qZA(),i.TgZ(223,"li"),i._uU(224,"Tuangkan 1 sendok sayur adonan ke atas wajan. Masak hingga permukaannya berlubang kecil. Balikkan pancake, masak sebentar lalu angkat."),i.qZA(),i.TgZ(225,"li"),i._uU(226,"Kerjakan yang sama dengan sisa adonan."),i.qZA(),i.TgZ(227,"li"),i._uU(228,"Sajikan pancake hangat dengan Pelengkap sesuai selera."),i.qZA(),i.qZA(),i.TgZ(229,"p"),i._uU(230,"Tips: "),i.qZA(),i.TgZ(231,"ol"),i.TgZ(232,"li"),i._uU(233,"Jika memakai double acting baking powder kurangi takarannya menjadi 1 sdt saja."),i.qZA(),i.TgZ(234,"li"),i._uU(235,"Sebaiknya diamkan beberapa saat adonan pancake sebelum dimasak agar adonan lebih lembut."),i.qZA(),i.TgZ(236,"li"),i._uU(237,"Setiap kali akan menuangkan adonan ke dalam wajan, jangan lupa aduk-aduk dulu agar merata."),i.qZA(),i.qZA(),i.TgZ(238,"h3"),i.TgZ(239,"b"),i._uU(240,"Resep Pie Susu"),i.qZA(),i.qZA(),i._UZ(241,"img",7),i._UZ(242,"p"),i.TgZ(243,"p"),i._uU(244,"Bahan Crust: 100 gram tepung terigu, 50 gram mentega/margarine , 1 sachet susu kental manis atau bisa diganti 2 sendok gula halus "),i.qZA(),i.TgZ(245,"p"),i._uU(246,"Bahan Filling:1 butir telur ayam, 1 sdt munjung tepung maizena, 1 sachet Susu Kental Manis, 2 sdm gula pasir, 1 sachet vanili, 2 sdm air"),i.qZA(),i.TgZ(247,"p"),i._uU(248,"Cara membuat: "),i.qZA(),i.TgZ(249,"ol"),i.TgZ(250,"li"),i._uU(251,'Siapkan bahan pie Crust. Campur rata semua bahan pie crust. Ulen menggunakan sendok atau spatula, bisa pakai tangan tpi jangan lama" kalo kelamaan pakai tangan nanti keras. Campur sampai adonan bisa dibulatkan'),i.qZA(),i.TgZ(252,"li"),i._uU(253,'Pindah adonan ke teflon dan pipihkan membentuk permukaan teflon. Usahakan ketebalannya sama. Jika sudah tusuk" adonan menggunakan garpu agar cepat matang. Oiya saya pakai loyang ukur 18, yg lebarnya cuma satu kilan.'),i.qZA(),i.TgZ(254,"li"),i._uU(255,"Alasi tatakan kompor dengan seng atau tutup kaleng. Jika tidak punya gunakan api kecil sekali (hampir mati) untuk memanggang pie. Jika sudah panggang crust pie sekitar 10 menit,jangan lupa tutup teflonnya"),i.qZA(),i.TgZ(256,"li"),i._uU(257,"Sambil menunggu crust agak kering, siapkan bahan Filling."),i.qZA(),i.TgZ(258,"li"),i._uU(259,"Dalam wadah larutkan tepung maizena dengan 2 sdm air. Masukan telur,gula,susu, dan vanili. Kocok sampai gula larut,jika kurang manis bisa ditambahkan gula."),i.qZA(),i.TgZ(260,"li"),i._uU(261,"Setelah 10 menit memanggang crust masukan Filling pie. Agar Filling mulus bisa disaring."),i.qZA(),i.TgZ(262,"li"),i._uU(263,"Tutup teflon dan tunggu sekitar 30 menit atau sampai fillingnya set kalau ditusuk tidak lengket. Oiya sesekali cek kalau filling bergelembung tusuk saja. Pie Susu siap dinikmati"),i.qZA(),i.qZA(),i.qZA(),i.TgZ(264,"mat-card-actions"),i.TgZ(265,"button",8),i._uU(266,"LIKE"),i.qZA(),i.TgZ(267,"button",8),i._uU(268,"SHARE"),i.qZA(),i.qZA(),i.qZA())},directives:[d.a8,d.dk,d.kc,d.n5,d.$j,d.G2,d.dn,d.hq,s.lW],styles:[""]}),t})();var g=n(1265),m=n(1041),y=n(2051),v=n(2935),b=n(3957);let w=(()=>{class t{constructor(t,e,n){this.api=t,this.dialogRef=e,this.dialogData=n,this.loadingUpload=!1}ngOnInit(){console.log(this.dialogData)}onFileChange(t){t.target.files.length>0&&(this.selectedFile=t.target.files[0],console.log(this.selectedFile))}UploadFile(){let t=new FormData;t.append("file",this.selectedFile),this.loadingUpload=!0,this.api.upload(t).subscribe(t=>{this.updateProduct(t),console.log(t)},t=>{this.loadingUpload=!1,alert("Gagal mengunggah file")})}updateProduct(t){1==t.status?(this.updateBook(t),alert("File berhasil diunggah"),this.loadingUpload=!1,this.dialogRef.close()):alert(t.message)}updateBook(t){this.api.put("books/"+this.dialogData.id,{url:t.url}).subscribe(t=>{console.log(t)})}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(b.s),i.Y36(v.so),i.Y36(v.WI))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-file-uploader"]],decls:13,vars:3,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,"uk-flex","uk-flex-middle","uk-flex-center",2,"height","100px","outline","2px dashed #ccc","margin","10px",3,"click"],["type","file","id","file",2,"display","none",3,"change"],["fileInput",""],["mat-dialog-actions",""],["mat-button","","mat-dialog-close",""],["mat-flat-button","","color","primary",3,"disabled","click"]],template:function(t,e){if(1&t){const t=i.EpF();i.TgZ(0,"h1",0),i._uU(1,"Unggah File"),i.qZA(),i.TgZ(2,"div",1),i.TgZ(3,"div",2),i.NdJ("click",function(){return i.CHM(t),i.MAs(7).click()}),i.TgZ(4,"span"),i._uU(5),i.qZA(),i.qZA(),i.TgZ(6,"input",3,4),i.NdJ("change",function(t){return e.onFileChange(t)}),i.qZA(),i.qZA(),i.TgZ(8,"div",5),i.TgZ(9,"button",6),i._uU(10,"Cancel"),i.qZA(),i.TgZ(11,"button",7),i.NdJ("click",function(){return e.UploadFile()}),i._uU(12),i.qZA(),i.qZA()}2&t&&(i.xp6(5),i.Oqu(e.selectedFile?e.selectedFile.name:"Pilih File"),i.xp6(6),i.Q6J("disabled",e.loadingUpload),i.xp6(1),i.Oqu(e.loadingUpload?"Uploading..":"Upload"))},directives:[v.uh,v.xY,v.H8,s.lW,v.ZT],styles:[""]}),t})();var T=n(8569),k=n(8318),_=n(9764),I=n(878),E=n(6238),A=n(2855),S=n(9996),D=n(2023),N=n(8720),x=n(3835),C=n(45),R=n(2346),q=n(1858),U=n(1062),O=n(4762),L=n(250),P=n(308),F=function(t,e){return(F=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function M(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var Z,V="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},j=j||{},B=V||self;function G(){}function K(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function J(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var Q="closure_uid_"+(1e9*Math.random()>>>0),z=0;function H(t,e,n){return t.call.apply(t.bind,arguments)}function W(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function Y(t,e,n){return(Y=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?H:W).apply(null,arguments)}function X(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function $(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Vb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function tt(){this.s=this.s,this.o=this.o}var et={};tt.prototype.s=!1,tt.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var t=function(t){return Object.prototype.hasOwnProperty.call(t,Q)&&t[Q]||(t[Q]=++z)}(this);delete et[t]}},tt.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var nt=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},rt=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function it(t){return Array.prototype.concat.apply([],arguments)}function ot(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function at(t){return/^[\s\xa0]*$/.test(t)}var st,ut=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function ct(t,e){return-1!=t.indexOf(e)}function ht(t,e){return t<e?-1:t>e?1:0}t:{var lt=B.navigator;if(lt){var ft=lt.userAgent;if(ft){st=ft;break t}}st=""}function dt(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function pt(t){var e={};for(var n in t)e[n]=t[n];return e}var gt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function mt(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<gt.length;o++)n=gt[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function yt(t){return yt[" "](t),t}yt[" "]=G;var vt,bt,wt=ct(st,"Opera"),Tt=ct(st,"Trident")||ct(st,"MSIE"),kt=ct(st,"Edge"),_t=kt||Tt,It=ct(st,"Gecko")&&!(ct(st.toLowerCase(),"webkit")&&!ct(st,"Edge"))&&!(ct(st,"Trident")||ct(st,"MSIE"))&&!ct(st,"Edge"),Et=ct(st.toLowerCase(),"webkit")&&!ct(st,"Edge");function At(){var t=B.document;return t?t.documentMode:void 0}t:{var St="",Dt=(bt=st,It?/rv:([^\);]+)(\)|;)/.exec(bt):kt?/Edge\/([\d\.]+)/.exec(bt):Tt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(bt):Et?/WebKit\/(\S+)/.exec(bt):wt?/(?:Version)[ \/]?(\S+)/.exec(bt):void 0);if(Dt&&(St=Dt?Dt[1]:""),Tt){var Nt=At();if(null!=Nt&&Nt>parseFloat(St)){vt=String(Nt);break t}}vt=St}var xt={};var Ct=B.document&&Tt&&(At()||parseInt(vt,10))||void 0,Rt=function(){if(!B.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{B.addEventListener("test",G,e),B.removeEventListener("test",G,e)}catch(n){}return t}();function qt(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function Ut(t,e){if(qt.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(It){t:{try{yt(e.nodeName);var i=!0;break t}catch(o){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Ot[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&Ut.Z.h.call(this)}}qt.prototype.h=function(){this.defaultPrevented=!0},$(Ut,qt);var Ot={2:"touch",3:"pen",4:"mouse"};Ut.prototype.h=function(){Ut.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var Lt="closure_listenable_"+(1e6*Math.random()|0),Pt=0;function Ft(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ia=i,this.key=++Pt,this.ca=this.fa=!1}function Mt(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function Zt(t){this.src=t,this.g={},this.h=0}function Vt(t,e){var n=e.type;if(n in t.g){var r,i=t.g[n],o=nt(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(Mt(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function jt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ca&&o.listener==e&&o.capture==!!n&&o.ia==r)return i}return-1}Zt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.g[o])||(t=this.g[o]=[],this.h++);var a=jt(t,e,r,i);return-1<a?(e=t[a],n||(e.fa=!1)):((e=new Ft(e,this.src,o,!!r,i)).fa=n,t.push(e)),e};var Bt="closure_lm_"+(1e6*Math.random()|0),Gt={};function Kt(t,e,n,r,i){if(r&&r.once)return Qt(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Kt(t,e[o],n,r,i);return null}return n=te(n),t&&t[Lt]?t.N(e,n,J(r)?!!r.capture:!!r,i):Jt(t,e,n,!1,r,i)}function Jt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=J(i)?!!i.capture:!!i,s=Xt(t);if(s||(t[Bt]=s=new Zt(t)),(n=s.add(e,n,r,a,o)).proxy)return n;if(r=function(){var t=Yt;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)Rt||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Wt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Qt(t,e,n,r,i){if(Array.isArray(e)){for(var o=0;o<e.length;o++)Qt(t,e[o],n,r,i);return null}return n=te(n),t&&t[Lt]?t.O(e,n,J(r)?!!r.capture:!!r,i):Jt(t,e,n,!0,r,i)}function zt(t,e,n,r,i){if(Array.isArray(e))for(var o=0;o<e.length;o++)zt(t,e[o],n,r,i);else r=J(r)?!!r.capture:!!r,n=te(n),t&&t[Lt]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=jt(o=t.g[e],n,r,i))&&(Mt(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.g[e],t.h--))):t&&(t=Xt(t))&&(e=t.g[e.toString()],t=-1,e&&(t=jt(e,n,r,i)),(n=-1<t?e[t]:null)&&Ht(n))}function Ht(t){if("number"!=typeof t&&t&&!t.ca){var e=t.src;if(e&&e[Lt])Vt(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Wt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Xt(e))?(Vt(n,t),0==n.h&&(n.src=null,e[Bt]=null)):Mt(t)}}}function Wt(t){return t in Gt?Gt[t]:Gt[t]="on"+t}function Yt(t,e){if(t.ca)t=!0;else{e=new Ut(e,this);var n=t.listener,r=t.ia||t.src;t.fa&&Ht(t),t=n.call(r,e)}return t}function Xt(t){return(t=t[Bt])instanceof Zt?t:null}var $t="__closure_events_fn_"+(1e9*Math.random()>>>0);function te(t){return"function"==typeof t?t:(t[$t]||(t[$t]=function(e){return t.handleEvent(e)}),t[$t])}function ee(){tt.call(this),this.i=new Zt(this),this.P=this,this.I=null}function ne(t,e){var n,r=t.I;if(r)for(n=[];r;r=r.I)n.push(r);if(t=t.P,r=e.type||e,"string"==typeof e)e=new qt(e,t);else if(e instanceof qt)e.target=e.target||t;else{var i=e;mt(e=new qt(r,t),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var a=e.g=n[o];i=re(a,r,!0,e)&&i}if(i=re(a=e.g=t,r,!0,e)&&i,i=re(a,r,!1,e)&&i,n)for(o=0;o<n.length;o++)i=re(a=e.g=n[o],r,!1,e)&&i}function re(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.ca&&a.capture==n){var s=a.listener,u=a.ia||a.src;a.fa&&Vt(t.i,a),i=!1!==s.call(u,r)&&i}}return i&&!r.defaultPrevented}$(ee,tt),ee.prototype[Lt]=!0,ee.prototype.removeEventListener=function(t,e,n,r){zt(this,t,e,n,r)},ee.prototype.M=function(){if(ee.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)Mt(n[r]);delete e.g[t],e.h--}}this.I=null},ee.prototype.N=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},ee.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var ie=B.JSON.stringify;function oe(){var t=de,e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var ae,se=function(){function t(){this.h=this.g=null}return t.prototype.add=function(t,e){var n=ue.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n},t}(),ue=new(function(){function t(t,e){this.i=t,this.j=e,this.h=0,this.g=null}return t.prototype.get=function(){var t;return 0<this.h?(this.h--,this.g=(t=this.g).next,t.next=null):t=this.i(),t},t}())(function(){return new ce},function(t){return t.reset()}),ce=function(){function t(){this.next=this.g=this.h=null}return t.prototype.set=function(t,e){this.h=t,this.g=e,this.next=null},t.prototype.reset=function(){this.next=this.g=this.h=null},t}();function he(t){B.setTimeout(function(){throw t},0)}function le(t,e){ae||function(){var t=B.Promise.resolve(void 0);ae=function(){t.then(pe)}}(),fe||(ae(),fe=!0),de.add(t,e)}var fe=!1,de=new se;function pe(){for(var t;t=oe();){try{t.h.call(t.g)}catch(n){he(n)}var e=ue;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}fe=!1}function ge(t,e){ee.call(this),this.h=t||1,this.g=e||B,this.j=Y(this.kb,this),this.l=Date.now()}function me(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function ye(t,e,n){if("function"==typeof t)n&&(t=Y(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=Y(t.handleEvent,t)}return 2147483647<Number(e)?-1:B.setTimeout(t,e||0)}function ve(t){t.g=ye(function(){t.g=null,t.i&&(t.i=!1,ve(t))},t.j);var e=t.h;t.h=null,t.m.apply(null,e)}$(ge,ee),(Z=ge.prototype).da=!1,Z.S=null,Z.kb=function(){if(this.da){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),ne(this,"tick"),this.da&&(me(this),this.start()))}},Z.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},Z.M=function(){ge.Z.M.call(this),me(this),delete this.g};var be=function(t){function e(e,n){var r=t.call(this)||this;return r.m=e,r.j=n,r.h=null,r.i=!1,r.g=null,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}F(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.l=function(t){this.h=arguments,this.g?this.i=!0:ve(this)},e.prototype.M=function(){t.prototype.M.call(this),this.g&&(B.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},e}(tt);function we(t){tt.call(this),this.h=t,this.g={}}$(we,tt);var Te=[];function ke(t,e,n,r){Array.isArray(n)||(n&&(Te[0]=n.toString()),n=Te);for(var i=0;i<n.length;i++){var o=Kt(e,n[i],r||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}}function _e(t){dt(t.g,function(t,e){this.g.hasOwnProperty(e)&&Ht(t)},t),t.g={}}function Ie(){this.g=!0}function Ee(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var a=1;a<i.length;a++)i[a]=""}}}return ie(n)}catch(s){return e}}(t,n)+(r?" "+r:"")})}we.prototype.M=function(){we.Z.M.call(this),_e(this)},we.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Ie.prototype.Aa=function(){this.g=!1},Ie.prototype.info=function(){};var Ae={},Se=null;function De(){return Se=Se||new ee}function Ne(t){qt.call(this,Ae.Ma,t)}function xe(t){var e=De();ne(e,new Ne(e,t))}function Ce(t,e){qt.call(this,Ae.STAT_EVENT,t),this.stat=e}function Re(t){var e=De();ne(e,new Ce(e,t))}function qe(t,e){qt.call(this,Ae.Na,t),this.size=e}function Ue(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return B.setTimeout(function(){t()},e)}Ae.Ma="serverreachability",$(Ne,qt),Ae.STAT_EVENT="statevent",$(Ce,qt),Ae.Na="timingevent",$(qe,qt);var Oe={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},Le={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function Pe(){}function Fe(){}Pe.prototype.h=null;var Me,Ze={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function Ve(){qt.call(this,"d")}function je(){qt.call(this,"c")}function Be(){}function Ge(t,e,n,r){this.l=t,this.j=e,this.m=n,this.X=r||1,this.V=new we(this),this.P=Je,this.W=new ge(t=_t?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new Ke}function Ke(){this.i=null,this.g="",this.h=!1}$(Ve,qt),$(je,qt),$(Be,Pe),Be.prototype.g=function(){return new XMLHttpRequest},Be.prototype.i=function(){return{}},Me=new Be;var Je=45e3,Qe={},ze={};function He(t,e,n){t.K=1,t.v=bn(dn(e)),t.s=n,t.U=!0,We(t,null)}function We(t,e){t.F=Date.now(),tn(t),t.A=dn(t.v);var n=t.A,r=t.X;Array.isArray(r)||(r=[String(r)]),Rn(n.h,"t",r),t.C=0,n=t.l.H,t.h=new Ke,t.g=qr(t.l,n?e:null,!t.s),0<t.O&&(t.L=new be(Y(t.Ia,t,t.g),t.O)),ke(t.V,t.g,"readystatechange",t.gb),e=t.H?pt(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),xe(1),function(t,e,n,r,i,o){t.info(function(){if(t.g)if(o)for(var a="",s=o.split("&"),u=0;u<s.length;u++){var c=s[u].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");a=2<=l.length&&"type"==l[1]?a+(h+"=")+c+"&":a+(h+"=redacted&")}}else a=null;else a=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+a})}(t.j,t.u,t.A,t.m,t.X,t.s)}function Ye(t){return!!t.g&&"GET"==t.u&&2!=t.K&&t.l.Ba}function Xe(t,e,n){for(var r,i=!0;!t.I&&t.C<n.length;){if((r=$e(t,n))==ze){4==e&&(t.o=4,Re(14),i=!1),Ee(t.j,t.m,null,"[Incomplete Response]");break}if(r==Qe){t.o=4,Re(15),Ee(t.j,t.m,n,"[Invalid Chunk]"),i=!1;break}Ee(t.j,t.m,r,null),an(t,r)}Ye(t)&&r!=ze&&r!=Qe&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,Re(16),i=!1),t.i=t.i&&i,i?0<n.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),Er(e),e.L=!0,Re(11))):(Ee(t.j,t.m,n,"[Invalid Chunked Response]"),on(t),rn(t))}function $e(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?ze:(n=Number(e.substring(n,r)),isNaN(n)?Qe:(r+=1)+n>e.length?ze:(e=e.substr(r,n),t.C=r+n,e))}function tn(t){t.Y=Date.now()+t.P,en(t,t.P)}function en(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=Ue(Y(t.eb,t),e)}function nn(t){t.B&&(B.clearTimeout(t.B),t.B=null)}function rn(t){0==t.l.G||t.I||Dr(t.l,t)}function on(t){nn(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,me(t.W),_e(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function an(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||Mn(n.i,t)))if(n.I=t.N,!t.J&&Mn(n.i,t)&&3==n.G){try{var r=n.Ca.g.parse(e)}catch(o){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;Sr(n),mr(n)}Ir(n),Re(18)}}else n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=Ue(Y(n.ab,n),6e3));if(1>=Fn(n.i)&&n.ka){try{n.ka()}catch(o){}n.ka=void 0}}else xr(n,11)}else if((t.J||n.g==t)&&Sr(n),!at(e))for(i=n.Ca.g.parse(e),e=0;e<i.length;e++){var o=i[e];if(n.U=o[0],o=o[1],2==n.G)if("c"==o[0]){n.J=o[1],n.la=o[2];var a=o[3];null!=a&&(n.ma=a,n.h.info("VER="+n.ma));var s=o[4];null!=s&&(n.za=s,n.h.info("SVER="+n.za));var u=o[5];null!=u&&"number"==typeof u&&0<u&&(n.K=r=1.5*u,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;var c=t.g;if(c){var h=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=r.i;!l.g&&(ct(h,"spdy")||ct(h,"quic")||ct(h,"h2"))&&(l.j=l.l,l.g=new Set,l.h&&(Zn(l,l.h),l.h=null))}if(r.D){var f=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;f&&(r.sa=f,vn(r.F,r.D,f))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms"));var d=t;if((r=n).oa=Rr(r,r.H?r.la:null,r.W),d.J){Vn(r.i,d);var p=d,g=r.K;g&&p.setTimeout(g),p.B&&(nn(p),tn(p)),r.g=d}else _r(r);0<n.l.length&&br(n)}else"stop"!=o[0]&&"close"!=o[0]||xr(n,7);else 3==n.G&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?xr(n,7):gr(n):"noop"!=o[0]&&n.j&&n.j.wa(o),n.A=0)}xe(4)}catch(o){}}function sn(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(K(t)||"string"==typeof t)rt(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var n=t.T();else if(t.R&&"function"==typeof t.R)n=void 0;else if(K(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"==typeof t)return t.split("");if(K(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function un(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof un)for(n=t.T(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function cn(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var r=t.g[e];hn(t.h,r)&&(t.g[n++]=r),e++}t.g.length=n}if(t.i!=t.g.length){var i={};for(n=e=0;e<t.g.length;)hn(i,r=t.g[e])||(t.g[n++]=r,i[r]=1),e++;t.g.length=n}}function hn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(Z=Ge.prototype).setTimeout=function(t){this.P=t},Z.gb=function(t){t=t.target;var e=this.L;e&&3==hr(t)?e.l():this.Ia(t)},Z.Ia=function(t){try{if(t==this.g)t:{var e=hr(this.g),n=this.g.Da(),r=this.g.ba();if(!(3>e)&&(3!=e||_t||this.g&&(this.h.h||this.g.ga()||lr(this.g)))){this.I||4!=e||7==n||xe(8==n||0>=r?3:2),nn(this);var i=this.g.ba();this.N=i;e:if(Ye(this)){var o=lr(this.g);t="";var a=o.length,s=4==hr(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){on(this),rn(this);var u="";break e}this.h.i=new B.TextDecoder}for(n=0;n<a;n++)this.h.h=!0,t+=this.h.i.decode(o[n],{stream:s&&n==a-1});o.splice(0,a),this.h.g+=t,this.C=0,u=this.h.g}else u=this.g.ga();if(this.i=200==i,function(t,e,n,r,i,o,a){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+a})}(this.j,this.u,this.A,this.m,this.X,e,i),this.i){if(this.$&&!this.J){e:{if(this.g){var c,h=this.g;if((c=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!at(c)){var l=c;break e}}l=null}if(!(i=l)){this.i=!1,this.o=3,Re(12),on(this),rn(this);break t}Ee(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,an(this,i)}this.U?(Xe(this,e,u),_t&&this.i&&3==e&&(ke(this.V,this.W,"tick",this.fb),this.W.start())):(Ee(this.j,this.m,u,null),an(this,u)),4==e&&on(this),this.i&&!this.I&&(4==e?Dr(this.l,this):(this.i=!1,tn(this)))}else 400==i&&0<u.indexOf("Unknown SID")?(this.o=3,Re(12)):(this.o=0,Re(13)),on(this),rn(this)}}}catch(e){}},Z.fb=function(){if(this.g){var t=hr(this.g),e=this.g.ga();this.C<e.length&&(nn(this),Xe(this,t,e),this.i&&4!=t&&tn(this))}},Z.cancel=function(){this.I=!0,on(this)},Z.eb=function(){this.B=null;var t=Date.now();0<=t-this.Y?(function(t,e){t.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.K&&(xe(3),Re(17)),on(this),this.o=2,rn(this)):en(this,this.Y-t)},(Z=un.prototype).R=function(){cn(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},Z.T=function(){return cn(this),this.g.concat()},Z.get=function(t,e){return hn(this.h,t)?this.h[t]:e},Z.set=function(t,e){hn(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},Z.forEach=function(t,e){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var ln=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function fn(t,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof fn){this.g=void 0!==e?e:t.g,pn(this,t.j),this.s=t.s,gn(this,t.i),mn(this,t.m),this.l=t.l,e=t.h;var n=new Dn;n.i=e.i,e.g&&(n.g=new un(e.g),n.h=e.h),yn(this,n),this.o=t.o}else t&&(n=String(t).match(ln))?(this.g=!!e,pn(this,n[1]||"",!0),this.s=wn(n[2]||""),gn(this,n[3]||"",!0),mn(this,n[4]),this.l=wn(n[5]||"",!0),yn(this,n[6]||"",!0),this.o=wn(n[7]||"")):(this.g=!!e,this.h=new Dn(null,this.g))}function dn(t){return new fn(t)}function pn(t,e,n){t.j=n?wn(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function gn(t,e,n){t.i=n?wn(e,!0):e}function mn(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function yn(t,e,n){e instanceof Dn?(t.h=e,function(t,e){e&&!t.j&&(Nn(t),t.i=null,t.g.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(xn(this,e),Rn(this,n,t))},t)),t.j=e}(t.h,t.g)):(n||(e=Tn(e,An)),t.h=new Dn(e,t.g))}function vn(t,e,n){t.h.set(e,n)}function bn(t){return vn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function wn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Tn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,kn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function kn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}fn.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Tn(e,_n,!0),":");var n=this.i;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(Tn(e,_n,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&t.push("/"),t.push(Tn(n,"/"==n.charAt(0)?En:In,!0))),(n=this.h.toString())&&t.push("?",n),(n=this.o)&&t.push("#",Tn(n,Sn)),t.join("")};var _n=/[#\/\?@]/g,In=/[#\?:]/g,En=/[#\?]/g,An=/[#\?@]/g,Sn=/#/g;function Dn(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Nn(t){t.g||(t.g=new un,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function xn(t,e){Nn(t),e=qn(t,e),hn(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,hn((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&cn(t)))}function Cn(t,e){return Nn(t),e=qn(t,e),hn(t.g.h,e)}function Rn(t,e,n){xn(t,e),0<n.length&&(t.i=null,t.g.set(qn(t,e),ot(n)),t.h+=n.length)}function qn(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(Z=Dn.prototype).add=function(t,e){Nn(this),this.i=null,t=qn(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},Z.forEach=function(t,e){Nn(this),this.g.forEach(function(n,r){rt(n,function(n){t.call(e,n,r,this)},this)},this)},Z.T=function(){Nn(this);for(var t=this.g.R(),e=this.g.T(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},Z.R=function(t){Nn(this);var e=[];if("string"==typeof t)Cn(this,t)&&(e=it(e,this.g.get(qn(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=it(e,t[n])}return e},Z.set=function(t,e){return Nn(this),this.i=null,Cn(this,t=qn(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},Z.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},Z.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.R(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.i=t.join("&")};var Un=function(){return function(t,e){this.h=t,this.g=e}}();function On(t){this.l=t||Ln,t=B.PerformanceNavigationTiming?0<(t=B.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(B.g&&B.g.Ea&&B.g.Ea()&&B.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Ln=10;function Pn(t){return!!t.h||!!t.g&&t.g.size>=t.j}function Fn(t){return t.h?1:t.g?t.g.size:0}function Mn(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function Zn(t,e){t.g?t.g.add(e):t.h=e}function Vn(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function jn(t){var e,n;if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){var r=t.i;try{for(var i=M(t.g.values()),o=i.next();!o.done;o=i.next())r=r.concat(o.value.D)}catch(a){e={error:a}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return ot(t.i)}function Bn(){}function Gn(){this.g=new Bn}function Kn(t,e,n){var r=n||"";try{sn(t,function(t,n){var i=t;J(t)&&(i=ie(t)),e.push(r+n+"="+encodeURIComponent(i))})}catch(tp){throw e.push(r+"type="+encodeURIComponent("_badmap")),tp}}function Jn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(o){}}function Qn(t){this.l=t.$b||null,this.j=t.ib||!1}function zn(t,e){ee.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=Hn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}On.prototype.cancel=function(){var t,e;if(this.i=jn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){try{for(var n=M(this.g.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(i){t={error:i}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.g.clear()}},Bn.prototype.stringify=function(t){return B.JSON.stringify(t,void 0)},Bn.prototype.parse=function(t){return B.JSON.parse(t,void 0)},$(Qn,Pe),Qn.prototype.g=function(){return new zn(this.l,this.j)},Qn.prototype.i=function(t){return function(){return t}}({}),$(zn,ee);var Hn=0;function Wn(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function Yn(t){t.readyState=4,t.l=null,t.j=null,t.A=null,Xn(t)}function Xn(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(Z=zn.prototype).open=function(t,e){if(this.readyState!=Hn)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,Xn(this)},Z.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||B).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},Z.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Yn(this)),this.readyState=Hn},Z.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Xn(this)),this.g&&(this.readyState=3,Xn(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==B.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Wn(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},Z.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?Yn(this):Xn(this),3==this.readyState&&Wn(this)}},Z.Ua=function(t){this.g&&(this.response=this.responseText=t,Yn(this))},Z.Ta=function(t){this.g&&(this.response=t,Yn(this))},Z.ha=function(){this.g&&Yn(this)},Z.setRequestHeader=function(t,e){this.v.append(t,e)},Z.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},Z.getAllResponseHeaders=function(){if(!this.h)return"";for(var t=[],e=this.h.entries(),n=e.next();!n.done;)t.push((n=n.value)[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(zn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var $n=B.JSON.parse;function tr(t){ee.call(this),this.headers=new un,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=er,this.K=this.L=!1}$(tr,ee);var er="",nr=/^https?$/i,rr=["POST","PUT"];function ir(t){return"content-type"==t.toLowerCase()}function or(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,ar(t),ur(t)}function ar(t){t.D||(t.D=!0,ne(t,"complete"),ne(t,"error"))}function sr(t){if(t.h&&void 0!==j&&(!t.C[1]||4!=hr(t)||2!=t.ba()))if(t.v&&4==hr(t))ye(t.Fa,0,t);else if(ne(t,"readystatechange"),4==hr(t)){t.h=!1;try{var e,n=t.ba();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.H).match(ln)[1]||null;if(!o&&B.self&&B.self.location){var a=B.self.location.protocol;o=a.substr(0,a.length-1)}i=!nr.test(o?o.toLowerCase():"")}e=i}if(e)ne(t,"complete"),ne(t,"success");else{t.m=6;try{var s=2<hr(t)?t.g.statusText:""}catch(u){s=""}t.j=s+" ["+t.ba()+"]",ar(t)}}finally{ur(t)}}}function ur(t,e){if(t.g){cr(t);var n=t.g,r=t.C[0]?G:null;t.g=null,t.C=null,e||ne(t,"ready");try{n.onreadystatechange=r}catch(tp){}}}function cr(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(B.clearTimeout(t.A),t.A=null)}function hr(t){return t.g?t.g.readyState:0}function lr(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case er:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(e){return null}}function fr(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return dt(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):vn(t,e,n))}function dr(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function pr(t){this.za=0,this.l=[],this.h=new Ie,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=dr("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=dr("baseRetryDelayMs",5e3,t),this.$a=dr("retryDelaySeedMs",1e4,t),this.Ya=dr("forwardChannelMaxRetries",2,t),this.ra=dr("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new On(t&&t.concurrentRequestLimit),this.Ca=new Gn,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function gr(t){if(yr(t),3==t.G){var e=t.V++,n=dn(t.F);vn(n,"SID",t.J),vn(n,"RID",e),vn(n,"TYPE","terminate"),Tr(t,n),(e=new Ge(t,t.h,e,void 0)).K=2,e.v=bn(dn(n)),n=!1,B.navigator&&B.navigator.sendBeacon&&(n=B.navigator.sendBeacon(e.v.toString(),"")),!n&&B.Image&&((new Image).src=e.v,n=!0),n||(e.g=qr(e.l,null),e.g.ea(e.v)),e.F=Date.now(),tn(e)}Cr(t)}function mr(t){t.g&&(Er(t),t.g.cancel(),t.g=null)}function yr(t){mr(t),t.u&&(B.clearTimeout(t.u),t.u=null),Sr(t),t.i.cancel(),t.m&&("number"==typeof t.m&&B.clearTimeout(t.m),t.m=null)}function vr(t,e){t.l.push(new Un(t.Za++,e)),3==t.G&&br(t)}function br(t){Pn(t.i)||t.m||(t.m=!0,le(t.Ha,t),t.C=0)}function wr(t,e){var n;n=e?e.m:t.V++;var r=dn(t.F);vn(r,"SID",t.J),vn(r,"RID",n),vn(r,"AID",t.U),Tr(t,r),t.o&&t.s&&fr(r,t.o,t.s),n=new Ge(t,t.h,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=kr(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),Zn(t.i,n),He(n,r,e)}function Tr(t,e){t.j&&sn({},function(t,n){vn(e,n,t)})}function kr(t,e,n){n=Math.min(t.l.length,n);var r=t.j?Y(t.j.Oa,t.j,t):null;t:for(var i=t.l,o=-1;;){var a=["count="+n];-1==o?0<n?a.push("ofs="+(o=i[0].h)):o=0:a.push("ofs="+o);for(var s=!0,u=0;u<n;u++){var c=i[u].h,h=i[u].g;if(0>(c-=o))o=Math.max(0,i[u].h-100),s=!1;else try{Kn(h,a,"req"+c+"_")}catch(di){r&&r(h)}}if(s){r=a.join("&");break t}}return t=t.l.splice(0,n),e.D=t,r}function _r(t){t.g||t.u||(t.Y=1,le(t.Ga,t),t.A=0)}function Ir(t){return!(t.g||t.u||3<=t.A||(t.Y++,t.u=Ue(Y(t.Ga,t),Nr(t,t.A)),t.A++,0))}function Er(t){null!=t.B&&(B.clearTimeout(t.B),t.B=null)}function Ar(t){t.g=new Ge(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=dn(t.oa);vn(e,"RID","rpc"),vn(e,"SID",t.J),vn(e,"CI",t.N?"0":"1"),vn(e,"AID",t.U),Tr(t,e),vn(e,"TYPE","xmlhttp"),t.o&&t.s&&fr(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=bn(dn(e)),n.s=null,n.U=!0,We(n,t)}function Sr(t){null!=t.v&&(B.clearTimeout(t.v),t.v=null)}function Dr(t,e){var n=null;if(t.g==e){Sr(t),Er(t),t.g=null;var r=2}else{if(!Mn(t.i,e))return;n=e.D,Vn(t.i,e),r=1}if(t.I=e.N,0!=t.G)if(e.i)if(1==r){n=e.s?e.s.length:0,e=Date.now()-e.F;var i=t.C;ne(r=De(),new qe(r,n,e,i)),br(t)}else _r(t);else if(3==(i=e.o)||0==i&&0<t.I||!(1==r&&function(t,e){return!(Fn(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.l=e.D.concat(t.l),0):1==t.G||2==t.G||t.C>=(t.Xa?0:t.Ya)||(t.m=Ue(Y(t.Ha,t,e),Nr(t,t.C)),t.C++,0)))}(t,e)||2==r&&Ir(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),i){case 1:xr(t,5);break;case 4:xr(t,10);break;case 3:xr(t,6);break;default:xr(t,2)}}function Nr(t,e){var n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function xr(t,e){if(t.h.info("Error code "+e),2==e){var n=null;t.j&&(n=null);var r=Y(t.jb,t);n||(n=new fn("//www.google.com/images/cleardot.gif"),B.location&&"http"==B.location.protocol||pn(n,"https"),bn(n)),function(t,e){var n=new Ie;if(B.Image){var r=new Image;r.onload=X(Jn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=X(Jn,n,r,"TestLoadImage: error",!1,e),r.onabort=X(Jn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=X(Jn,n,r,"TestLoadImage: timeout",!1,e),B.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else Re(2);t.G=0,t.j&&t.j.va(e),Cr(t),yr(t)}function Cr(t){t.G=0,t.I=-1,t.j&&(0==jn(t.i).length&&0==t.l.length||(t.i.i.length=0,ot(t.l),t.l.length=0),t.j.ua())}function Rr(t,e,n){var r=function(t){return t instanceof fn?dn(t):new fn(t,void 0)}(n);if(""!=r.i)e&&gn(r,e+"."+r.i),mn(r,r.m);else{var i=B.location;r=function(t,e,n,r){var i=new fn(null,void 0);return t&&pn(i,t),e&&gn(i,e),n&&mn(i,n),r&&(i.l=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.aa&&dt(t.aa,function(t,e){vn(r,e,t)}),n=t.sa,(e=t.D)&&n&&vn(r,e,n),vn(r,"VER",t.ma),Tr(t,r),r}function qr(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new tr(n&&t.Ba&&!t.qa?new Qn({ib:!0}):t.qa)).L=t.H,e}function Ur(){}function Or(){if(Tt&&!(10<=Number(Ct)))throw Error("Environmental error: no available transport.")}function Lr(t,e){ee.call(this),this.g=new pr(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!at(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!at(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new Mr(this)}function Pr(t){Ve.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Fr(){je.call(this),this.status=1}function Mr(t){this.g=t}(Z=tr.prototype).ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Me.g(),this.C=function(t){return t.h||(t.h=t.i())}(this.u?this.u:Me),this.g.onreadystatechange=Y(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(o){return void or(this,o)}t=n||"";var i=new un(this.headers);r&&sn(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=ir,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.T()),n=B.FormData&&t instanceof B.FormData,!(0<=nt(rr,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.g.setRequestHeader(e,t)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{cr(this),0<this.B&&((this.K=function(t){return Tt&&function(){return t=xt,Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=function(){for(var t=0,e=ut(String(vt)).split("."),n=ut("9").split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",a=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;t=ht(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||ht(0==o[2].length,0==a[2].length)||ht(o[2],a[2]),o=o[3],a=a[3]}while(0==t)}return 0<=t}();var t}()&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Y(this.pa,this)):this.A=ye(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(o){or(this,o)}},Z.pa=function(){void 0!==j&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,ne(this,"timeout"),this.abort(8))},Z.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,ne(this,"complete"),ne(this,"abort"),ur(this))},Z.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),ur(this,!0)),tr.Z.M.call(this)},Z.Fa=function(){this.s||(this.F||this.v||this.l?sr(this):this.cb())},Z.cb=function(){sr(this)},Z.ba=function(){try{return 2<hr(this)?this.g.status:-1}catch(bt){return-1}},Z.ga=function(){try{return this.g?this.g.responseText:""}catch(bt){return""}},Z.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),$n(e)}},Z.Da=function(){return this.m},Z.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(Z=pr.prototype).ma=8,Z.G=1,Z.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(e){}},Z.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;var e=new Ge(this,this.h,t,void 0),n=this.s;if(this.P&&(n?mt(n=pt(n),this.P):n=this.P),null===this.o&&(e.H=n),this.ja)t:{for(var r=0,i=0;i<this.l.length;i++){var o=this.l[i];if(void 0===(o="__data__"in o.g&&"string"==typeof(o=o.g.__data__)?o.length:void 0))break;if(4096<(r+=o)){r=i;break t}if(4096===r||i===this.l.length-1){r=i+1;break t}}r=1e3}else r=1e3;r=kr(this,e,r),vn(i=dn(this.F),"RID",t),vn(i,"CVER",22),this.D&&vn(i,"X-HTTP-Session-Id",this.D),Tr(this,i),this.o&&n&&fr(i,this.o,n),Zn(this.i,e),this.Ra&&vn(i,"TYPE","init"),this.ja?(vn(i,"$req",r),vn(i,"SID","null"),e.$=!0,He(e,i,null)):He(e,i,r),this.G=2}}else 3==this.G&&(t?wr(this,t):0==this.l.length||Pn(this.i)||wr(this))},Z.Ga=function(){if(this.u=null,Ar(this),this.$&&!(this.L||null==this.g||0>=this.O)){var t=2*this.O;this.h.info("BP detection timer enabled: "+t),this.B=Ue(Y(this.bb,this),t)}},Z.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,Re(10),mr(this),Ar(this))},Z.ab=function(){null!=this.v&&(this.v=null,mr(this),Ir(this),Re(19))},Z.jb=function(t){t?(this.h.info("Successfully pinged google.com"),Re(2)):(this.h.info("Failed to ping google.com"),Re(1))},(Z=Ur.prototype).xa=function(){},Z.wa=function(){},Z.va=function(){},Z.ua=function(){},Z.Oa=function(){},Or.prototype.g=function(t,e){return new Lr(t,e)},$(Lr,ee),Lr.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),le(Y(t.hb,t,e))),Re(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=Rr(t,null,t.W),br(t)},Lr.prototype.close=function(){gr(this.g)},Lr.prototype.u=function(t){if("string"==typeof t){var e={};e.__data__=t,vr(this.g,e)}else this.v?((e={}).__data__=ie(t),vr(this.g,e)):vr(this.g,t)},Lr.prototype.M=function(){this.g.j=null,delete this.j,gr(this.g),delete this.g,Lr.Z.M.call(this)},$(Pr,Ve),$(Fr,je),$(Mr,Ur),Mr.prototype.xa=function(){ne(this.g,"a")},Mr.prototype.wa=function(t){ne(this.g,new Pr(t))},Mr.prototype.va=function(t){ne(this.g,new Fr(t))},Mr.prototype.ua=function(){ne(this.g,"b")},Or.prototype.createWebChannel=Or.prototype.g,Lr.prototype.send=Lr.prototype.u,Lr.prototype.open=Lr.prototype.m,Lr.prototype.close=Lr.prototype.close,Oe.NO_ERROR=0,Oe.TIMEOUT=8,Oe.HTTP_ERROR=6,Le.COMPLETE="complete",Fe.EventType=Ze,Ze.OPEN="a",Ze.CLOSE="b",Ze.ERROR="c",Ze.MESSAGE="d",ee.prototype.listen=ee.prototype.N,tr.prototype.listenOnce=tr.prototype.O,tr.prototype.getLastError=tr.prototype.La,tr.prototype.getLastErrorCode=tr.prototype.Da,tr.prototype.getStatus=tr.prototype.ba,tr.prototype.getResponseJson=tr.prototype.Qa,tr.prototype.getResponseText=tr.prototype.ga,tr.prototype.send=tr.prototype.ea;var Zr=Oe,Vr=Le,jr=Ae,Br=Qn,Gr=Fe,Kr=tr,Jr=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();Jr.o=-1;var Qr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},zr=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return(0,O.ZT)(e,t),e}(Error),Hr=new P.Yd("@firebase/firestore");function Wr(){return Hr.logLevel}function Yr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Hr.logLevel<=P.in.DEBUG){var r=e.map(ti);Hr.debug.apply(Hr,(0,O.ev)(["Firestore (8.7.0): "+t],r))}}function Xr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Hr.logLevel<=P.in.ERROR){var r=e.map(ti);Hr.error.apply(Hr,(0,O.ev)(["Firestore (8.7.0): "+t],r))}}function $r(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Hr.logLevel<=P.in.WARN){var r=e.map(ti);Hr.warn.apply(Hr,(0,O.ev)(["Firestore (8.7.0): "+t],r))}}function ti(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(tp){return t}}function ei(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.7.0) INTERNAL ASSERTION FAILED: "+t;throw Xr(e),new Error(e)}function ni(t,e){t||ei()}function ri(t,e){return t}function ii(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var oi=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=ii(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function ai(t,e){return t<e?-1:t>e?1:0}function si(t,e,n){return t.length===e.length&&t.every(function(t,r){return n(t,e[r])})}function ui(t){return t+"\0"}var ci=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new zr(Qr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new zr(Qr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new zr(Qr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new zr(Qr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,Math.floor(1e6*(e-1e3*n)))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?ai(this.nanoseconds,t.nanoseconds):ai(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),hi=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new ci(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}();function li(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function fi(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function di(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var pi=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&ei(),void 0===n?n=t.length-e:n>t.length-e&&ei(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(function(t){n.push(t)}):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),gi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,O.ZT)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var a=o[i];if(a.indexOf("//")>=0)throw new zr(Qr.INVALID_ARGUMENT,"Invalid segment ("+a+"). Paths must not contain // in them.");r.push.apply(r,a.split("/").filter(function(t){return t.length>0}))}return new e(r)},e.emptyPath=function(){return new e([])},e}(pi),mi=/^[_a-zA-Z][_a-zA-Z0-9]*$/,yi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,O.ZT)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return mi.test(t)},e.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new zr(Qr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},a=!1;i<t.length;){var s=t[i];if("\\"===s){if(i+1===t.length)throw new zr(Qr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new zr(Qr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===s?(a=!a,i++):"."!==s||a?(r+=s,i++):(o(),i++)}if(o(),a)throw new zr(Qr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.emptyPath=function(){return new e([])},e}(pi),vi=function(){function t(t){this.fields=t,t.sort(yi.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return si(this.fields,t.fields,function(t,e){return t.isEqual(e)})},t}(),bi=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return btoa(this.binaryString)},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return ai(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();bi.EMPTY_BYTE_STRING=new bi("");var wi=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ti(t){if(ni(!!t),"string"==typeof t){var e=0,n=wi.exec(t);if(ni(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:ki(t.seconds),nanos:ki(t.nanos)}}function ki(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function _i(t){return"string"==typeof t?bi.fromBase64String(t):bi.fromUint8Array(t)}function Ii(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Ei(t){var e=t.mapValue.fields.__previous_value__;return Ii(e)?Ei(e):e}function Ai(t){var e=Ti(t.mapValue.fields.__local_write_time__.timestampValue);return new ci(e.seconds,e.nanos)}function Si(t){return null==t}function Di(t){return 0===t&&1/t==-1/0}function Ni(t){return"number"==typeof t&&Number.isInteger(t)&&!Di(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var xi=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(gi.fromString(e))},t.fromName=function(e){return new t(gi.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===gi.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return gi.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new gi(e.slice()))},t}();function Ci(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Ii(t)?4:10:ei()}function Ri(t,e){var n=Ci(t);if(n!==Ci(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Ai(t).isEqual(Ai(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=Ti(t.timestampValue),r=Ti(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return _i(t.bytesValue).isEqual(_i(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return ki(t.geoPointValue.latitude)===ki(e.geoPointValue.latitude)&&ki(t.geoPointValue.longitude)===ki(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return ki(t.integerValue)===ki(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=ki(t.doubleValue),r=ki(e.doubleValue);return n===r?Di(n)===Di(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return si(t.arrayValue.values||[],e.arrayValue.values||[],Ri);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(li(n)!==li(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Ri(n[i],r[i])))return!1;return!0}(t,e);default:return ei()}}function qi(t,e){return void 0!==(t.values||[]).find(function(t){return Ri(t,e)})}function Ui(t,e){var n=Ci(t),r=Ci(e);if(n!==r)return ai(n,r);switch(n){case 0:return 0;case 1:return ai(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=ki(t.integerValue||t.doubleValue),r=ki(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Oi(t.timestampValue,e.timestampValue);case 4:return Oi(Ai(t),Ai(e));case 5:return ai(t.stringValue,e.stringValue);case 6:return function(t,e){var n=_i(t),r=_i(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=ai(n[i],r[i]);if(0!==o)return o}return ai(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=ai(ki(t.latitude),ki(e.latitude));return 0!==n?n:ai(ki(t.longitude),ki(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=Ui(n[i],r[i]);if(o)return o}return ai(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var a=0;a<r.length&&a<o.length;++a){var s=ai(r[a],o[a]);if(0!==s)return s;var u=Ui(n[r[a]],i[o[a]]);if(0!==u)return u}return ai(r.length,o.length)}(t.mapValue,e.mapValue);default:throw ei()}}function Oi(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return ai(t,e);var n=Ti(t),r=Ti(e),i=ai(n.seconds,r.seconds);return 0!==i?i:ai(n.nanos,r.nanos)}function Li(t){return Pi(t)}function Pi(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){var e=Ti(t);return"time("+e.seconds+","+e.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?_i(t.bytesValue).toBase64():"referenceValue"in t?xi.fromName(t.referenceValue).toString():"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=Pi(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+Pi(t.fields[o])}return e+"}"}(t.mapValue):ei();var e}function Fi(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function Mi(t){return!!t&&"integerValue"in t}function Zi(t){return!!t&&"arrayValue"in t}function Vi(t){return!!t&&"nullValue"in t}function ji(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Bi(t){return!!t&&"mapValue"in t}function Gi(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue)return{timestampValue:Object.assign({},Ti(t.timestampValue))};if(t.mapValue){var e={mapValue:{fields:{}}};return fi(t.mapValue.fields,function(t,n){return e.mapValue.fields[t]=Gi(n)}),e}if(t.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(t.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=Gi(t.arrayValue.values[r]);return n}return Object.assign({},t)}var Ki=function(){function t(t){this.value=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.isEmpty())return this.value;for(var e=this.value,n=0;n<t.length-1;++n)if(!Bi(e=(e.mapValue.fields||{})[t.get(n)]))return null;return(e=(e.mapValue.fields||{})[t.lastSegment()])||null},t.prototype.set=function(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Gi(e)},t.prototype.setAll=function(t){var e=this,n=yi.emptyPath(),r={},i=[];t.forEach(function(t,o){if(!n.isImmediateParentOf(o)){var a=e.getFieldsMap(n);e.applyChanges(a,r,i),r={},i=[],n=o.popLast()}t?r[o.lastSegment()]=Gi(t):i.push(o.lastSegment())});var o=this.getFieldsMap(n);this.applyChanges(o,r,i)},t.prototype.delete=function(t){var e=this.field(t.popLast());Bi(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]},t.prototype.isEqual=function(t){return Ri(this.value,t.value)},t.prototype.getFieldsMap=function(t){var e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(var n=0;n<t.length;++n){var r=e.mapValue.fields[t.get(n)];Bi(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields},t.prototype.applyChanges=function(t,e,n){fi(e,function(e,n){return t[e]=n});for(var r=0,i=n;r<i.length;r++)delete t[i[r]]},t.prototype.clone=function(){return new t(Gi(this.value))},t}();function Ji(t){var e=[];return fi(t.fields,function(t,n){var r=new yi([t]);if(Bi(n)){var i=Ji(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,a=i;o<a.length;o++)e.push(r.child(a[o]))}else e.push(r)}),new vi(e)}var Qi=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,hi.min(),Ki.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,Ki.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,Ki.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=Ki.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=Ki.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},t}(),zi=function(t,e,n,r,i,o,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.h=null};function Hi(t,e,n,r,i,o,a){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),new zi(t,e,n,r,i,o,a)}function Wi(t){var e=ri(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(function(t){return function(t){return t.field.canonicalString()+t.op.toString()+Li(t.value)}(t)}).join(","),n+="|ob:",n+=e.orderBy.map(function(t){return function(t){return t.field.canonicalString()+t.dir}(t)}).join(","),Si(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=co(e.startAt)),e.endAt&&(n+="|ub:",n+=co(e.endAt)),e.h=n}return e.h}function Yi(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!lo(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if((i=t.filters[r]).op!==(o=e.filters[r]).op||!i.field.isEqual(o.field)||!Ri(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!po(t.startAt,e.startAt)&&po(t.endAt,e.endAt)}function Xi(t){return xi.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var $i=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return(0,O.ZT)(e,t),e.create=function(t,n,r){return t.isKeyField()?"in"===n||"not-in"===n?this.l(t,n,r):new to(t,n,r):"array-contains"===n?new io(t,r):"in"===n?new oo(t,r):"not-in"===n?new ao(t,r):"array-contains-any"===n?new so(t,r):new e(t,n,r)},e.l=function(t,e,n){return"in"===e?new eo(t,n):new no(t,n)},e.prototype.matches=function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(Ui(e,this.value)):null!==e&&Ci(this.value)===Ci(e)&&this.m(Ui(e,this.value))},e.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return ei()}},e.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}(function(){}),to=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=xi.fromName(r.referenceValue),i}return(0,O.ZT)(e,t),e.prototype.matches=function(t){var e=xi.comparator(t.key,this.key);return this.m(e)},e}($i),eo=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=ro(0,n),r}return(0,O.ZT)(e,t),e.prototype.matches=function(t){return this.keys.some(function(e){return e.isEqual(t.key)})},e}($i),no=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=ro(0,n),r}return(0,O.ZT)(e,t),e.prototype.matches=function(t){return!this.keys.some(function(e){return e.isEqual(t.key)})},e}($i);function ro(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(t){return xi.fromName(t.referenceValue)})}var io=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return(0,O.ZT)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return Zi(e)&&qi(e.arrayValue,this.value)},e}($i),oo=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return(0,O.ZT)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&qi(this.value.arrayValue,e)},e}($i),ao=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return(0,O.ZT)(e,t),e.prototype.matches=function(t){if(qi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!qi(this.value.arrayValue,e)},e}($i),so=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return(0,O.ZT)(e,t),e.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!Zi(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return qi(e.value.arrayValue,t)})},e}($i),uo=function(t,e){this.position=t,this.before=e};function co(t){return(t.before?"b":"a")+":"+t.position.map(function(t){return Li(t)}).join(",")}var ho=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function lo(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function fo(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],a=t.position[i];if(r=o.field.isKeyField()?xi.comparator(xi.fromName(a.referenceValue),n.key):Ui(a,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function po(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!Ri(t.position[n],e.position[n]))return!1;return!0}var go=function(t,e,n,r,i,o,a,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===a&&(a=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=s,this.p=null,this.T=null};function mo(t,e,n,r,i,o,a,s){return new go(t,e,n,r,i,o,a,s)}function yo(t){return new go(t)}function vo(t){return!Si(t.limit)&&"F"===t.limitType}function bo(t){return!Si(t.limit)&&"L"===t.limitType}function wo(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function To(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function ko(t){return null!==t.collectionGroup}function _o(t){var e=ri(t);if(null===e.p){e.p=[];var n=To(e),r=wo(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new ho(n)),e.p.push(new ho(yi.keyField(),"asc"));else{for(var i=!1,o=0,a=e.explicitOrderBy;o<a.length;o++){var s=a[o];e.p.push(s),s.field.isKeyField()&&(i=!0)}if(!i){var u=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new ho(yi.keyField(),u))}}}return e.p}function Io(t){var e=ri(t);if(!e.T)if("F"===e.limitType)e.T=Hi(e.path,e.collectionGroup,_o(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=_o(e);r<i.length;r++){var o=i[r];n.push(new ho(o.field,"desc"===o.dir?"asc":"desc"))}var a=e.endAt?new uo(e.endAt.position,!e.endAt.before):null,s=e.startAt?new uo(e.startAt.position,!e.startAt.before):null;e.T=Hi(e.path,e.collectionGroup,n,e.filters,e.limit,a,s)}return e.T}function Eo(t,e,n){return new go(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Ao(t,e){return Yi(Io(t),Io(e))&&t.limitType===e.limitType}function So(t){return Wi(Io(t))+"|lt:"+t.limitType}function Do(t){return"Query(target="+function(t){var e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map(function(t){return(e=t).field.canonicalString()+" "+e.op+" "+Li(e.value);var e}).join(", ")+"]"),Si(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map(function(t){return function(t){return t.field.canonicalString()+" ("+t.dir+")"}(t)}).join(", ")+"]"),t.startAt&&(e+=", startAt: "+co(t.startAt)),t.endAt&&(e+=", endAt: "+co(t.endAt)),"Target("+e+")"}(Io(t))+"; limitType="+t.limitType+")"}function No(t,e){return e.isFoundDocument()&&function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):xi.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!fo(t.startAt,_o(t),e)||t.endAt&&fo(t.endAt,_o(t),e))}(t,e)}function xo(t){return function(e,n){for(var r=!1,i=0,o=_o(t);i<o.length;i++){var a=o[i],s=Co(a,e,n);if(0!==s)return s;r=r||a.field.isKeyField()}return 0}}function Co(t,e,n){var r=t.field.isKeyField()?xi.comparator(e.key,n.key):function(t,e,n){var r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?Ui(r,i):ei()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return ei()}}function Ro(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Di(e)?"-0":e}}function qo(t){return{integerValue:""+t}}function Uo(t,e){return Ni(e)?qo(e):Ro(t,e)}var Oo=function(){this._=void 0};function Lo(t,e,n){return t instanceof Mo?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Zo?Vo(t,e):t instanceof jo?Bo(t,e):function(t,e){var n=Fo(t,e),r=Ko(n)+Ko(t.A);return Mi(n)&&Mi(t.A)?qo(r):Ro(t.R,r)}(t,e)}function Po(t,e,n){return t instanceof Zo?Vo(t,e):t instanceof jo?Bo(t,e):n}function Fo(t,e){return t instanceof Go?Mi(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var Mo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,O.ZT)(e,t),e}(Oo),Zo=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return(0,O.ZT)(e,t),e}(Oo);function Vo(t,e){for(var n=Jo(e),r=function(t){n.some(function(e){return Ri(e,t)})||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var jo=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return(0,O.ZT)(e,t),e}(Oo);function Bo(t,e){for(var n=Jo(e),r=function(t){n=n.filter(function(e){return!Ri(e,t)})},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Go=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).R=e,r.A=n,r}return(0,O.ZT)(e,t),e}(Oo);function Ko(t){return ki(t.integerValue||t.doubleValue)}function Jo(t){return Zi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var Qo=function(t,e){this.field=t,this.transform=e},zo=function(t,e){this.version=t,this.transformResults=e},Ho=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function Wo(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var Yo=function(){};function Xo(t,e,n){t instanceof ra?function(t,e,n){var r=t.value.clone(),i=aa(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof ia?function(t,e,n){if(Wo(t.precondition,e)){var r=aa(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(oa(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function $o(t,e,n){t instanceof ra?function(t,e,n){if(Wo(t.precondition,e)){var r=t.value.clone(),i=sa(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(na(e),r).setHasLocalMutations()}}(t,e,n):t instanceof ia?function(t,e,n){if(Wo(t.precondition,e)){var r=sa(t.fieldTransforms,n,e),i=e.data;i.setAll(oa(t)),i.setAll(r),e.convertToFoundDocument(na(e),i).setHasLocalMutations()}}(t,e,n):function(t,e){Wo(t.precondition,e)&&e.convertToNoDocument(hi.min())}(t,e)}function ta(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],a=e.data.field(o.field),s=Fo(o.transform,a||null);null!=s&&(null==n&&(n=Ki.empty()),n.set(o.field,s))}return n||null}function ea(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&si(t,e,function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Zo&&e instanceof Zo||t instanceof jo&&e instanceof jo?si(t.elements,e.elements,Ri):t instanceof Go&&e instanceof Go?Ri(t.A,e.A):t instanceof Mo&&e instanceof Mo}(t.transform,e.transform)}(t,e)})}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function na(t){return t.isFoundDocument()?t.version:hi.min()}var ra=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return(0,O.ZT)(e,t),e}(Yo),ia=function(t){function e(e,n,r,i,o){void 0===o&&(o=[]);var a=this;return(a=t.call(this)||this).key=e,a.data=n,a.fieldMask=r,a.precondition=i,a.fieldTransforms=o,a.type=1,a}return(0,O.ZT)(e,t),e}(Yo);function oa(t){var e=new Map;return t.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}}),e}function aa(t,e,n){var r=new Map;ni(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],a=o.transform,s=e.data.field(o.field);r.set(o.field,Po(a,s,n[i]))}return r}function sa(t,e,n){for(var r=new Map,i=0,o=t;i<o.length;i++){var a=o[i],s=a.transform,u=n.data.field(a.field);r.set(a.field,Lo(s,u,e))}return r}var ua,ca,ha=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return(0,O.ZT)(e,t),e}(Yo),la=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return(0,O.ZT)(e,t),e}(Yo),fa=function(t){this.count=t};function da(t){switch(t){case Qr.OK:return ei();case Qr.CANCELLED:case Qr.UNKNOWN:case Qr.DEADLINE_EXCEEDED:case Qr.RESOURCE_EXHAUSTED:case Qr.INTERNAL:case Qr.UNAVAILABLE:case Qr.UNAUTHENTICATED:return!1;case Qr.INVALID_ARGUMENT:case Qr.NOT_FOUND:case Qr.ALREADY_EXISTS:case Qr.PERMISSION_DENIED:case Qr.FAILED_PRECONDITION:case Qr.ABORTED:case Qr.OUT_OF_RANGE:case Qr.UNIMPLEMENTED:case Qr.DATA_LOSS:return!0;default:return ei()}}function pa(t){if(void 0===t)return Xr("GRPC error has no .code"),Qr.UNKNOWN;switch(t){case ua.OK:return Qr.OK;case ua.CANCELLED:return Qr.CANCELLED;case ua.UNKNOWN:return Qr.UNKNOWN;case ua.DEADLINE_EXCEEDED:return Qr.DEADLINE_EXCEEDED;case ua.RESOURCE_EXHAUSTED:return Qr.RESOURCE_EXHAUSTED;case ua.INTERNAL:return Qr.INTERNAL;case ua.UNAVAILABLE:return Qr.UNAVAILABLE;case ua.UNAUTHENTICATED:return Qr.UNAUTHENTICATED;case ua.INVALID_ARGUMENT:return Qr.INVALID_ARGUMENT;case ua.NOT_FOUND:return Qr.NOT_FOUND;case ua.ALREADY_EXISTS:return Qr.ALREADY_EXISTS;case ua.PERMISSION_DENIED:return Qr.PERMISSION_DENIED;case ua.FAILED_PRECONDITION:return Qr.FAILED_PRECONDITION;case ua.ABORTED:return Qr.ABORTED;case ua.OUT_OF_RANGE:return Qr.OUT_OF_RANGE;case ua.UNIMPLEMENTED:return Qr.UNIMPLEMENTED;case ua.DATA_LOSS:return Qr.DATA_LOSS;default:return ei()}}(ca=ua||(ua={}))[ca.OK=0]="OK",ca[ca.CANCELLED=1]="CANCELLED",ca[ca.UNKNOWN=2]="UNKNOWN",ca[ca.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ca[ca.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ca[ca.NOT_FOUND=5]="NOT_FOUND",ca[ca.ALREADY_EXISTS=6]="ALREADY_EXISTS",ca[ca.PERMISSION_DENIED=7]="PERMISSION_DENIED",ca[ca.UNAUTHENTICATED=16]="UNAUTHENTICATED",ca[ca.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ca[ca.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ca[ca.ABORTED=10]="ABORTED",ca[ca.OUT_OF_RANGE=11]="OUT_OF_RANGE",ca[ca.UNIMPLEMENTED=12]="UNIMPLEMENTED",ca[ca.INTERNAL=13]="INTERNAL",ca[ca.UNAVAILABLE=14]="UNAVAILABLE",ca[ca.DATA_LOSS=15]="DATA_LOSS";var ga=function(){function t(t,e){this.comparator=t,this.root=e||ya.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,ya.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ya.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal(function(e,n){return t(e,n),!1})},t.prototype.toString=function(){var t=[];return this.inorderTraversal(function(e,n){return t.push(e+":"+n),!1}),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new ma(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new ma(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new ma(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new ma(this.root,t,this.comparator,!0)},t}(),ma=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),ya=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw ei();if(this.right.isRed())throw ei();var t=this.left.check();if(t!==this.right.check())throw ei();return t+(this.isRed()?0:1)},t}();ya.EMPTY=null,ya.RED=!0,ya.BLACK=!1,ya.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw ei()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw ei()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw ei()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw ei()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw ei()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new ya(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());var va=function(){function t(t){this.comparator=t,this.data=new ga(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new ba(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new ba(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},t.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),ba=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),wa=new ga(xi.comparator);function Ta(){return wa}var ka=new ga(xi.comparator);function _a(){return ka}var Ia=new ga(xi.comparator);function Ea(){return Ia}var Aa=new va(xi.comparator);function Sa(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Aa,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Da=new va(ai);function Na(){return Da}var xa=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,Ca.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(hi.min(),r,Na(),Ta(),Sa())},t}(),Ca=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(bi.EMPTY_BYTE_STRING,n,Sa(),Sa(),Sa())},t}(),Ra=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},qa=function(t,e){this.targetId=t,this.V=e},Ua=function(t,e,n,r){void 0===n&&(n=bi.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},Oa=function(){function t(){this.S=0,this.D=Fa(),this.C=bi.EMPTY_BYTE_STRING,this.N=!1,this.F=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"k",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"$",{get:function(){return this.F},enumerable:!1,configurable:!0}),t.prototype.O=function(t){t.approximateByteSize()>0&&(this.F=!0,this.C=t)},t.prototype.M=function(){var t=Sa(),e=Sa(),n=Sa();return this.D.forEach(function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:ei()}}),new Ca(this.C,this.N,t,e,n)},t.prototype.L=function(){this.F=!1,this.D=Fa()},t.prototype.B=function(t,e){this.F=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.F=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.F=!0,this.N=!0},t}(),La=function(){function t(t){this.W=t,this.G=new Map,this.H=Ta(),this.J=Pa(),this.Y=new va(ai)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)this.tt(r=o[i],t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.O(t.resumeToken);break;case 1:r.K(),r.k||r.L(),r.O(t.resumeToken);break;case 2:r.K(),r.k||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.O(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.O(t.resumeToken));break;default:ei()}})},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach(function(t,r){n.st(r)&&e(r)})},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if(Xi(i))if(0===n){var o=new xi(i.path);this.tt(e,o,Qi.newNoDocument(o,hi.min()))}else ni(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.ut=function(t){var e=this,n=new Map;this.G.forEach(function(r,i){var o=e.ot(i);if(o){if(r.current&&Xi(o.target)){var a=new xi(o.target.path);null!==e.H.get(a)||e.at(i,a)||e.tt(i,a,Qi.newNoDocument(a,t))}r.$&&(n.set(i,r.M()),r.L())}});var r=Sa();this.J.forEach(function(t,n){var i=!0;n.forEachWhile(function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)}),i&&(r=r.add(t))});var i=new xa(t,n,this.Y,this.H,r);return this.H=Ta(),this.J=Pa(),this.Y=new va(ai),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new Oa,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new va(ai),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||Yr("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.k?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new Oa),this.W.getRemoteKeysForTarget(t).forEach(function(n){e.tt(t,n,null)})},t.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function Pa(){return new ga(xi.comparator)}function Fa(){return new ga(xi.comparator)}var Ma={asc:"ASCENDING",desc:"DESCENDING"},Za={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Va=function(t,e){this.databaseId=t,this.I=e};function ja(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function Ba(t,e){return t.I?e.toBase64():e.toUint8Array()}function Ga(t,e){return ja(t,e.toTimestamp())}function Ka(t){return ni(!!t),hi.fromTimestamp(function(t){var e=Ti(t);return new ci(e.seconds,e.nanos)}(t))}function Ja(t,e){return function(t){return new gi(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function Qa(t){var e=gi.fromString(t);return ni(ys(e)),e}function za(t,e){return Ja(t.databaseId,e.path)}function Ha(t,e){var n=Qa(e);if(n.get(1)!==t.databaseId.projectId)throw new zr(Qr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new zr(Qr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new xi($a(n))}function Wa(t,e){return Ja(t.databaseId,e)}function Ya(t){var e=Qa(t);return 4===e.length?gi.emptyPath():$a(e)}function Xa(t){return new gi(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function $a(t){return ni(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function ts(t,e,n){return{name:za(t,e),fields:n.value.mapValue.fields}}function es(t,e,n){var r=Ha(t,e.name),i=Ka(e.updateTime),o=new Ki({mapValue:{fields:e.fields}}),a=Qi.newFoundDocument(r,i,o);return n&&a.setHasCommittedMutations(),n?a.setHasCommittedMutations():a}function ns(t,e){var n;if(e instanceof ra)n={update:ts(t,e.key,e.value)};else if(e instanceof ha)n={delete:za(t,e.key)};else if(e instanceof ia)n={update:ts(t,e.key,e.data),updateMask:ms(e.fieldMask)};else{if(!(e instanceof la))return ei();n={verify:za(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(function(t){return function(t,e){var n=e.transform;if(n instanceof Mo)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Zo)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof jo)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Go)return{fieldPath:e.field.canonicalString(),increment:n.A};throw ei()}(0,t)})),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Ga(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:ei()}(t,e.precondition)),n}function rs(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?Ho.updateTime(Ka(t.updateTime)):void 0!==t.exists?Ho.exists(t.exists):Ho.none()}(e.currentDocument):Ho.none(),r=e.updateTransforms?e.updateTransforms.map(function(e){return function(t,e){var n=null;"setToServerValue"in e?(ni("REQUEST_TIME"===e.setToServerValue),n=new Mo):"appendMissingElements"in e?n=new Zo(e.appendMissingElements.values||[]):"removeAllFromArray"in e?n=new jo(e.removeAllFromArray.values||[]):"increment"in e?n=new Go(t,e.increment):ei();var r=yi.fromServerFormat(e.fieldPath);return new Qo(r,n)}(t,e)}):[];if(e.update){var i=Ha(t,e.update.name),o=new Ki({mapValue:{fields:e.update.fields}});if(e.updateMask){var a=function(t){return new vi((t.fieldPaths||[]).map(function(t){return yi.fromServerFormat(t)}))}(e.updateMask);return new ia(i,o,a,n,r)}return new ra(i,o,n,r)}if(e.delete){var s=Ha(t,e.delete);return new ha(s,n)}if(e.verify){var u=Ha(t,e.verify);return new la(u,n)}return ei()}function is(t,e){return{documents:[Wa(t,e.path)]}}function os(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Wa(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Wa(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map(function(t){return function(t){if("=="===t.op){if(ji(t.value))return{unaryFilter:{field:fs(t.field),op:"IS_NAN"}};if(Vi(t.value))return{unaryFilter:{field:fs(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(ji(t.value))return{unaryFilter:{field:fs(t.field),op:"IS_NOT_NAN"}};if(Vi(t.value))return{unaryFilter:{field:fs(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:fs(t.field),op:ls(t.op),value:t.value}}}(t)});return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map(function(t){return function(t){return{field:fs(t.field),direction:hs(t.dir)}}(t)})}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var a=function(t,e){return t.I||Si(e)?e:{value:e}}(t,e.limit);return null!==a&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=us(e.startAt)),e.endAt&&(n.structuredQuery.endAt=us(e.endAt)),n}function as(t){var e=Ya(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){ni(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var a=[];n.where&&(a=ss(n.where));var s=[];n.orderBy&&(s=n.orderBy.map(function(t){return function(t){return new ho(ds(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)}));var u=null;n.limit&&(u=function(t){var e;return Si(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=cs(n.startAt));var h=null;return n.endAt&&(h=cs(n.endAt)),mo(e,i,s,a,u,"F",c,h)}function ss(t){return t?void 0!==t.unaryFilter?[gs(t)]:void 0!==t.fieldFilter?[ps(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return ss(t)}).reduce(function(t,e){return t.concat(e)}):ei():[]}function us(t){return{before:t.before,values:t.position}}function cs(t){return new uo(t.values||[],!!t.before)}function hs(t){return Ma[t]}function ls(t){return Za[t]}function fs(t){return{fieldPath:t.canonicalString()}}function ds(t){return yi.fromServerFormat(t.fieldPath)}function ps(t){return $i.create(ds(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return ei()}}(t.fieldFilter.op),t.fieldFilter.value)}function gs(t){switch(t.unaryFilter.op){case"IS_NAN":var e=ds(t.unaryFilter.field);return $i.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=ds(t.unaryFilter.field);return $i.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=ds(t.unaryFilter.field);return $i.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=ds(t.unaryFilter.field);return $i.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return ei()}}function ms(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}}function ys(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function vs(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=ws(e)),e=bs(t.get(n),e);return ws(e)}function bs(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}function ws(t){return t+"\x01\x01"}function Ts(t){var e=t.length;if(ni(e>=2),2===e)return ni("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),gi.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var a=t.indexOf("\x01",o);switch((a<0||a>n)&&ei(),t.charAt(a+1)){case"\x01":var s=t.substring(o,a),u=void 0;0===i.length?u=s:(u=i+=s,i=""),r.push(u);break;case"\x10":i+=t.substring(o,a),i+="\0";break;case"\x11":i+=t.substring(o,a+1);break;default:ei()}o=a+2}return new gi(r)}var ks=function(t,e){this.seconds=t,this.nanoseconds=e},_s=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};_s.store="owner",_s.key="owner";var Is=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};Is.store="mutationQueues",Is.keyPath="userId";var Es=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Es.store="mutations",Es.keyPath="batchId",Es.userMutationsIndex="userMutationsIndex",Es.userMutationsKeyPath=["userId","batchId"];var As=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,vs(e)]},t.key=function(t,e,n){return[t,vs(e),n]},t}();As.store="documentMutations",As.PLACEHOLDER=new As;var Ss=function(t,e){this.path=t,this.readTime=e},Ds=function(t,e){this.path=t,this.version=e},Ns=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Ns.store="remoteDocuments",Ns.readTimeIndex="readTimeIndex",Ns.readTimeIndexPath="readTime",Ns.collectionReadTimeIndex="collectionReadTimeIndex",Ns.collectionReadTimeIndexPath=["parentPath","readTime"];var xs=function(t){this.byteSize=t};xs.store="remoteDocumentGlobal",xs.key="remoteDocumentGlobalKey";var Cs=function(t,e,n,r,i,o,a){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=a};Cs.store="targets",Cs.keyPath="targetId",Cs.queryTargetsIndexName="queryTargetsIndex",Cs.queryTargetsKeyPath=["canonicalId","targetId"];var Rs=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Rs.store="targetDocuments",Rs.keyPath=["targetId","path"],Rs.documentTargetsIndex="documentTargetsIndex",Rs.documentTargetsKeyPath=["path","targetId"];var qs=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};qs.key="targetGlobalKey",qs.store="targetGlobal";var Us=function(t,e){this.collectionId=t,this.parent=e};Us.store="collectionParents",Us.keyPath=["collectionId","parent"];var Os=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Os.store="clientMetadata",Os.keyPath="clientId";var Ls=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};Ls.store="bundles",Ls.keyPath="bundleId";var Ps=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};Ps.store="namedQueries",Ps.keyPath="name";var Fs=(0,O.ev)((0,O.ev)([],(0,O.ev)((0,O.ev)([],(0,O.ev)((0,O.ev)([],(0,O.ev)((0,O.ev)([],[Is.store,Es.store,As.store,Ns.store,Cs.store,_s.store,qs.store,Rs.store]),[Os.store])),[xs.store])),[Us.store])),[Ls.store,Ps.store]),Ms="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Zs=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},t}(),Vs=function(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})},js=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&ei(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t(function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}})},t.prototype.toPromise=function(){var t=this;return new Promise(function(e,n){t.next(e,n)})},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.reject(n)},t.resolve=function(e){return new t(function(t,n){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.waitFor=function(e){return new t(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(t){return n(t)})}),o=!0,i===r&&t()})},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next(function(n){return n?t.resolve(n):e()})},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach(function(t,i){r.push(e.call(n,t,i))}),this.waitFor(r)},t}(),Bs=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new Vs,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new Js(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=Ys(e.target.error);n.ft.reject(new Js(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new Js(n,e)}},Object.defineProperty(t.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(Yr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new zs(e)},t}(),Gs=function(){function t(e,n,r){this.name=e,this.version=n,this.wt=r,12.2===t._t((0,L.z$)())&&Xr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return Yr("SimpleDb","Removing database:",t),Hs(window.indexedDB.deleteDatabase(t)).toPromise()},t.yt=function(){if("undefined"==typeof indexedDB)return!1;if(t.gt())return!0;var e=(0,L.z$)(),n=t._t(e),r=0<n&&n<10,i=t.Et(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)},t.gt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)},t.It=function(t,e){return t.store(e)},t._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.Et=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.At=function(t){return(0,O.mG)(this,void 0,void 0,function(){var e,n=this;return(0,O.Jh)(this,function(r){switch(r.label){case 0:return this.db?[3,2]:(Yr("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){e(t.target.result)},i.onblocked=function(){r(new Js(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;r("VersionError"===n.name?new zr(Qr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):new Js(t,n))},i.onupgradeneeded=function(t){Yr("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion),n.wt.Rt(t.target.result,i.transaction,t.oldVersion,n.version).next(function(){Yr("SimpleDb","Database upgrade to version "+n.version+" complete")})}})]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return n.bt(t)}),this.db)]}})})},t.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,n,r){return(0,O.mG)(this,void 0,void 0,function(){var i,o,a,s,u;return(0,O.Jh)(this,function(c){switch(c.label){case 0:i="readonly"===e,o=0,a=function(){var e,a,u,c,h;return(0,O.Jh)(this,function(l){switch(l.label){case 0:++o,l.label=1;case 1:return l.trys.push([1,4,,5]),[4,s.At(t)];case 2:return s.db=l.sent(),e=Bs.open(s.db,t,i?"readonly":"readwrite",n),a=r(e).catch(function(t){return e.abort(t),js.reject(t)}).toPromise(),u={},a.catch(function(){}),[4,e.dt];case 3:return[2,(u.value=(l.sent(),a),u)];case 4:return Yr("SimpleDb","Transaction failed with error:",(c=l.sent()).message,"Retrying:",h="FirebaseError"!==c.name&&o<3),s.close(),h?[3,5]:[2,{value:Promise.reject(c)}];case 5:return[2]}})},s=this,c.label=1;case 1:return[5,a()];case 2:if("object"==typeof(u=c.sent()))return[2,u.value];c.label=3;case 3:return[3,1];case 4:return[2]}})})},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),Ks=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return Hs(this.Pt.delete())},t}(),Js=function(t){function e(e,n){var r=this;return(r=t.call(this,Qr.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return(0,O.ZT)(e,t),e}(zr);function Qs(t){return"IndexedDbTransactionError"===t.name}var zs=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(Yr("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(Yr("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Hs(n)},t.prototype.add=function(t){return Yr("SimpleDb","ADD",this.store.name,t,t),Hs(this.store.add(t))},t.prototype.get=function(t){var e=this;return Hs(this.store.get(t)).next(function(n){return void 0===n&&(n=null),Yr("SimpleDb","GET",e.store.name,t,n),n})},t.prototype.delete=function(t){return Yr("SimpleDb","DELETE",this.store.name,t),Hs(this.store.delete(t))},t.prototype.count=function(){return Yr("SimpleDb","COUNT",this.store.name),Hs(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,function(t,e){r.push(e)}).next(function(){return r})},t.prototype.Ft=function(t,e){Yr("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.kt=!1;var r=this.cursor(n);return this.xt(r,function(t,e,n){return n.delete()})},t.prototype.$t=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.xt(r,e)},t.prototype.Ot=function(t){var e=this.cursor({});return new js(function(n,r){e.onerror=function(t){var e=Ys(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next(function(t){t?r.continue():n()}):n()}})},t.prototype.xt=function(t,e){var n=[];return new js(function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new Ks(i),a=e(i.primaryKey,i.value,o);if(a instanceof js){var s=a.catch(function(t){return o.done(),js.reject(t)});n.push(s)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}}).next(function(){return js.waitFor(n)})},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.kt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function Hs(t){return new js(function(e,n){t.onsuccess=function(t){e(t.target.result)},t.onerror=function(t){var e=Ys(t.target.error);n(e)}})}var Ws=!1;function Ys(t){var e=Gs._t((0,L.z$)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new zr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Ws||(Ws=!0,setTimeout(function(){throw r},0)),r}}return t}var Xs=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Mt=e,r.currentSequenceNumber=n,r}return(0,O.ZT)(e,t),e}(Zs);function $s(t,e){var n=ri(t);return Gs.It(n.Mt,e)}var tu=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&Xo(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(o=n[e]).key.isEqual(t.key)&&$o(o,t,this.localWriteTime);for(var r=0,i=this.mutations;r<i.length;r++){var o;(o=i[r]).key.isEqual(t.key)&&$o(o,t,this.localWriteTime)}},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach(function(n){var r=t.get(n.key),i=r;e.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(hi.min())})},t.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Sa())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&si(this.mutations,t.mutations,function(t,e){return ea(t,e)})&&si(this.baseMutations,t.baseMutations,function(t,e){return ea(t,e)})},t}(),eu=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){ni(e.mutations.length===r.length);for(var i=Ea(),o=e.mutations,a=0;a<o.length;a++)i=i.insert(o[a].key,r[a].version);return new t(e,n,r,i)},t}(),nu=function(){function t(t,e,n,r,i,o,a){void 0===i&&(i=hi.min()),void 0===o&&(o=hi.min()),void 0===a&&(a=bi.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),ru=function(t){this.Lt=t};function iu(t,e){if(e.document)return es(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=xi.fromSegments(e.noDocument.path),r=cu(e.noDocument.readTime),i=Qi.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=xi.fromSegments(e.unknownDocument.path);return r=cu(e.unknownDocument.version),Qi.newUnknownDocument(o,r)}return ei()}function ou(t,e,n){var r=au(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){var o=function(t,e){return{name:za(t,e.key),fields:e.data.value.mapValue.fields,updateTime:ja(t,e.version.toTimestamp())}}(t.Lt,e),a=e.hasCommittedMutations;return new Ns(null,null,o,a,r,i)}if(e.isNoDocument()){var s=e.key.path.toArray(),u=uu(e.version);return a=e.hasCommittedMutations,new Ns(null,new Ss(s,u),null,a,r,i)}if(e.isUnknownDocument()){var c=e.key.path.toArray(),h=uu(e.version);return new Ns(new Ds(c,h),null,null,!0,r,i)}return ei()}function au(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function su(t){var e=new ci(t[0],t[1]);return hi.fromTimestamp(e)}function uu(t){var e=t.toTimestamp();return new ks(e.seconds,e.nanoseconds)}function cu(t){var e=new ci(t.seconds,t.nanoseconds);return hi.fromTimestamp(e)}function hu(t,e){for(var n=(e.baseMutations||[]).map(function(e){return rs(t.Lt,e)}),r=0;r<e.mutations.length-1;++r)r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform&&(e.mutations[r].updateTransforms=e.mutations[r+1].transform.fieldTransforms,e.mutations.splice(r+1,1),++r);var i=e.mutations.map(function(e){return rs(t.Lt,e)}),o=ci.fromMillis(e.localWriteTimeMs);return new tu(e.batchId,o,n,i)}function lu(t){var e,n,r=cu(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?cu(t.lastLimboFreeSnapshotVersion):hi.min();return void 0!==t.query.documents?(ni(1===(n=t.query).documents.length),e=Io(yo(Ya(n.documents[0])))):e=function(t){return Io(as(t))}(t.query),new nu(e,t.targetId,0,t.lastListenSequenceNumber,r,i,bi.fromBase64String(t.resumeToken))}function fu(t,e){var n,r=uu(e.snapshotVersion),i=uu(e.lastLimboFreeSnapshotVersion);n=Xi(e.target)?is(t.Lt,e.target):os(t.Lt,e.target);var o=e.resumeToken.toBase64();return new Cs(e.targetId,Wi(e.target),r,o,e.sequenceNumber,i,n)}function du(t){var e=as({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Eo(e,e.limit,"L"):e}var pu=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return gu(t).get(e).next(function(t){if(t)return{id:(e=t).bundleId,createTime:cu(e.createTime),version:e.version};var e})},t.prototype.saveBundleMetadata=function(t,e){return gu(t).put({bundleId:(n=e).id,createTime:uu(Ka(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return mu(t).get(e).next(function(t){if(t)return{name:(e=t).name,query:du(e.bundledQuery),readTime:cu(e.readTime)};var e})},t.prototype.saveNamedQuery=function(t,e){return mu(t).put(function(t){return{name:t.name,readTime:uu(Ka(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function gu(t){return $s(t,Ls.store)}function mu(t){return $s(t,Ps.store)}var yu=function(){function t(){this.Bt=new vu}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),js.resolve()},t.prototype.getCollectionParents=function(t,e){return js.resolve(this.Bt.getEntries(e))},t}(),vu=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new va(gi.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new va(gi.comparator)).toArray()},t}(),bu=function(){function t(){this.qt=new vu}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(function(){n.qt.add(e)});var o={collectionId:r,parent:vs(i)};return wu(t).put(o)}return js.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[ui(e),""],!1,!0);return wu(t).Nt(r).next(function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(Ts(o.parent))}return n})},t}();function wu(t){return $s(t,Us.store)}var Tu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},ku=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();function _u(t,e,n){var r=t.store(Es.store),i=t.store(As.store),o=[],a=IDBKeyRange.only(n.batchId),s=0,u=r.$t({range:a},function(t,e,n){return s++,n.delete()});o.push(u.next(function(){ni(1===s)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],d=As.key(e,f.key.path,n.batchId);o.push(i.delete(d)),c.push(f.key)}return js.waitFor(o).next(function(){return c})}function Iu(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw ei();e=t.noDocument}return JSON.stringify(e).length}ku.DEFAULT_COLLECTION_PERCENTILE=10,ku.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ku.DEFAULT=new ku(41943040,ku.DEFAULT_COLLECTION_PERCENTILE,ku.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ku.DISABLED=new ku(-1,0,0);var Eu=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Kt={}}return t.Qt=function(e,n,r,i){return ni(""!==e.uid),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Su(t).$t({index:Es.userMutationsIndex,range:n},function(t,n,r){e=!1,r.done()}).next(function(){return e})},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=Du(t),a=Su(t);return a.add({}).next(function(s){ni("number"==typeof s);for(var u=new tu(s,e,n,r),c=function(t,e,n){var r=n.baseMutations.map(function(e){return ns(t.Lt,e)}),i=n.mutations.map(function(e){return ns(t.Lt,e)});return new Es(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.R,i.userId,u),h=[],l=new va(function(t,e){return ai(t.canonicalString(),e.canonicalString())}),f=0,d=r;f<d.length;f++){var p=d[f],g=As.key(i.userId,p.key.path,s);l=l.add(p.key.path.popLast()),h.push(a.put(c)),h.push(o.put(g,As.PLACEHOLDER))}return l.forEach(function(e){h.push(i.Ut.addToCollectionParentIndex(t,e))}),t.addOnCommittedListener(function(){i.Kt[s]=u.keys()}),js.waitFor(h).next(function(){return u})})},t.prototype.lookupMutationBatch=function(t,e){var n=this;return Su(t).get(e).next(function(t){return t?(ni(t.userId===n.userId),hu(n.R,t)):null})},t.prototype.jt=function(t,e){var n=this;return this.Kt[e]?js.resolve(this.Kt[e]):this.lookupMutationBatch(t,e).next(function(t){if(t){var r=t.keys();return n.Kt[e]=r,r}return null})},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return Su(t).$t({index:Es.userMutationsIndex,range:i},function(t,e,i){e.userId===n.userId&&(ni(e.batchId>=r),o=hu(n.R,e)),i.done()}).next(function(){return o})},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Su(t).$t({index:Es.userMutationsIndex,range:e,reverse:!0},function(t,e,r){n=e.batchId,r.done()}).next(function(){return n})},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Su(t).Nt(Es.userMutationsIndex,n).next(function(t){return t.map(function(t){return hu(e.R,t)})})},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=As.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return Du(t).$t({range:i},function(r,i,a){var s=r[0],u=r[2],c=Ts(r[1]);if(s===n.userId&&e.path.isEqual(c))return Su(t).get(u).next(function(t){if(!t)throw ei();ni(t.userId===n.userId),o.push(hu(n.R,t))});a.done()}).next(function(){return o})},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new va(ai),i=[];return e.forEach(function(e){var o=As.prefixForPath(n.userId,e.path),a=IDBKeyRange.lowerBound(o),s=Du(t).$t({range:a},function(t,i,o){var a=t[0],s=t[2],u=Ts(t[1]);a===n.userId&&e.path.isEqual(u)?r=r.add(s):o.done()});i.push(s)}),js.waitFor(i).next(function(){return n.Wt(t,r)})},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=As.prefixForPath(this.userId,r),a=IDBKeyRange.lowerBound(o),s=new va(ai);return Du(t).$t({range:a},function(t,e,o){var a=t[0],u=t[2],c=Ts(t[1]);a===n.userId&&r.isPrefixOf(c)?c.length===i&&(s=s.add(u)):o.done()}).next(function(){return n.Wt(t,s)})},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(Su(t).get(e).next(function(t){if(null===t)throw ei();ni(t.userId===n.userId),r.push(hu(n.R,t))}))}),js.waitFor(i).next(function(){return r})},t.prototype.removeMutationBatch=function(t,e){var n=this;return _u(t.Mt,this.userId,e).next(function(r){return t.addOnCommittedListener(function(){n.Gt(e.batchId)}),js.forEach(r,function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)})})},t.prototype.Gt=function(t){delete this.Kt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next(function(n){if(!n)return js.resolve();var r=IDBKeyRange.lowerBound(As.prefixForUser(e.userId)),i=[];return Du(t).$t({range:r},function(t,n,r){if(t[0]===e.userId){var o=Ts(t[1]);i.push(o)}else r.done()}).next(function(){ni(0===i.length)})})},t.prototype.containsKey=function(t,e){return Au(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return Nu(t).get(this.userId).next(function(t){return t||new Is(e.userId,-1,"")})},t}();function Au(t,e,n){var r=As.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),a=!1;return Du(t).$t({range:o,kt:!0},function(t,n,r){t[0]===e&&t[1]===i&&(a=!0),r.done()}).next(function(){return a})}function Su(t){return $s(t,Es.store)}function Du(t){return $s(t,As.store)}function Nu(t){return $s(t,Is.store)}var xu=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),Cu=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next(function(n){var r=new xu(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next(function(){return n.highestTargetId})})},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next(function(t){return hi.fromTimestamp(new ci(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next(function(t){return t.highestListenSequenceNumber})},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next(function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)})},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next(function(){return n.Xt(t).next(function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)})})},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next(function(){return Ru(t).delete(e.targetId)}).next(function(){return n.Xt(t)}).next(function(e){return ni(e.targetCount>0),e.targetCount-=1,n.Zt(t,e)})},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return Ru(t).$t(function(a,s){var u=lu(s);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))}).next(function(){return js.waitFor(o)}).next(function(){return i})},t.prototype.forEachTarget=function(t,e){return Ru(t).$t(function(t,n){var r=lu(n);e(r)})},t.prototype.Xt=function(t){return qu(t).get(qs.key).next(function(t){return ni(null!==t),t})},t.prototype.Zt=function(t,e){return qu(t).put(qs.key,e)},t.prototype.te=function(t,e){return Ru(t).put(fu(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next(function(t){return t.targetCount})},t.prototype.getTargetData=function(t,e){var n=Wi(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return Ru(t).$t({range:r,index:Cs.queryTargetsIndexName},function(t,n,r){var o=lu(n);Yi(e,o.target)&&(i=o,r.done())}).next(function(){return i})},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=Uu(t);return e.forEach(function(e){var a=vs(e.path);i.push(o.put(new Rs(n,a))),i.push(r.referenceDelegate.addReference(t,n,e))}),js.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=Uu(t);return js.forEach(e,function(e){var o=vs(e.path);return js.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])})},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=Uu(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Uu(t),i=Sa();return r.$t({range:n,kt:!0},function(t,e,n){var r=Ts(t[1]),o=new xi(r);i=i.add(o)}).next(function(){return i})},t.prototype.containsKey=function(t,e){var n=vs(e.path),r=IDBKeyRange.bound([n],[ui(n)],!1,!0),i=0;return Uu(t).$t({index:Rs.documentTargetsIndex,kt:!0,range:r},function(t,e,n){0!==t[0]&&(i++,n.done())}).next(function(){return i>0})},t.prototype.lt=function(t,e){return Ru(t).get(e).next(function(t){return t?lu(t):null})},t}();function Ru(t){return $s(t,Cs.store)}function qu(t){return $s(t,qs.store)}function Uu(t){return $s(t,Rs.store)}function Ou(t){return(0,O.mG)(this,void 0,void 0,function(){return(0,O.Jh)(this,function(e){if(t.code!==Qr.FAILED_PRECONDITION||t.message!==Ms)throw t;return Yr("LocalStore","Unexpectedly lost primary lease"),[2]})})}function Lu(t,e){var n=t[1],r=e[1],i=ai(t[0],e[0]);return 0===i?ai(n,r):i}var Pu=function(){function t(t){this.ne=t,this.buffer=new va(Lu),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Lu(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),Fu=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){var e=this,n=this.oe?3e5:6e4;Yr("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,function(){return(0,O.mG)(e,void 0,void 0,function(){var e;return(0,O.Jh)(this,function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return Qs(e=n.sent())?(Yr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,Ou(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return n.sent(),[2]}})})})},t}(),Mu=function(){function t(t,e){this.ae=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next(function(t){return Math.floor(e/100*t)})},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return js.resolve(Jr.o);var r=new Pu(e);return this.ae.forEachTarget(t,function(t){return r.re(t.sequenceNumber)}).next(function(){return n.ae.le(t,function(t){return r.re(t)})}).next(function(){return r.maxValue})},t.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(Yr("LruGarbageCollector","Garbage collection skipped; disabled"),js.resolve(Tu)):this.getCacheSize(t).next(function(r){return r<n.params.cacheSizeCollectionThreshold?(Yr("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),Tu):n.fe(t,e)})},t.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},t.prototype.fe=function(t,e){var n,r,i,o,a,s,u,c=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(function(e){return e>c.params.maximumSequenceNumbersToCollect?(Yr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),r=c.params.maximumSequenceNumbersToCollect):r=e,o=Date.now(),c.nthSequenceNumber(t,r)}).next(function(r){return n=r,a=Date.now(),c.removeTargets(t,n,e)}).next(function(e){return i=e,s=Date.now(),c.removeOrphanedDocuments(t,n)}).next(function(t){return u=Date.now(),Wr()<=P.in.DEBUG&&Yr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(a-o)+"ms\n\tRemoved "+i+" targets in "+(s-a)+"ms\n\tRemoved "+t+" documents in "+(u-s)+"ms\nTotal Duration: "+(u-h)+"ms"),js.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})})},t}(),Zu=function(){function t(t,e){this.db=t,this.garbageCollector=function(t,e){return new Mu(t,e)}(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.de=function(t){var e=0;return this.le(t,function(t){e++}).next(function(){return e})},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,function(t,n){return e(n)})},t.prototype.addReference=function(t,e,n){return Vu(t,n)},t.prototype.removeReference=function(t,e,n){return Vu(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return Vu(t,e)},t.prototype._e=function(t,e){return function(t,e){var n=!1;return Nu(t).Ot(function(r){return Au(t,r,e).next(function(t){return t&&(n=!0),js.resolve(!t)})}).next(function(){return n})}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,function(a,s){if(s<=e){var u=n._e(t,a).next(function(e){if(!e)return o++,r.getEntry(t,a).next(function(){return r.removeEntry(a),Uu(t).delete([0,vs(a.path)])})});i.push(u)}}).next(function(){return js.waitFor(i)}).next(function(){return r.apply(t)}).next(function(){return o})},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return Vu(t,e)},t.prototype.we=function(t,e){var n,r=Uu(t),i=Jr.o;return r.$t({index:Rs.documentTargetsIndex},function(t,r){var o=r.path,a=r.sequenceNumber;0===t[0]?(i!==Jr.o&&e(new xi(Ts(n)),i),i=a,n=o):i=Jr.o}).next(function(){i!==Jr.o&&e(new xi(Ts(n)),i)})},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function Vu(t,e){return Uu(t).put(function(t,e){return new Rs(0,vs(t.path),e)}(e,t.currentSequenceNumber))}var ju=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[1];if(this.equalsFn(o[0],t))return a}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){fi(this.inner,function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];t(o[0],o[1])}})},t.prototype.isEmpty=function(){return di(this.inner)},t}(),Bu=function(){function t(){this.changes=new ju(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:hi.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:Qi.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?js.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),Gu=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return Qu(t).put(zu(e),n)},t.prototype.removeEntry=function(t,e){var n=Qu(t),r=zu(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next(function(r){return r.byteSize+=e,n.me(t,r)})},t.prototype.getEntry=function(t,e){var n=this;return Qu(t).get(zu(e)).next(function(t){return n.ye(e,t)})},t.prototype.ge=function(t,e){var n=this;return Qu(t).get(zu(e)).next(function(t){return{document:n.ye(e,t),size:Iu(t)}})},t.prototype.getEntries=function(t,e){var n=this,r=Ta();return this.pe(t,e,function(t,e){var i=n.ye(t,e);r=r.insert(t,i)}).next(function(){return r})},t.prototype.Ee=function(t,e){var n=this,r=Ta(),i=new ga(xi.comparator);return this.pe(t,e,function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,Iu(e))}).next(function(){return{documents:r,Te:i}})},t.prototype.pe=function(t,e,n){if(e.isEmpty())return js.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return Qu(t).$t({range:r},function(t,e,r){for(var a=xi.fromSegments(t);o&&xi.comparator(o,a)<0;)n(o,null),o=i.getNext();o&&o.isEqual(a)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()}).next(function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=Ta(),o=e.path.length+1,a={};if(n.isEqual(hi.min())){var s=e.path.toArray();a.range=IDBKeyRange.lowerBound(s)}else{var u=e.path.toArray(),c=au(n);a.range=IDBKeyRange.lowerBound([u,c],!0),a.index=Ns.collectionReadTimeIndex}return Qu(t).$t(a,function(t,n,a){if(t.length===o){var s=iu(r.R,n);e.path.isPrefixOf(s.key.path)?No(e,s)&&(i=i.insert(s.key,s)):a.done()}}).next(function(){return i})},t.prototype.newChangeBuffer=function(t){return new Ku(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},t.prototype.getMetadata=function(t){return Ju(t).get(xs.key).next(function(t){return ni(!!t),t})},t.prototype.me=function(t,e){return Ju(t).put(xs.key,e)},t.prototype.ye=function(t,e){if(e){var n=iu(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(hi.min()))return n}return Qi.newInvalidDocument(t)},t}(),Ku=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Ie=e,r.trackRemovals=n,r.Ae=new ju(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),r}return(0,O.ZT)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new va(function(t,e){return ai(t.canonicalString(),e.canonicalString())});return this.changes.forEach(function(o,a){var s=e.Ae.get(o);if(a.document.isValidDocument()){var u=ou(e.Ie.R,a.document,e.getReadTime(o));i=i.add(o.path.popLast());var c=Iu(u);r+=c-s,n.push(e.Ie.addEntry(t,o,u))}else if(r-=s,e.trackRemovals){var h=ou(e.Ie.R,Qi.newNoDocument(o,hi.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,h))}else n.push(e.Ie.removeEntry(t,o))}),i.forEach(function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))}),n.push(this.Ie.updateMetadata(t,r)),js.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next(function(t){return n.Ae.set(e,t.size),t.document})},e.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next(function(t){var e=t.documents;return t.Te.forEach(function(t,e){n.Ae.set(t,e)}),e})},e}(Bu);function Ju(t){return $s(t,xs.store)}function Qu(t){return $s(t,Ns.store)}function zu(t){return t.path.toArray()}var Hu=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;ni(n<r&&n>=0&&r<=11);var o=new Bs("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(_s.store)}(t),function(t){t.createObjectStore(Is.store,{keyPath:Is.keyPath}),t.createObjectStore(Es.store,{keyPath:Es.keyPath,autoIncrement:!0}).createIndex(Es.userMutationsIndex,Es.userMutationsKeyPath,{unique:!0}),t.createObjectStore(As.store)}(t),Wu(t),function(t){t.createObjectStore(Ns.store)}(t));var a=js.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(Rs.store),t.deleteObjectStore(Cs.store),t.deleteObjectStore(qs.store)}(t),Wu(t)),a=a.next(function(){return function(t){var e=t.store(qs.store),n=new qs(0,0,hi.min().toTimestamp(),0);return e.put(qs.key,n)}(o)})),n<4&&r>=4&&(0!==n&&(a=a.next(function(){return function(t,e){return e.store(Es.store).Nt().next(function(n){t.deleteObjectStore(Es.store),t.createObjectStore(Es.store,{keyPath:Es.keyPath,autoIncrement:!0}).createIndex(Es.userMutationsIndex,Es.userMutationsKeyPath,{unique:!0});var r=e.store(Es.store),i=n.map(function(t){return r.put(t)});return js.waitFor(i)})}(t,o)})),a=a.next(function(){!function(t){t.createObjectStore(Os.store,{keyPath:Os.keyPath})}(t)})),n<5&&r>=5&&(a=a.next(function(){return i.Re(o)})),n<6&&r>=6&&(a=a.next(function(){return function(t){t.createObjectStore(xs.store)}(t),i.be(o)})),n<7&&r>=7&&(a=a.next(function(){return i.ve(o)})),n<8&&r>=8&&(a=a.next(function(){return i.Pe(t,o)})),n<9&&r>=9&&(a=a.next(function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(Ns.store);e.createIndex(Ns.readTimeIndex,Ns.readTimeIndexPath,{unique:!1}),e.createIndex(Ns.collectionReadTimeIndex,Ns.collectionReadTimeIndexPath,{unique:!1})}(e)})),n<10&&r>=10&&(a=a.next(function(){return i.Ve(o)})),n<11&&r>=11&&(a=a.next(function(){!function(t){t.createObjectStore(Ls.store,{keyPath:Ls.keyPath})}(t),function(t){t.createObjectStore(Ps.store,{keyPath:Ps.keyPath})}(t)})),a},t.prototype.be=function(t){var e=0;return t.store(Ns.store).$t(function(t,n){e+=Iu(n)}).next(function(){var n=new xs(e);return t.store(xs.store).put(xs.key,n)})},t.prototype.Re=function(t){var e=this,n=t.store(Is.store),r=t.store(Es.store);return n.Nt().next(function(n){return js.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(Es.userMutationsIndex,i).next(function(r){return js.forEach(r,function(r){ni(r.userId===n.userId);var i=hu(e.R,r);return _u(t,n.userId,i).next(function(){})})})})})},t.prototype.ve=function(t){var e=t.store(Rs.store),n=t.store(Ns.store);return t.store(qs.store).get(qs.key).next(function(t){var r=[];return n.$t(function(n,i){var o=new gi(n),a=function(t){return[0,vs(t)]}(o);r.push(e.get(a).next(function(n){return n?js.resolve():function(n){return e.put(new Rs(0,vs(n),t.highestListenSequenceNumber))}(o)}))}).next(function(){return js.waitFor(r)})})},t.prototype.Pe=function(t,e){t.createObjectStore(Us.store,{keyPath:Us.keyPath});var n=e.store(Us.store),r=new vu,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:vs(i)})}};return e.store(Ns.store).$t({kt:!0},function(t,e){var n=new gi(t);return i(n.popLast())}).next(function(){return e.store(As.store).$t({kt:!0},function(t,e){var n=Ts(t[1]);return i(n.popLast())})})},t.prototype.Ve=function(t){var e=this,n=t.store(Cs.store);return n.$t(function(t,r){var i=lu(r),o=fu(e.R,i);return n.put(o)})},t}();function Wu(t){t.createObjectStore(Rs.store,{keyPath:Rs.keyPath}).createIndex(Rs.documentTargetsIndex,Rs.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Cs.store,{keyPath:Cs.keyPath}).createIndex(Cs.queryTargetsIndexName,Cs.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(qs.store)}var Yu="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Xu=function(){function t(e,n,r,i,o,a,s,u,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=a,this.document=s,this.De=c,this.Ce=h,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fe=null,this.inForeground=!1,this.ke=null,this.$e=null,this.Oe=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new zr(Qr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Zu(this,i),this.Le=n+"main",this.R=new ru(u),this.Be=new Gs(this.Le,11,new Hu(this.R)),this.qe=new Cu(this.referenceDelegate,this.R),this.Ut=new bu,this.Ue=function(t,e){return new Gu(t,e)}(this.R,this.Ut),this.Ke=new pu,this.window&&this.window.localStorage?this.Qe=this.window.localStorage:(this.Qe=null,!1===h&&Xr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.je().then(function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new zr(Qr.FAILED_PRECONDITION,Yu);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",function(e){return t.qe.getHighestSequenceNumber(e)})}).then(function(e){t.Ne=new Jr(e,t.De)}).then(function(){t.xe=!0}).catch(function(e){return t.Be&&t.Be.close(),Promise.reject(e)})},t.prototype.He=function(t){var e=this;return this.Me=function(n){return(0,O.mG)(e,void 0,void 0,function(){return(0,O.Jh)(this,function(e){return this.started?[2,t(n)]:[2]})})},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt(function(n){return(0,O.mG)(e,void 0,void 0,function(){return(0,O.Jh)(this,function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})})},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget(function(){return(0,O.mG)(e,void 0,void 0,function(){return(0,O.Jh)(this,function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},t.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return tc(e).put(new Os(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next(function(){if(t.isPrimary)return t.Je(e).next(function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable(function(){return t.Me(!1)}))})}).next(function(){return t.Ye(e)}).next(function(n){return t.isPrimary&&!n?t.Xe(e).next(function(){return!1}):!!n&&t.Ze(e).next(function(){return!0})})}).catch(function(e){if(Qs(e))return Yr("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return Yr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(function(e){t.isPrimary!==e&&t.Se.enqueueRetryable(function(){return t.Me(e)}),t.isPrimary=e})},t.prototype.Je=function(t){var e=this;return $u(t).get(_s.key).next(function(t){return js.resolve(e.tn(t))})},t.prototype.en=function(t){return tc(t).delete(this.clientId)},t.prototype.nn=function(){return(0,O.mG)(this,void 0,void 0,function(){var t,e,n,r=this;return(0,O.Jh)(this,function(i){switch(i.label){case 0:return!this.isPrimary||this.sn(this.Oe,18e5)?[3,2]:(this.Oe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var e=$s(t,Os.store);return e.Nt().next(function(t){var n=r.rn(t,18e5),i=t.filter(function(t){return-1===n.indexOf(t)});return js.forEach(i,function(t){return e.delete(t.clientId)}).next(function(){return i})})}).catch(function(){return[]})]);case 1:if(t=i.sent(),this.Qe)for(e=0,n=t;e<n.length;e++)this.Qe.removeItem(this.on(n[e].clientId));i.label=2;case 2:return[2]}})})},t.prototype.ze=function(){var t=this;this.$e=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,function(){return t.je().then(function(){return t.nn()}).then(function(){return t.ze()})})},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?js.resolve(!0):$u(t).get(_s.key).next(function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new zr(Qr.FAILED_PRECONDITION,Yu);return!1}}return!(!e.networkEnabled||!e.inForeground)||tc(t).Nt().next(function(t){return void 0===e.rn(t,5e3).find(function(t){return!(e.clientId===t.clientId||!(!e.networkEnabled&&t.networkEnabled||!e.inForeground&&t.inForeground&&e.networkEnabled===t.networkEnabled))})})}).next(function(t){return e.isPrimary!==t&&Yr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},t.prototype.shutdown=function(){return(0,O.mG)(this,void 0,void 0,function(){var t=this;return(0,O.Jh)(this,function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.$e&&(this.$e.cancel(),this.$e=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[_s.store,Os.store],function(e){var n=new Xs(e,Jr.o);return t.Xe(n).next(function(){return t.en(n)})})];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}})})},t.prototype.rn=function(t,e){var n=this;return t.filter(function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)})},t.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",function(e){return tc(e).Nt().next(function(e){return t.rn(e,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return Eu.Qt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r,i=this;return Yr("IndexedDbPersistence","Starting transaction:",t),this.Be.runTransaction(t,"readonly"===e?"readonly":"readwrite",Fs,function(o){return r=new Xs(o,i.Ne?i.Ne.next():Jr.o),"readwrite-primary"===e?i.Je(r).next(function(t){return!!t||i.Ye(r)}).next(function(e){if(!e)throw Xr("Failed to obtain primary lease for action '"+t+"'."),i.isPrimary=!1,i.Se.enqueueRetryable(function(){return i.Me(!1)}),new zr(Qr.FAILED_PRECONDITION,Ms);return n(r)}).next(function(t){return i.Ze(r).next(function(){return t})}):i.dn(r).next(function(){return n(r)})}).then(function(t){return r.raiseOnCommittedEvent(),t})},t.prototype.dn=function(t){var e=this;return $u(t).get(_s.key).next(function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new zr(Qr.FAILED_PRECONDITION,Yu)})},t.prototype.Ze=function(t){var e=new _s(this.clientId,this.allowTabSynchronization,Date.now());return $u(t).put(_s.key,e)},t.yt=function(){return Gs.yt()},t.prototype.Xe=function(t){var e=this,n=$u(t);return n.get(_s.key).next(function(t){return e.tn(t)?(Yr("IndexedDbPersistence","Releasing primary lease."),n.delete(_s.key)):js.resolve()})},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(Xr("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ke=function(){t.Se.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.je()})},this.document.addEventListener("visibilitychange",this.ke),this.inForeground="visible"===this.document.visibilityState)},t.prototype.an=function(){this.ke&&(this.document.removeEventListener("visibilitychange",this.ke),this.ke=null)},t.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Fe=function(){e.un(),e.Se.enqueueAndForget(function(){return e.shutdown()})},this.window.addEventListener("pagehide",this.Fe))},t.prototype.hn=function(){this.Fe&&(this.window.removeEventListener("pagehide",this.Fe),this.Fe=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Qe)||void 0===e?void 0:e.getItem(this.on(t)));return Yr("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return Xr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.un=function(){if(this.Qe)try{this.Qe.setItem(this.on(this.clientId),String(Date.now()))}catch(t){Xr("Failed to set zombie client id.",t)}},t.prototype.ln=function(){if(this.Qe)try{this.Qe.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function $u(t){return $s(t,_s.store)}function tc(t){return $s(t,Os.store)}function ec(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var nc=function(t,e){this.progress=t,this.wn=e},rc=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next(function(r){return n.yn(t,e,r)})},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next(function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t})},t.prototype.gn=function(t,e){t.forEach(function(t,n){for(var r=0,i=e;r<i.length;r++)i[r].applyToLocalView(n)})},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next(function(e){return n.En(t,e).next(function(){return e})})},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(t){return n.gn(e,t)})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return function(t){return xi.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Tn(t,e.path):ko(e)?this.In(t,e,n):this.An(t,e,n)},t.prototype.Tn=function(t,e){return this.mn(t,new xi(e)).next(function(t){var e=_a();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e})},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=_a();return this.Ut.getCollectionParents(t,i).next(function(a){return js.forEach(a,function(a){var s=function(t,e){return new go(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,a.child(i));return r.An(t,s,n).next(function(t){t.forEach(function(t,e){o=o.insert(t,e)})})}).next(function(){return o})})},t.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next(function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)}).next(function(e){return o.Rn(t,i=e,r).next(function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],a=0,s=o.mutations;a<s.length;a++){var u=s[a],c=u.key,h=r.get(c);null==h&&(h=Qi.newInvalidDocument(c),r=r.insert(c,h)),$o(u,h,o.localWriteTime),h.isFoundDocument()||(r=r.remove(c))}})}).next(function(){return r.forEach(function(t,n){No(e,n)||(r=r.remove(t))}),r})},t.prototype.Rn=function(t,e,n){for(var r=Sa(),i=0,o=e;i<o.length;i++)for(var a=0,s=o[i].mutations;a<s.length;a++){var u=s[a];u instanceof ia&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next(function(t){return t.forEach(function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))}),c})},t}(),ic=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=Sa(),i=Sa(),o=0,a=n.docChanges;o<a.length;o++){var s=a[o];switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),oc=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(hi.min())?this.Dn(t,e):this.Sn.pn(t,r).next(function(o){var a=i.Cn(e,o);return(vo(e)||bo(e))&&i.Nn(e.limitType,a,r,n)?i.Dn(t,e):(Wr()<=P.in.DEBUG&&Yr("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Do(e)),i.Sn.getDocumentsMatchingQuery(t,e,n).next(function(t){return a.forEach(function(e){t=t.insert(e.key,e)}),t}))})},t.prototype.Cn=function(t,e){var n=new va(xo(t));return e.forEach(function(e,r){No(t,r)&&(n=n.add(r))}),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return Wr()<=P.in.DEBUG&&Yr("QueryEngine","Using full collection scan to execute query:",Do(e)),this.Sn.getDocumentsMatchingQuery(t,e,hi.min())},t}(),ac=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.Fn=new ga(ai),this.kn=new ju(function(t){return Wi(t)},Yi),this.$n=hi.min(),this._n=t.getMutationQueue(n),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new rc(this.On,this._n,this.persistence.getIndexManager()),this.Ke=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return t.collect(n,e.Fn)})},t}();function sc(t,e,n,r){return new ac(t,e,n,r)}function uc(t,e){return(0,O.mG)(this,void 0,void 0,function(){var n,r,i,o;return(0,O.Jh)(this,function(a){switch(a.label){case 0:return n=ri(t),r=n._n,i=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",function(t){var o;return n._n.getAllMutationBatches(t).next(function(a){return o=a,r=n.persistence.getMutationQueue(e),i=new rc(n.On,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)}).next(function(e){for(var n=[],r=[],a=Sa(),s=0,u=o;s<u.length;s++){var c=u[s];n.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++)a=a.add(l[h].key)}for(var f=0,d=e;f<d.length;f++){var p=d[f];r.push(p.batchId);for(var g=0,m=p.mutations;g<m.length;g++)a=a.add(m[g].key)}return i.pn(t,a).next(function(t){return{Ln:t,removedBatchIds:n,addedBatchIds:r}})})})];case 1:return o=a.sent(),[2,(n._n=r,n.Mn=i,n.xn.Vn(n.Mn),o)]}})})}function cc(t,e){var n=ri(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var r=e.batch.keys(),i=n.On.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),a=js.resolve();return o.forEach(function(t){a=a.next(function(){return r.getEntry(e,t)}).next(function(e){var o=n.docVersions.get(t);ni(null!==o),e.version.compareTo(o)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))})}),a.next(function(){return t._n.removeMutationBatch(e,i)})}(n,t,e,i).next(function(){return i.apply(t)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}function hc(t){var e=ri(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.qe.getLastRemoteSnapshotVersion(t)})}function lc(t,e){var n=ri(t),r=e.snapshotVersion,i=n.Fn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",function(t){var o=n.On.newChangeBuffer({trackRemovals:!0});i=n.Fn;var a=[];e.targetChanges.forEach(function(e,o){var s=i.get(o);if(s){a.push(n.qe.removeMatchingKeys(t,e.removedDocuments,o).next(function(){return n.qe.addMatchingKeys(t,e.addedDocuments,o)}));var u=e.resumeToken;if(u.approximateByteSize()>0){var c=s.withResumeToken(u,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,c),function(t,e,n){return ni(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(s,c,e)&&a.push(n.qe.updateTargetData(t,c))}}});var s=Ta();if(e.documentUpdates.forEach(function(r,i){e.resolvedLimboDocuments.has(r)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))}),a.push(fc(t,o,e.documentUpdates,r,void 0).next(function(t){s=t})),!r.isEqual(hi.min())){var u=n.qe.getLastRemoteSnapshotVersion(t).next(function(e){return n.qe.setTargetsMetadata(t,t.currentSequenceNumber,r)});a.push(u)}return js.waitFor(a).next(function(){return o.apply(t)}).next(function(){return n.Mn.En(t,s)}).next(function(){return s})}).then(function(t){return n.Fn=i,t})}function fc(t,e,n,r,i){var o=Sa();return n.forEach(function(t){return o=o.add(t)}),e.getEntries(t,o).next(function(t){var o=Ta();return n.forEach(function(n,a){var s=t.get(n),u=(null==i?void 0:i.get(n))||r;a.isNoDocument()&&a.version.isEqual(hi.min())?(e.removeEntry(n,u),o=o.insert(n,a)):!s.isValidDocument()||a.version.compareTo(s.version)>0||0===a.version.compareTo(s.version)&&s.hasPendingWrites?(e.addEntry(a,u),o=o.insert(n,a)):Yr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",s.version," Watch version:",a.version)}),o})}function dc(t,e){var n=ri(t);return n.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e)})}function pc(t,e){var n=ri(t);return n.persistence.runTransaction("Allocate target","readwrite",function(t){var r;return n.qe.getTargetData(t,e).next(function(i){return i?js.resolve(r=i):n.qe.allocateTargetId(t).next(function(i){return r=new nu(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next(function(){return r})})})}).then(function(t){var r=n.Fn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Fn=n.Fn.insert(t.targetId,t),n.kn.set(e,t.targetId)),t})}function gc(t,e,n){return(0,O.mG)(this,void 0,void 0,function(){var r,i,o,a;return(0,O.Jh)(this,function(s){switch(s.label){case 0:r=ri(t),i=r.Fn.get(e),o=n?"readwrite":"readwrite-primary",s.label=1;case 1:return s.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,function(t){return r.persistence.referenceDelegate.removeTarget(t,i)})];case 2:s.sent(),s.label=3;case 3:return[3,5];case 4:if(!Qs(a=s.sent()))throw a;return Yr("LocalStore","Failed to update sequence numbers for target "+e+": "+a),[3,5];case 5:return r.Fn=r.Fn.remove(e),r.kn.delete(i.target),[2]}})})}function mc(t,e,n){var r=ri(t),i=hi.min(),o=Sa();return r.persistence.runTransaction("Execute query","readonly",function(t){return function(t,e,n){var r=ri(t),i=r.kn.get(n);return void 0!==i?js.resolve(r.Fn.get(i)):r.qe.getTargetData(e,n)}(r,t,Io(e)).next(function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(t,e.targetId).next(function(t){o=t})}).next(function(){return r.xn.getDocumentsMatchingQuery(t,e,n?i:hi.min(),n?o:Sa())}).next(function(t){return{documents:t,Bn:o}})})}function yc(t,e){var n=ri(t),r=ri(n.qe),i=n.Fn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.lt(t,e).next(function(t){return t?t.target:null})})}function vc(t){var e=ri(t);return e.persistence.runTransaction("Get new document changes","readonly",function(t){return function(t,e,n){var r=ri(t),i=Ta(),o=au(n),a=Qu(e),s=IDBKeyRange.lowerBound(o,!0);return a.$t({index:Ns.readTimeIndex,range:s},function(t,e){var n=iu(r.R,e);i=i.insert(n.key,n),o=e.readTime}).next(function(){return{wn:i,readTime:su(o)}})}(e.On,t,e.$n)}).then(function(t){var n=t.wn;return e.$n=t.readTime,n})}function bc(t){return(0,O.mG)(this,void 0,void 0,function(){var e;return(0,O.Jh)(this,function(n){return[2,(e=ri(t)).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return function(t){var e=Qu(t),n=hi.min();return e.$t({index:Ns.readTimeIndex,reverse:!0},function(t,e,r){e.readTime&&(n=su(e.readTime)),r.done()}).next(function(){return n})}(t)}).then(function(t){e.$n=t})]})})}function wc(t,e,n,r){return(0,O.mG)(this,void 0,void 0,function(){var i,o,a,s,u,c,h,l,f,d;return(0,O.Jh)(this,function(p){switch(p.label){case 0:for(i=ri(t),o=Sa(),a=Ta(),s=Ea(),u=0,c=n;u<c.length;u++)l=e.qn((h=c[u]).metadata.name),h.document&&(o=o.add(l)),a=a.insert(l,e.Un(h)),s=s.insert(l,e.Kn(h.metadata.readTime));return f=i.On.newChangeBuffer({trackRemovals:!0}),[4,pc(i,function(t){return Io(yo(gi.fromString("__bundle__/docs/"+t)))}(r))];case 1:return d=p.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",function(t){return fc(t,f,a,hi.min(),s).next(function(e){return f.apply(t),e}).next(function(e){return i.qe.removeMatchingKeysForTargetId(t,d.targetId).next(function(){return i.qe.addMatchingKeys(t,o,d.targetId)}).next(function(){return i.Mn.En(t,e)}).next(function(){return e})})})]}})})}function Tc(t,e,n){return void 0===n&&(n=Sa()),(0,O.mG)(this,void 0,void 0,function(){var r,i;return(0,O.Jh)(this,function(o){switch(o.label){case 0:return[4,pc(t,Io(du(e.bundledQuery)))];case 1:return r=o.sent(),[2,(i=ri(t)).persistence.runTransaction("Save named query","readwrite",function(t){var o=Ka(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Ke.saveNamedQuery(t,e);var a=r.withResumeToken(bi.EMPTY_BYTE_STRING,o);return i.Fn=i.Fn.insert(a.targetId,a),i.qe.updateTargetData(t,a).next(function(){return i.qe.removeMatchingKeysForTargetId(t,r.targetId)}).next(function(){return i.qe.addMatchingKeys(t,n,r.targetId)}).next(function(){return i.Ke.saveNamedQuery(t,e)})})]}})})}var kc=function(){function t(t){this.R=t,this.Qn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return js.resolve(this.Qn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Qn.set(e.id,{id:(n=e).id,version:n.version,createTime:Ka(n.createTime)}),js.resolve()},t.prototype.getNamedQuery=function(t,e){return js.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,function(t){return{name:t.name,query:du(t.bundledQuery),readTime:Ka(t.readTime)}}(e)),js.resolve()},t}(),_c=function(){function t(){this.Wn=new va(Ic.Gn),this.zn=new va(Ic.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new Ic(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},t.prototype.removeReference=function(t,e){this.Yn(new Ic(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},t.prototype.Zn=function(t){var e=this,n=new xi(new gi([])),r=new Ic(n,t),i=new Ic(n,t+1),o=[];return this.zn.forEachInRange([r,i],function(t){e.Yn(t),o.push(t.key)}),o},t.prototype.ts=function(){var t=this;this.Wn.forEach(function(e){return t.Yn(e)})},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new xi(new gi([])),n=new Ic(e,t),r=new Ic(e,t+1),i=Sa();return this.zn.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},t.prototype.containsKey=function(t){var e=new Ic(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),Ic=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return xi.comparator(t.key,e.key)||ai(t.ns,e.ns)},t.Hn=function(t,e){return ai(t.ns,e.ns)||xi.comparator(t.key,e.key)},t}(),Ec=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new va(Ic.Gn)}return t.prototype.checkEmpty=function(t){return js.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++;var o=new tu(i,e,n,r);this._n.push(o);for(var a=0,s=r;a<s.length;a++){var u=s[a];this.rs=this.rs.add(new Ic(u.key,i)),this.Ut.addToCollectionParentIndex(t,u.key.path.popLast())}return js.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return js.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this.cs(e+1),r=n<0?0:n;return js.resolve(this._n.length>r?this._n[r]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return js.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return js.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new Ic(e,0),i=new Ic(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],function(t){var e=n.os(t.ns);o.push(e)}),js.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new va(ai);return e.forEach(function(t){var e=new Ic(t,0),i=new Ic(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],function(t){r=r.add(t.ns)})}),js.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;xi.isDocumentKey(i)||(i=i.child(""));var o=new Ic(new xi(i),0),a=new va(ai);return this.rs.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(a=a.add(t.ns)),!0)},o),js.resolve(this.us(a))},t.prototype.us=function(t){var e=this,n=[];return t.forEach(function(t){var r=e.os(t);null!==r&&n.push(r)}),n},t.prototype.removeMutationBatch=function(t,e){var n=this;ni(0===this.hs(e.batchId,"removed")),this._n.shift();var r=this.rs;return js.forEach(e.mutations,function(i){var o=new Ic(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(function(){n.rs=r})},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new Ic(e,0),r=this.rs.firstAfterOrEqual(n);return js.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return js.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),Ac=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new ga(xi.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,a=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:a,readTime:n}),this.size+=a-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return js.resolve(n?n.document.clone():Qi.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=Ta();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():Qi.newInvalidDocument(t))}),js.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=Ta(),i=new xi(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var a=o.getNext(),s=a.value,u=s.document,c=s.readTime;if(!e.path.isPrefixOf(a.key.path))break;c.compareTo(n)<=0||No(e,u)&&(r=r.insert(u.key,u.clone()))}return js.resolve(r)},t.prototype.fs=function(t,e){return js.forEach(this.docs,function(t){return e(t)})},t.prototype.newChangeBuffer=function(t){return new Sc(this)},t.prototype.getSize=function(t){return js.resolve(this.size)},t}(),Sc=function(t){function e(e){var n=this;return(n=t.call(this)||this).Ie=e,n}return(0,O.ZT)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach(function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)}),js.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},e}(Bu),Dc=function(){function t(t){this.persistence=t,this.ds=new ju(function(t){return Wi(t)},Yi),this.lastRemoteSnapshotVersion=hi.min(),this.highestTargetId=0,this.ws=0,this._s=new _c,this.targetCount=0,this.ys=xu.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach(function(t,n){return e(n)}),js.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return js.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return js.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),js.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),js.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new xu(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,js.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),js.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,js.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach(function(a,s){s.sequenceNumber<=e&&null===n.get(s.targetId)&&(r.ds.delete(a),o.push(r.removeMatchingKeysForTargetId(t,s.targetId)),i++)}),js.waitFor(o).next(function(){return i})},t.prototype.getTargetCount=function(t){return js.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return js.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),js.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.markPotentiallyOrphaned(t,e))}),js.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),js.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return js.resolve(n)},t.prototype.containsKey=function(t,e){return js.resolve(this._s.containsKey(e))},t}(),Nc=function(){function t(t,e){var n=this;this.gs={},this.Ne=new Jr(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new Dc(this),this.Ut=new yu,this.Ue=function(t,e){return new Ac(t,function(t){return n.referenceDelegate.ps(t)})}(this.Ut),this.R=new ru(e),this.Ke=new kc(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new Ec(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r=this;Yr("MemoryPersistence","Starting transaction:",t);var i=new xc(this.Ne.next());return this.referenceDelegate.Es(),n(i).next(function(t){return r.referenceDelegate.Ts(i).next(function(){return t})}).toPromise().then(function(t){return i.raiseOnCommittedEvent(),t})},t.prototype.Is=function(t,e){return js.or(Object.values(this.gs).map(function(n){return function(){return n.containsKey(t,e)}}))},t}(),xc=function(t){function e(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return(0,O.ZT)(e,t),e}(Zs),Cc=function(){function t(t){this.persistence=t,this.As=new _c,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw ei()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),js.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),js.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),js.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach(function(t){return n.vs.add(t.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.vs.add(t.toString())})}).next(function(){return r.removeTargetData(t,e)})},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return js.forEach(this.vs,function(r){var i=xi.fromPath(r);return e.Ps(t,i).next(function(t){t||n.removeEntry(i)})}).next(function(){return e.Rs=null,n.apply(t)})},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next(function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())})},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return js.or([function(){return js.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),Rc=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();function qc(t,e){return"firestore_clients_"+t+"_"+e}function Uc(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function Oc(t,e){return"firestore_targets_"+t+"_"+e}Rc.UNAUTHENTICATED=new Rc(null),Rc.GOOGLE_CREDENTIALS=new Rc("google-credentials-uid"),Rc.FIRST_PARTY=new Rc("first-party-uid");var Lc=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,o=JSON.parse(r),a="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return a&&o.error&&(a="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new zr(o.error.code,o.error.message)),a?new t(e,n,o.state,i):(Xr("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Pc=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new zr(i.error.code,i.error.message)),o?new t(e,i.state,r):(Xr("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Fc=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=Na(),a=0;i&&a<r.activeTargetIds.length;++a)i=Ni(r.activeTargetIds[a]),o=o.add(r.activeTargetIds[a]);return i?new t(e,o):(Xr("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),Mc=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(Xr("SharedClientState","Failed to parse online state: "+e),null)},t}(),Zc=function(){function t(){this.activeTargetIds=Na()}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),Vc=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.Fs.bind(this),this.ks=new ga(ai),this.started=!1,this.$s=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Os=qc(this.persistenceKey,this.Ns),this.Ms=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.ks=this.ks.insert(this.Ns,new Zc),this.Ls=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Ks=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return(0,O.mG)(this,void 0,void 0,function(){var t,e,n,r,i,o,a,s,u,c,h=this;return(0,O.Jh)(this,function(l){switch(l.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=l.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Ns&&(i=this.getItem(qc(this.persistenceKey,r)))&&(o=Fc.Vs(r,i))&&(this.ks=this.ks.insert(o.clientId,o));for(this.Qs(),(a=this.storage.getItem(this.Us))&&(s=this.js(a))&&this.Ws(s),u=0,c=this.$s;u<c.length;u++)this.Fs(c[u]);return this.$s=[],this.window.addEventListener("pagehide",function(){return h.shutdown()}),this.started=!0,[2]}})})},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.ks)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.ks.forEach(function(n,r){r.activeTargetIds.has(t)&&(e=!0)}),e},t.prototype.addPendingMutation=function(t){this.zs(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(Oc(this.persistenceKey,t));if(n){var r=Pc.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Qs(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Qs()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(Oc(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.Hs(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Os),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return Yr("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){Yr("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){Yr("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.Fs=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(Yr("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Os)return void Xr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable(function(){return(0,O.mG)(e,void 0,void 0,function(){var t,e,r,i,o,a;return(0,O.Jh)(this,function(s){if(this.started){if(null!==n.key)if(this.Ls.test(n.key)){if(null==n.newValue)return t=this.ti(n.key),[2,this.ei(t,null)];if(e=this.ni(n.key,n.newValue))return[2,this.ei(e.clientId,e)]}else if(this.Bs.test(n.key)){if(null!==n.newValue&&(r=this.si(n.key,n.newValue)))return[2,this.ii(r)]}else if(this.qs.test(n.key)){if(null!==n.newValue&&(i=this.ri(n.key,n.newValue)))return[2,this.oi(i)]}else if(n.key===this.Us){if(null!==n.newValue&&(o=this.js(n.newValue)))return[2,this.Ws(o)]}else if(n.key===this.Ms)(a=function(t){var e=Jr.o;if(null!=t)try{var n=JSON.parse(t);ni("number"==typeof n),e=n}catch(t){Xr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==Jr.o&&this.sequenceNumberHandler(a);else if(n.key===this.Ks)return[2,this.syncEngine.ci()]}else this.$s.push(n);return[2]})})})}},Object.defineProperty(t.prototype,"Js",{get:function(){return this.ks.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Qs=function(){this.setItem(this.Os,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new Lc(this.currentUser,t,e,n),i=Uc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=Uc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){this.storage.setItem(this.Us,JSON.stringify({clientId:this.Ns,onlineState:t}))},t.prototype.Ys=function(t,e,n){var r=Oc(this.persistenceKey,t),i=new Pc(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Ks,"value-not-used")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return Fc.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]);return Lc.Vs(new Rc(void 0!==n[2]?n[2]:null),r,e)},t.prototype.ri=function(t,e){var n=this.qs.exec(t),r=Number(n[1]);return Pc.Vs(r,e)},t.prototype.js=function(t){return Mc.Vs(t)},t.prototype.ii=function(t){return(0,O.mG)(this,void 0,void 0,function(){return(0,O.Jh)(this,function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(Yr("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])})})},t.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.ks.insert(t,e):this.ks.remove(t),i=this.Gs(this.ks),o=this.Gs(r),a=[],s=[];return o.forEach(function(t){i.has(t)||a.push(t)}),i.forEach(function(t){o.has(t)||s.push(t)}),this.syncEngine.hi(a,s).then(function(){n.ks=r})},t.prototype.Ws=function(t){this.ks.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=Na();return t.forEach(function(t,n){e=e.unionWith(n.activeTargetIds)}),e},t}(),jc=function(){function t(){this.li=new Zc,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new Zc,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),Bc=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),Gc=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},t.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},t.prototype._i=function(){Yr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){Yr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),Kc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},Jc=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),Qc=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n.useFetchStreams=e.useFetchStreams,n}return(0,O.ZT)(e,t),e.prototype.ki=function(t,e,n,r){return new Promise(function(i,o){var a=new Kr;a.listenOnce(Vr.COMPLETE,function(){try{switch(a.getLastErrorCode()){case Zr.NO_ERROR:var e=a.getResponseJson();Yr("Connection","XHR received:",JSON.stringify(e)),i(e);break;case Zr.TIMEOUT:Yr("Connection",'RPC "'+t+'" timed out'),o(new zr(Qr.DEADLINE_EXCEEDED,"Request time out"));break;case Zr.HTTP_ERROR:var n=a.getStatus();if(Yr("Connection",'RPC "'+t+'" failed with status:',n,"response text:",a.getResponseText()),n>0){var r=a.getResponseJson().error;if(r&&r.status&&r.message){var s=function(t){var e=t.toLowerCase().replace(/_/g,"-");return Object.values(Qr).indexOf(e)>=0?e:Qr.UNKNOWN}(r.status);o(new zr(s,r.message))}else o(new zr(Qr.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new zr(Qr.UNAVAILABLE,"Connection failed."));break;default:ei()}}finally{Yr("Connection",'RPC "'+t+'" completed.')}});var s=JSON.stringify(r);a.send(e,"POST",s,n,15)})},e.prototype.Oi=function(t,e){var n=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=new Or,i=De(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new Br({})),this.Fi(o.initMessageHeaders,e),(0,L.uI)()||(0,L.b$)()||(0,L.d)()||(0,L.w1)()||(0,L.Mn)()||(0,L.ru)()||(o.httpHeadersOverwriteParam="$httpHeaders");var a=n.join("");Yr("Connection","Creating WebChannel: "+a,o);var s=r.createWebChannel(a,o),u=!1,c=!1,h=new Jc({Ei:function(t){c?Yr("Connection","Not sending because WebChannel is closed:",t):(u||(Yr("Connection","Opening WebChannel transport."),s.open(),u=!0),Yr("Connection","WebChannel sending:",t),s.send(t))},Ti:function(){return s.close()}}),l=function(t,e,n){t.listen(e,function(t){try{n(t)}catch(t){setTimeout(function(){throw t},0)}})};return l(s,Gr.EventType.OPEN,function(){c||Yr("Connection","WebChannel transport opened.")}),l(s,Gr.EventType.CLOSE,function(){c||(c=!0,Yr("Connection","WebChannel transport closed"),h.Vi())}),l(s,Gr.EventType.ERROR,function(t){c||(c=!0,$r("Connection","WebChannel transport errored:",t),h.Vi(new zr(Qr.UNAVAILABLE,"The operation could not be completed")))}),l(s,Gr.EventType.MESSAGE,function(t){var e;if(!c){var n=t.data[0];ni(!!n);var r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error);if(r){Yr("Connection","WebChannel received error:",r);var i=r.status,o=function(t){var e=ua[t];if(void 0!==e)return pa(e)}(i),a=r.message;void 0===o&&(o=Qr.INTERNAL,a="Unknown error status: "+i+" with message "+r.message),c=!0,h.Vi(new zr(o,a)),s.close()}else Yr("Connection","WebChannel received:",n),h.Si(n)}}),l(i,jr.STAT_EVENT,function(t){10===t.stat?Yr("Connection","Detected buffering proxy"):11===t.stat&&Yr("Connection","Detected no buffering proxy")}),setTimeout(function(){h.Pi()},0),h},e}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId,this.Di=(t.ssl?"https":"http")+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);Yr("RestConnection","Sending: ",i,n);var o={};return this.Fi(o,r),this.ki(t,i,o,n).then(function(t){return Yr("RestConnection","Received: ",t),t},function(e){throw $r("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e})},t.prototype.$i=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.Fi=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.7.0",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){return this.Di+"/v1/"+e+":"+Kc[t]},t}());function zc(){return"undefined"!=typeof window?window:null}function Hc(){return"undefined"!=typeof document?document:null}function Wc(t){return new Va(t,!0)}var Yc=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Ki=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Qi=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Ki),i=Math.max(0,n-r);i>0&&Yr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,function(){return e.Ki=Date.now(),t()}),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),Xc=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new Yc(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return(0,O.mG)(this,void 0,void 0,function(){return(0,O.Jh)(this,function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,function(){return t.rr()}))},t.prototype.cr=function(t){this.ur(),this.stream.send(t)},t.prototype.rr=function(){return(0,O.mG)(this,void 0,void 0,function(){return(0,O.Jh)(this,function(t){return this.er()?[2,this.close(0)]:[2]})})},t.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,e){return(0,O.mG)(this,void 0,void 0,function(){return(0,O.Jh)(this,function(n){switch(n.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===Qr.RESOURCE_EXHAUSTED?(Xr(e.toString()),Xr("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Qi()):e&&e.code===Qr.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}})})},t.prototype.ar=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then(function(e){t.Yi===n&&t.lr(e)},function(n){e(function(){var e=new zr(Qr.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)})})},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii(function(){n(function(){return e.state=2,e.listener.Ii()})}),this.stream.Ri(function(t){n(function(){return e.dr(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji(function(){return(0,O.mG)(t,void 0,void 0,function(){return(0,O.Jh)(this,function(t){return this.state=0,this.start(),[2]})})})},t.prototype.dr=function(t){return Yr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget(function(){return e.Yi===t?n():(Yr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},t}(),$c=function(t){function e(e,n,r,i,o){var a=this;return(a=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,a}return(0,O.ZT)(e,t),e.prototype.wr=function(t){return this.Hi.Oi("Listen",t)},e.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n;if("targetChange"in e){var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:ei()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.I?(ni(void 0===e||"string"==typeof e),bi.fromBase64String(e||"")):(ni(void 0===e||e instanceof Uint8Array),bi.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),a=(s=e.targetChange.cause)&&function(t){var e=void 0===t.code?Qr.UNKNOWN:pa(t.code);return new zr(e,t.message||"")}(s);n=new Ua(r,i,o,a||null)}else if("documentChange"in e){i=Ha(t,(r=e.documentChange).document.name),o=Ka(r.document.updateTime);var s=new Ki({mapValue:{fields:r.document.fields}}),u=(a=Qi.newFoundDocument(i,o,s),r.targetIds||[]);n=new Ra(u,r.removedTargetIds||[],a.key,a)}else if("documentDelete"in e)i=Ha(t,(r=e.documentDelete).document),o=r.readTime?Ka(r.readTime):hi.min(),s=Qi.newNoDocument(i,o),n=new Ra([],a=r.removedTargetIds||[],s.key,s);else if("documentRemove"in e)i=Ha(t,(r=e.documentRemove).document),n=new Ra([],o=r.removedTargetIds||[],i,null);else{if(!("filter"in e))return ei();var c=e.filter;i=new fa(r=c.count||0),n=new qa(o=c.targetId,i)}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return hi.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?hi.min():e.readTime?Ka(e.readTime):hi.min()}(t);return this.listener._r(e,n)},e.prototype.mr=function(t){var e={};e.database=Xa(this.R),e.addTarget=function(t,e){var n,r=e.target;return(n=Xi(r)?{documents:is(t,r)}:{query:os(t,r)}).targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=Ba(t,e.resumeToken):e.snapshotVersion.compareTo(hi.min())>0&&(n.readTime=ja(t,e.snapshotVersion.toTimestamp())),n}(this.R,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return ei()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(0,t);n&&(e.labels=n),this.cr(e)},e.prototype.yr=function(t){var e={};e.database=Xa(this.R),e.removeTarget=t,this.cr(e)},e}(Xc),th=function(t){function e(e,n,r,i,o){var a=this;return(a=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,a.gr=!1,a}return(0,O.ZT)(e,t),Object.defineProperty(e.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.ar=function(){this.gr&&this.Er([])},e.prototype.wr=function(t){return this.Hi.Oi("Write",t)},e.prototype.onMessage=function(t){if(ni(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=function(t,e){return t&&t.length>0?(ni(void 0!==e),t.map(function(t){return function(t,e){var n=Ka(t.updateTime?t.updateTime:e);return n.isEqual(hi.min())&&(n=Ka(e)),new zo(n,t.transformResults||[])}(t,e)})):[]}(t.writeResults,t.commitTime),n=Ka(t.commitTime);return this.listener.Tr(n,e)}return ni(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},e.prototype.Ar=function(){var t={};t.database=Xa(this.R),this.cr(t)},e.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map(function(t){return ns(e.R,t)})};this.cr(n)},e}(Xc),eh=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Hi=n,i.R=r,i.Rr=!1,i}return(0,O.ZT)(e,t),e.prototype.br=function(){if(this.Rr)throw new zr(Qr.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.Ni(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===Qr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new zr(Qr.UNKNOWN,t.toString())})},e.prototype.$i=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.$i(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===Qr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new zr(Qr.UNKNOWN,t.toString())})},e.prototype.terminate=function(){this.Rr=!0},e}(function(){}),nh=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()}))},t.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.Fr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},t.prototype.set=function(t){this.Fr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(Xr(e),this.Vr=!1):Yr("OnlineStateTracker",e)},t.prototype.Fr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),rh=function(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.kr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=i,this.Lr.di(function(t){n.enqueueAndForget(function(){return(0,O.mG)(o,void 0,void 0,function(){return(0,O.Jh)(this,function(t){switch(t.label){case 0:return fh(this)?(Yr("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return(0,O.mG)(this,void 0,void 0,function(){var e;return(0,O.Jh)(this,function(n){switch(n.label){case 0:return(e=ri(t)).Or.add(4),[4,oh(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.Or.delete(4),[4,ih(e)];case 2:return n.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Br=new nh(n,r)};function ih(t){return(0,O.mG)(this,void 0,void 0,function(){var e,n;return(0,O.Jh)(this,function(r){switch(r.label){case 0:if(!fh(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function oh(t){return(0,O.mG)(this,void 0,void 0,function(){var e,n;return(0,O.Jh)(this,function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function ah(t,e){var n=ri(t);n.$r.has(e.targetId)||(n.$r.set(e.targetId,e),lh(n)?hh(n):Sh(n).er()&&uh(n,e))}function sh(t,e){var n=ri(t),r=Sh(n);n.$r.delete(e),r.er()&&ch(n,e),0===n.$r.size&&(r.er()?r.ir():fh(n)&&n.Br.set("Unknown"))}function uh(t,e){t.qr.U(e.targetId),Sh(t).mr(e)}function ch(t,e){t.qr.U(e),Sh(t).yr(e)}function hh(t){t.qr=new La({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.$r.get(e)||null}}),Sh(t).start(),t.Br.Sr()}function lh(t){return fh(t)&&!Sh(t).tr()&&t.$r.size>0}function fh(t){return 0===ri(t).Or.size}function dh(t){t.qr=void 0}function ph(t){return(0,O.mG)(this,void 0,void 0,function(){return(0,O.Jh)(this,function(e){return t.$r.forEach(function(e,n){uh(t,e)}),[2]})})}function gh(t,e){return(0,O.mG)(this,void 0,void 0,function(){return(0,O.Jh)(this,function(n){return dh(t),lh(t)?(t.Br.Nr(e),hh(t)):t.Br.set("Unknown"),[2]})})}function mh(t,e,n){return(0,O.mG)(this,void 0,void 0,function(){var r,i,o;return(0,O.Jh)(this,function(a){switch(a.label){case 0:if(t.Br.set("Online"),!(e instanceof Ua&&2===e.state&&e.cause))return[3,6];a.label=1;case 1:return a.trys.push([1,3,,5]),[4,function(t,e){return(0,O.mG)(this,void 0,void 0,function(){var n,r,i,o;return(0,O.Jh)(this,function(a){switch(a.label){case 0:n=e.cause,r=0,i=e.targetIds,a.label=1;case 1:return r<i.length?t.$r.has(o=i[r])?[4,t.remoteSyncer.rejectListen(o,n)]:[3,3]:[3,5];case 2:a.sent(),t.$r.delete(o),t.qr.removeTarget(o),a.label=3;case 3:a.label=4;case 4:return r++,[3,1];case 5:return[2]}})})}(t,e)];case 2:return a.sent(),[3,5];case 3:return r=a.sent(),Yr("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,yh(t,r)];case 4:return a.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof Ra?t.qr.X(e):e instanceof qa?t.qr.rt(e):t.qr.et(e),n.isEqual(hi.min()))return[3,13];a.label=7;case 7:return a.trys.push([7,11,,13]),[4,hc(t.localStore)];case 8:return i=a.sent(),n.compareTo(i)>=0?[4,function(t,e){var n=t.qr.ut(e);return n.targetChanges.forEach(function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=t.$r.get(r);i&&t.$r.set(r,i.withResumeToken(n.resumeToken,e))}}),n.targetMismatches.forEach(function(e){var n=t.$r.get(e);if(n){t.$r.set(e,n.withResumeToken(bi.EMPTY_BYTE_STRING,n.snapshotVersion)),ch(t,e);var r=new nu(n.target,e,1,n.sequenceNumber);uh(t,r)}}),t.remoteSyncer.applyRemoteEvent(n)}(t,n)]:[3,10];case 9:a.sent(),a.label=10;case 10:return[3,13];case 11:return Yr("RemoteStore","Failed to raise snapshot:",o=a.sent()),[4,yh(t,o)];case 12:return a.sent(),[3,13];case 13:return[2]}})})}function yh(t,e,n){return(0,O.mG)(this,void 0,void 0,function(){var r=this;return(0,O.Jh)(this,function(i){switch(i.label){case 0:if(!Qs(e))throw e;return t.Or.add(1),[4,oh(t)];case 1:return i.sent(),t.Br.set("Offline"),n||(n=function(){return hc(t.localStore)}),t.asyncQueue.enqueueRetryable(function(){return(0,O.mG)(r,void 0,void 0,function(){return(0,O.Jh)(this,function(e){switch(e.label){case 0:return Yr("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.Or.delete(1),[4,ih(t)];case 2:return e.sent(),[2]}})})}),[2]}})})}function vh(t,e){return e().catch(function(n){return yh(t,n,e)})}function bh(t){return(0,O.mG)(this,void 0,void 0,function(){var e,n,r,i,o;return(0,O.Jh)(this,function(a){switch(a.label){case 0:e=ri(t),n=Dh(e),r=e.kr.length>0?e.kr[e.kr.length-1].batchId:-1,a.label=1;case 1:if(!function(t){return fh(t)&&t.kr.length<10}(e))return[3,7];a.label=2;case 2:return a.trys.push([2,4,,6]),[4,dc(e.localStore,r)];case 3:return null===(i=a.sent())?(0===e.kr.length&&n.ir(),[3,7]):(r=i.batchId,function(t,e){t.kr.push(e);var n=Dh(t);n.er()&&n.pr&&n.Er(e.mutations)}(e,i),[3,6]);case 4:return o=a.sent(),[4,yh(e,o)];case 5:return a.sent(),[3,6];case 6:return[3,1];case 7:return wh(e)&&Th(e),[2]}})})}function wh(t){return fh(t)&&!Dh(t).tr()&&t.kr.length>0}function Th(t){Dh(t).start()}function kh(t){return(0,O.mG)(this,void 0,void 0,function(){return(0,O.Jh)(this,function(e){return Dh(t).Ar(),[2]})})}function _h(t){return(0,O.mG)(this,void 0,void 0,function(){var e,n,r;return(0,O.Jh)(this,function(i){for(e=Dh(t),n=0,r=t.kr;n<r.length;n++)e.Er(r[n].mutations);return[2]})})}function Ih(t,e,n){return(0,O.mG)(this,void 0,void 0,function(){var r,i;return(0,O.Jh)(this,function(o){switch(o.label){case 0:return r=t.kr.shift(),i=eu.from(r,e,n),[4,vh(t,function(){return t.remoteSyncer.applySuccessfulWrite(i)})];case 1:return o.sent(),[4,bh(t)];case 2:return o.sent(),[2]}})})}function Eh(t,e){return(0,O.mG)(this,void 0,void 0,function(){return(0,O.Jh)(this,function(n){switch(n.label){case 0:return e&&Dh(t).pr?[4,function(t,e){return(0,O.mG)(this,void 0,void 0,function(){var n,r;return(0,O.Jh)(this,function(i){switch(i.label){case 0:return da(r=e.code)&&r!==Qr.ABORTED?(n=t.kr.shift(),Dh(t).sr(),[4,vh(t,function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)})]):[3,3];case 1:return i.sent(),[4,bh(t)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return wh(t)&&Th(t),[2]}})})}function Ah(t,e){return(0,O.mG)(this,void 0,void 0,function(){var n;return(0,O.Jh)(this,function(r){switch(r.label){case 0:return n=ri(t),e?(n.Or.delete(2),[4,ih(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.Or.add(2),[4,oh(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}})})}function Sh(t){var e=this;return t.Ur||(t.Ur=function(t,e,n){var r=ri(t);return r.br(),new $c(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:ph.bind(null,t),Ri:gh.bind(null,t),_r:mh.bind(null,t)}),t.Mr.push(function(n){return(0,O.mG)(e,void 0,void 0,function(){return(0,O.Jh)(this,function(e){switch(e.label){case 0:return n?(t.Ur.sr(),lh(t)?hh(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:e.sent(),dh(t),e.label=3;case 3:return[2]}})})})),t.Ur}function Dh(t){var e=this;return t.Kr||(t.Kr=function(t,e,n){var r=ri(t);return r.br(),new th(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:kh.bind(null,t),Ri:Eh.bind(null,t),Ir:_h.bind(null,t),Tr:Ih.bind(null,t)}),t.Mr.push(function(n){return(0,O.mG)(e,void 0,void 0,function(){return(0,O.Jh)(this,function(e){switch(e.label){case 0:return n?(t.Kr.sr(),[4,bh(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Kr.stop()];case 3:e.sent(),t.kr.length>0&&(Yr("RemoteStore","Stopping write stream with "+t.kr.length+" pending writes"),t.kr=[]),e.label=4;case 4:return[2]}})})})),t.Kr}var Nh=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Vs,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}return t.createAndSchedule=function(e,n,r,i,o){var a=new t(e,n,Date.now()+r,i,o);return a.start(r),a},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new zr(Qr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function xh(t,e){if(Xr("AsyncQueue",e+": "+t),Qs(t))return new zr(Qr.UNAVAILABLE,e+": "+t);throw t}var Ch=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||xi.comparator(e.key,n.key)}:function(t,e){return xi.comparator(t.key,e.key)},this.keyedMap=_a(),this.sortedSet=new ga(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),Rh=function(){function t(){this.Qr=new ga(xi.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Qr.get(e);n?0!==t.type&&3===n.type?this.Qr=this.Qr.insert(e,t):3===t.type&&1!==n.type?this.Qr=this.Qr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Qr=this.Qr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Qr=this.Qr.remove(e):1===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):ei():this.Qr=this.Qr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Qr.inorderTraversal(function(e,n){t.push(n)}),t},t}(),qh=function(){function t(t,e,n,r,i,o,a,s){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=s}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach(function(t){o.push({type:0,doc:t})}),new t(e,n,Ch.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Ao(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),Uh=function(){this.Wr=void 0,this.listeners=[]},Oh=function(){this.queries=new ju(function(t){return So(t)},Ao),this.onlineState="Unknown",this.Gr=new Set};function Lh(t,e){return(0,O.mG)(this,void 0,void 0,function(){var n,r,i,o,a,s,u;return(0,O.Jh)(this,function(c){switch(c.label){case 0:if(n=ri(t),i=!1,(o=n.queries.get(r=e.query))||(i=!0,o=new Uh),!i)return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),a=o,[4,n.onListen(r)];case 2:return a.Wr=c.sent(),[3,4];case 3:return s=c.sent(),u=xh(s,"Initialization of query '"+Do(e.query)+"' failed"),[2,void e.onError(u)];case 4:return n.queries.set(r,o),o.listeners.push(e),e.zr(n.onlineState),o.Wr&&e.Hr(o.Wr)&&Zh(n),[2]}})})}function Ph(t,e){return(0,O.mG)(this,void 0,void 0,function(){var n,r,i,o,a;return(0,O.Jh)(this,function(s){return n=ri(t),i=!1,(o=n.queries.get(r=e.query))&&(a=o.listeners.indexOf(e))>=0&&(o.listeners.splice(a,1),i=0===o.listeners.length),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]})})}function Fh(t,e){for(var n=ri(t),r=!1,i=0,o=e;i<o.length;i++){var a=o[i],s=n.queries.get(a.query);if(s){for(var u=0,c=s.listeners;u<c.length;u++)c[u].Hr(a)&&(r=!0);s.Wr=a}}r&&Zh(n)}function Mh(t,e,n){var r=ri(t),i=r.queries.get(e);if(i)for(var o=0,a=i.listeners;o<a.length;o++)a[o].onError(n);r.queries.delete(e)}function Zh(t){t.Gr.forEach(function(t){t.next()})}var Vh=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new qh(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){return!t.fromCache||!(this.options.so&&"Offline"!==e||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.Zr=function(t){return t.docChanges.length>0||!!(t.syncStateChanged||this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=qh.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),jh=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.io=function(){return"metadata"in this.payload},t}(),Bh=function(){function t(t){this.R=t}return t.prototype.qn=function(t){return Ha(this.R,t)},t.prototype.Un=function(t){return t.metadata.exists?es(this.R,t.document,!1):Qi.newNoDocument(this.qn(t.metadata.name),this.Kn(t.metadata.readTime))},t.prototype.Kn=function(t){return Ka(t)},t}();!function(){function t(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=function(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(t)}t.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.co=function(t){for(var e=new Map,n=new Bh(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var a=n.qn(o.metadata.name),s=0,u=o.metadata.queries;s<u.length;s++){var c=u[s],h=(e.get(c)||Sa()).add(a);e.set(c,h)}}return e},t.prototype.complete=function(){return(0,O.mG)(this,void 0,void 0,function(){var t,e,n,r,i;return(0,O.Jh)(this,function(o){switch(o.label){case 0:return[4,wc(this.localStore,new Bh(this.R),this.documents,this.ro.id)];case 1:t=o.sent(),e=this.co(this.documents),n=0,r=this.queries,o.label=2;case 2:return n<r.length?[4,Tc(this.localStore,i=r[n],e.get(i.name))]:[3,5];case 3:o.sent(),o.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new nc(Object.assign({},this.progress),t))]}})})}}();var Gh=function(t){this.key=t},Kh=function(t){this.key=t},Jh=function(){function t(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=Sa(),this.mutatedKeys=Sa(),this.lo=xo(t),this.fo=new Ch(this.lo)}return Object.defineProperty(t.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new Rh,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,a=i,s=!1,u=vo(this.query)&&i.size===this.query.limit?i.last():null,c=bo(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal(function(t,e){var h=i.get(t),l=No(n.query,e)?e:null,f=!!h&&n.mutatedKeys.has(h.key),d=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),p=!1;h&&l?h.data.isEqual(l.data)?f!==d&&(r.track({type:3,doc:l}),p=!0):n.yo(h,l)||(r.track({type:2,doc:l}),p=!0,(u&&n.lo(l,u)>0||c&&n.lo(l,c)<0)&&(s=!0)):!h&&l?(r.track({type:0,doc:l}),p=!0):h&&!l&&(r.track({type:1,doc:h}),p=!0,(u||c)&&(s=!0)),p&&(l?(a=a.add(l),o=d?o.add(t):o.delete(t)):(a=a.delete(t),o=o.delete(t)))}),vo(this.query)||bo(this.query))for(;a.size>this.query.limit;){var h=vo(this.query)?a.last():a.first();a=a.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fo:a,mo:r,Nn:s,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort(function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ei()}};return n(t)-n(e)}(t.type,e.type)||r.lo(t.doc,e.doc)}),this.po(n);var a=e?this.Eo():[],s=0===this.ho.size&&this.current?1:0,u=s!==this.ao;return this.ao=s,0!==o.length||u?{snapshot:new qh(this.query,t.fo,i,o,t.mutatedKeys,0===s,u,!1),To:a}:{To:a}},t.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new Rh,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e.uo=e.uo.add(t)}),t.modifiedDocuments.forEach(function(t){}),t.removedDocuments.forEach(function(t){return e.uo=e.uo.delete(t)}),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=Sa(),this.fo.forEach(function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))});var n=[];return e.forEach(function(e){t.ho.has(e)||n.push(new Kh(e))}),this.ho.forEach(function(t){e.has(t)||n.push(new Gh(t))}),n},t.prototype.Ao=function(t){this.uo=t.Bn,this.ho=Sa();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return qh.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},t}(),Qh=function(t,e,n){this.query=t,this.targetId=e,this.view=n},zh=function(t){this.key=t,this.bo=!1},Hh=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new ju(function(t){return So(t)},Ao),this.Vo=new Map,this.So=new Set,this.Do=new ga(xi.comparator),this.Co=new Map,this.No=new _c,this.xo={},this.Fo=new Map,this.ko=xu.Yt(),this.onlineState="Unknown",this.$o=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.$o},enumerable:!1,configurable:!0}),t}();function Wh(t,e){return(0,O.mG)(this,void 0,void 0,function(){var n,r,i,o,a;return(0,O.Jh)(this,function(s){switch(s.label){case 0:return n=El(t),(i=n.Po.get(e))?(n.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.Ro(),[3,4]):[3,1];case 1:return[4,pc(n.localStore,Io(e))];case 2:return o=s.sent(),a=n.sharedClientState.addLocalQueryTarget(o.targetId),[4,Yh(n,e,o.targetId,"current"===a)];case 3:r=s.sent(),n.isPrimaryClient&&ah(n.remoteStore,o),s.label=4;case 4:return[2,r]}})})}function Yh(t,e,n,r){return(0,O.mG)(this,void 0,void 0,function(){var i,o,a,s,u,c;return(0,O.Jh)(this,function(h){switch(h.label){case 0:return t.Oo=function(e,n,r){return function(t,e,n,r){return(0,O.mG)(this,void 0,void 0,function(){var i,o,a;return(0,O.Jh)(this,function(s){switch(s.label){case 0:return(i=e.view._o(n)).Nn?[4,mc(t.localStore,e.query,!1).then(function(t){return e.view._o(t.documents,i)})]:[3,2];case 1:i=s.sent(),s.label=2;case 2:return o=r&&r.targetChanges.get(e.targetId),a=e.view.applyChanges(i,t.isPrimaryClient,o),[2,(hl(t,e.targetId,a.To),a.snapshot)]}})})}(t,e,n,r)},[4,mc(t.localStore,e,!0)];case 1:return i=h.sent(),o=new Jh(e,i.Bn),a=o._o(i.documents),s=Ca.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),u=o.applyChanges(a,t.isPrimaryClient,s),hl(t,n,u.To),c=new Qh(e,n,o),[2,(t.Po.set(e,c),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),u.snapshot)]}})})}function Xh(t,e){return(0,O.mG)(this,void 0,void 0,function(){var n,r,i;return(0,O.Jh)(this,function(o){switch(o.label){case 0:return n=ri(t),r=n.Po.get(e),(i=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,i.filter(function(t){return!Ao(t,e)})),void n.Po.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,gc(n.localStore,r.targetId,!1).then(function(){n.sharedClientState.clearQueryState(r.targetId),sh(n.remoteStore,r.targetId),ul(n,r.targetId)}).catch(Ou)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return ul(n,r.targetId),[4,gc(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}})})}function $h(t,e,n){return(0,O.mG)(this,void 0,void 0,function(){var r,i,o,a;return(0,O.Jh)(this,function(s){switch(s.label){case 0:r=Al(t),s.label=1;case 1:return s.trys.push([1,5,,6]),[4,function(t,e){var n,r=ri(t),i=ci.now(),o=e.reduce(function(t,e){return t.add(e.key)},Sa());return r.persistence.runTransaction("Locally write mutations","readwrite",function(t){return r.Mn.pn(t,o).next(function(o){n=o;for(var a=[],s=0,u=e;s<u.length;s++){var c=u[s],h=ta(c,n.get(c.key));null!=h&&a.push(new ia(c.key,h,Ji(h.value.mapValue),Ho.exists(!0)))}return r._n.addMutationBatch(t,i,a,e)})}).then(function(t){return t.applyToLocalDocumentSet(n),{batchId:t.batchId,changes:n}})}(r.localStore,e)];case 2:return i=s.sent(),r.sharedClientState.addPendingMutation(i.batchId),function(t,e,n){var r=t.xo[t.currentUser.toKey()];r||(r=new ga(ai)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(r,i.batchId,n),[4,dl(r,i.changes)];case 3:return s.sent(),[4,bh(r.remoteStore)];case 4:return s.sent(),[3,6];case 5:return o=s.sent(),a=xh(o,"Failed to persist write"),n.reject(a),[3,6];case 6:return[2]}})})}function tl(t,e){return(0,O.mG)(this,void 0,void 0,function(){var n,r;return(0,O.Jh)(this,function(i){switch(i.label){case 0:n=ri(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,lc(n.localStore,e)];case 2:return r=i.sent(),e.targetChanges.forEach(function(t,e){var r=n.Co.get(e);r&&(ni(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.bo=!0:t.modifiedDocuments.size>0?ni(r.bo):t.removedDocuments.size>0&&(ni(r.bo),r.bo=!1))}),[4,dl(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,Ou(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}})})}function el(t,e,n){var r=ri(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Po.forEach(function(t,n){var r=n.view.zr(e);r.snapshot&&i.push(r.snapshot)}),function(t,e){var n=ri(t);n.onlineState=e;var r=!1;n.queries.forEach(function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zr(e)&&(r=!0)}),r&&Zh(n)}(r.eventManager,e),i.length&&r.vo._r(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function nl(t,e,n){return(0,O.mG)(this,void 0,void 0,function(){var r,i,o,a,s,u;return(0,O.Jh)(this,function(c){switch(c.label){case 0:return(r=ri(t)).sharedClientState.updateQueryState(e,"rejected",n),i=r.Co.get(e),(o=i&&i.key)?(a=(a=new ga(xi.comparator)).insert(o,Qi.newNoDocument(o,hi.min())),s=Sa().add(o),u=new xa(hi.min(),new Map,new va(ai),a,s),[4,tl(r,u)]):[3,2];case 1:return c.sent(),r.Do=r.Do.remove(o),r.Co.delete(e),fl(r),[3,4];case 2:return[4,gc(r.localStore,e,!1).then(function(){return ul(r,e,n)}).catch(Ou)];case 3:c.sent(),c.label=4;case 4:return[2]}})})}function rl(t,e){return(0,O.mG)(this,void 0,void 0,function(){var n,r,i;return(0,O.Jh)(this,function(o){switch(o.label){case 0:n=ri(t),r=e.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,cc(n.localStore,e)];case 2:return i=o.sent(),sl(n,r,null),al(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,dl(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,Ou(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function il(t,e,n){return(0,O.mG)(this,void 0,void 0,function(){var r,i;return(0,O.Jh)(this,function(o){switch(o.label){case 0:r=ri(t),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,function(t,e){var n=ri(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",function(t){var r;return n._n.lookupMutationBatch(t,e).next(function(e){return ni(null!==e),r=e.keys(),n._n.removeMutationBatch(t,e)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}(r.localStore,e)];case 2:return i=o.sent(),sl(r,e,n),al(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),[4,dl(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,Ou(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function ol(t,e){return(0,O.mG)(this,void 0,void 0,function(){var n,r,i,o,a;return(0,O.Jh)(this,function(s){switch(s.label){case 0:fh((n=ri(t)).remoteStore)||Yr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,function(t){var e=ri(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e._n.getHighestUnacknowledgedBatchId(t)})}(n.localStore)];case 2:return-1===(r=s.sent())?[2,void e.resolve()]:((i=n.Fo.get(r)||[]).push(e),n.Fo.set(r,i),[3,4]);case 3:return o=s.sent(),a=xh(o,"Initialization of waitForPendingWrites() operation failed"),e.reject(a),[3,4];case 4:return[2]}})})}function al(t,e){(t.Fo.get(e)||[]).forEach(function(t){t.resolve()}),t.Fo.delete(e)}function sl(t,e,n){var r=ri(t),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}function ul(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach(function(e){t.No.containsKey(e)||cl(t,e)})}function cl(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(sh(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),fl(t))}function hl(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof Gh?(t.No.addReference(o.key,e),ll(t,o)):o instanceof Kh?(Yr("SyncEngine","Document no longer in limbo: "+o.key),t.No.removeReference(o.key,e),t.No.containsKey(o.key)||cl(t,o.key)):ei()}}function ll(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(Yr("SyncEngine","New document in limbo: "+n),t.So.add(r),fl(t))}function fl(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new xi(gi.fromString(e)),r=t.ko.next();t.Co.set(r,new zh(n)),t.Do=t.Do.insert(n,r),ah(t.remoteStore,new nu(Io(yo(n.path)),r,2,Jr.o))}}function dl(t,e,n){return(0,O.mG)(this,void 0,void 0,function(){var r,i,o,a;return(0,O.Jh)(this,function(s){switch(s.label){case 0:return r=ri(t),i=[],o=[],a=[],r.Po.isEmpty()?[3,3]:(r.Po.forEach(function(t,s){a.push(r.Oo(s,e,n).then(function(t){if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(s.targetId,t.fromCache?"not-current":"current"),i.push(t);var e=ic.Pn(s.targetId,t);o.push(e)}}))}),[4,Promise.all(a)]);case 1:return s.sent(),r.vo._r(i),[4,function(t,e){return(0,O.mG)(this,void 0,void 0,function(){var n,r,i,o,a,s,u,c;return(0,O.Jh)(this,function(h){switch(h.label){case 0:n=ri(t),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(t){return js.forEach(e,function(e){return js.forEach(e.bn,function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)}).next(function(){return js.forEach(e.vn,function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)})})})})];case 2:return h.sent(),[3,4];case 3:if(!Qs(r=h.sent()))throw r;return Yr("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,o=e;i<o.length;i++)s=(a=o[i]).targetId,a.fromCache||(u=n.Fn.get(s),c=u.withLastLimboFreeSnapshotVersion(u.snapshotVersion),n.Fn=n.Fn.insert(s,c));return[2]}})})}(r.localStore,o)];case 2:s.sent(),s.label=3;case 3:return[2]}})})}function pl(t,e){return(0,O.mG)(this,void 0,void 0,function(){var n,r;return(0,O.Jh)(this,function(i){switch(i.label){case 0:return(n=ri(t)).currentUser.isEqual(e)?[3,3]:(Yr("SyncEngine","User change. New user:",e.toKey()),[4,uc(n.localStore,e)]);case 1:return r=i.sent(),n.currentUser=e,function(t,e){t.Fo.forEach(function(t){t.forEach(function(t){t.reject(new zr(Qr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),t.Fo.clear()}(n),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),[4,dl(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}function gl(t,e){var n=ri(t),r=n.Co.get(e);if(r&&r.bo)return Sa().add(r.key);var i=Sa(),o=n.Vo.get(e);if(!o)return i;for(var a=0,s=o;a<s.length;a++){var u=n.Po.get(s[a]);i=i.unionWith(u.view.wo)}return i}function ml(t,e){return(0,O.mG)(this,void 0,void 0,function(){var n,r,i;return(0,O.Jh)(this,function(o){switch(o.label){case 0:return[4,mc((n=ri(t)).localStore,e.query,!0)];case 1:return r=o.sent(),i=e.view.Ao(r),[2,(n.isPrimaryClient&&hl(n,e.targetId,i.To),i)]}})})}function yl(t){return(0,O.mG)(this,void 0,void 0,function(){var e;return(0,O.Jh)(this,function(n){return[2,vc((e=ri(t)).localStore).then(function(t){return dl(e,t)})]})})}function vl(t,e,n,r){return(0,O.mG)(this,void 0,void 0,function(){var i,o;return(0,O.Jh)(this,function(a){switch(a.label){case 0:return[4,function(t,e){var n=ri(t),r=ri(n._n);return n.persistence.runTransaction("Lookup mutation documents","readonly",function(t){return r.jt(t,e).next(function(e){return e?n.Mn.pn(t,e):js.resolve(null)})})}((i=ri(t)).localStore,e)];case 1:return null===(o=a.sent())?[3,6]:"pending"!==n?[3,3]:[4,bh(i.remoteStore)];case 2:return a.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(sl(i,e,r||null),al(i,e),function(t,e){ri(ri(t)._n).Gt(e)}(i.localStore,e)):ei(),a.label=4;case 4:return[4,dl(i,o)];case 5:return a.sent(),[3,7];case 6:Yr("SyncEngine","Cannot apply mutation batch with id: "+e),a.label=7;case 7:return[2]}})})}function bl(t,e){return(0,O.mG)(this,void 0,void 0,function(){var n,r,i,o,a,s,u;return(0,O.Jh)(this,function(c){switch(c.label){case 0:return El(n=ri(t)),Al(n),!0!==e||!0===n.$o?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,wl(n,r.toArray())]);case 1:return i=c.sent(),n.$o=!0,[4,Ah(n.remoteStore,!0)];case 2:for(c.sent(),o=0,a=i;o<a.length;o++)ah(n.remoteStore,a[o]);return[3,7];case 3:return!1!==e||!1===n.$o?[3,7]:(s=[],u=Promise.resolve(),n.Vo.forEach(function(t,e){n.sharedClientState.isLocalQueryTarget(e)?s.push(e):u=u.then(function(){return ul(n,e),gc(n.localStore,e,!0)}),sh(n.remoteStore,e)}),[4,u]);case 4:return c.sent(),[4,wl(n,s)];case 5:return c.sent(),function(t){var e=ri(t);e.Co.forEach(function(t,n){sh(e.remoteStore,n)}),e.No.ts(),e.Co=new Map,e.Do=new ga(xi.comparator)}(n),n.$o=!1,[4,Ah(n.remoteStore,!1)];case 6:c.sent(),c.label=7;case 7:return[2]}})})}function wl(t,e,n){return(0,O.mG)(this,void 0,void 0,function(){var n,r,i,o,a,s,u,c,h,l,f,d,p;return(0,O.Jh)(this,function(g){switch(g.label){case 0:n=ri(t),r=[],i=[],o=0,a=e,g.label=1;case 1:return o<a.length?(u=void 0,(c=n.Vo.get(s=a[o]))&&0!==c.length?[4,pc(n.localStore,Io(c[0]))]:[3,7]):[3,13];case 2:u=g.sent(),h=0,l=c,g.label=3;case 3:return h<l.length?(f=n.Po.get(l[h]),[4,ml(n,f)]):[3,6];case 4:(d=g.sent()).snapshot&&i.push(d.snapshot),g.label=5;case 5:return h++,[3,3];case 6:return[3,11];case 7:return[4,yc(n.localStore,s)];case 8:return p=g.sent(),[4,pc(n.localStore,p)];case 9:return u=g.sent(),[4,Yh(n,Tl(p),s,!1)];case 10:g.sent(),g.label=11;case 11:r.push(u),g.label=12;case 12:return o++,[3,1];case 13:return[2,(n.vo._r(i),r)]}})})}function Tl(t){return mo(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function kl(t){var e=ri(t);return ri(ri(e.localStore).persistence).fn()}function _l(t,e,n,r){return(0,O.mG)(this,void 0,void 0,function(){var i,o,a;return(0,O.Jh)(this,function(s){switch(s.label){case 0:return(i=ri(t)).$o?(Yr("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Vo.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,vc(i.localStore)];case 3:return o=s.sent(),a=xa.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,dl(i,o,a)];case 4:return s.sent(),[3,8];case 5:return[4,gc(i.localStore,e,!0)];case 6:return s.sent(),ul(i,e,r),[3,8];case 7:ei(),s.label=8;case 8:return[2]}})})}function Il(t,e,n){return(0,O.mG)(this,void 0,void 0,function(){var r,i,o,a,s,u,c,h,l;return(0,O.Jh)(this,function(f){switch(f.label){case 0:if(!(r=El(t)).$o)return[3,10];i=0,o=e,f.label=1;case 1:return i<o.length?r.Vo.has(a=o[i])?(Yr("SyncEngine","Adding an already active target "+a),[3,5]):[4,yc(r.localStore,a)]:[3,6];case 2:return s=f.sent(),[4,pc(r.localStore,s)];case 3:return u=f.sent(),[4,Yh(r,Tl(s),u.targetId,!1)];case 4:f.sent(),ah(r.remoteStore,u),f.label=5;case 5:return i++,[3,1];case 6:c=function(t){return(0,O.Jh)(this,function(e){switch(e.label){case 0:return r.Vo.has(t)?[4,gc(r.localStore,t,!1).then(function(){sh(r.remoteStore,t),ul(r,t)}).catch(Ou)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})},h=0,l=n,f.label=7;case 7:return h<l.length?[5,c(l[h])]:[3,10];case 8:f.sent(),f.label=9;case 9:return h++,[3,7];case 10:return[2]}})})}function El(t){var e=ri(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=tl.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=gl.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=nl.bind(null,e),e.vo._r=Fh.bind(null,e.eventManager),e.vo.Mo=Mh.bind(null,e.eventManager),e}function Al(t){var e=ri(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=rl.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=il.bind(null,e),e}var Sl=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return(0,O.mG)(this,void 0,void 0,function(){return(0,O.Jh)(this,function(e){switch(e.label){case 0:return this.R=Wc(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Ko(t),[2]}})})},t.prototype.Uo=function(t){return null},t.prototype.Ko=function(t){return sc(this.persistence,new oc,t.initialUser,this.R)},t.prototype.qo=function(t){return new Nc(Cc.bs,this.R)},t.prototype.Bo=function(t){return new jc},t.prototype.terminate=function(){return(0,O.mG)(this,void 0,void 0,function(){return(0,O.Jh)(this,function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}})})},t}(),Dl=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Qo=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return(0,O.ZT)(e,t),e.prototype.initialize=function(e){return(0,O.mG)(this,void 0,void 0,function(){return(0,O.Jh)(this,function(n){switch(n.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return n.sent(),[4,bc(this.localStore)];case 2:return n.sent(),[4,this.Qo.initialize(this,e)];case 3:return n.sent(),[4,Al(this.Qo.syncEngine)];case 4:return n.sent(),[4,bh(this.Qo.remoteStore)];case 5:return n.sent(),[2]}})})},e.prototype.Ko=function(t){return sc(this.persistence,new oc,t.initialUser,this.R)},e.prototype.Uo=function(t){return new Fu(this.persistence.referenceDelegate.garbageCollector,t.asyncQueue)},e.prototype.qo=function(t){var e=ec(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?ku.withCacheSize(this.cacheSizeBytes):ku.DEFAULT;return new Xu(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,zc(),Hc(),this.R,this.sharedClientState,!!this.forceOwnership)},e.prototype.Bo=function(t){return new jc},e}(Sl),Nl=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Qo=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return(0,O.ZT)(e,t),e.prototype.initialize=function(e){return(0,O.mG)(this,void 0,void 0,function(){var n,r=this;return(0,O.Jh)(this,function(i){switch(i.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return i.sent(),n=this.Qo.syncEngine,this.sharedClientState instanceof Vc?(this.sharedClientState.syncEngine={ui:vl.bind(null,n),ai:_l.bind(null,n),hi:Il.bind(null,n),fn:kl.bind(null,n),ci:yl.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:i.sent(),i.label=3;case 3:return[4,this.persistence.He(function(t){return(0,O.mG)(r,void 0,void 0,function(){return(0,O.Jh)(this,function(e){switch(e.label){case 0:return[4,bl(this.Qo.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}})})})];case 4:return i.sent(),[2]}})})},e.prototype.Bo=function(t){var e=zc();if(!Vc.yt(e))throw new zr(Qr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=ec(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new Vc(e,t.asyncQueue,n,t.clientId,t.initialUser)},e}(Dl),xl=function(){function t(){}return t.prototype.initialize=function(t,e){return(0,O.mG)(this,void 0,void 0,function(){var n=this;return(0,O.Jh)(this,function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return el(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=pl.bind(null,this.syncEngine),[4,Ah(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}})})},t.prototype.createEventManager=function(t){return new Oh},t.prototype.createDatastore=function(t){var e=Wc(t.databaseInfo.databaseId),n=new Qc(t.databaseInfo);return function(t,e,n){return new eh(t,e,n)}(t.credentials,n,e)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,a=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return el(a.syncEngine,t,0)},o=Gc.yt()?new Gc:new Bc,new rh(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,a){var s=new Hh(t,e,n,r,i,o);return a&&(s.$o=!0),s}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},t.prototype.terminate=function(){return function(t){return(0,O.mG)(this,void 0,void 0,function(){var e;return(0,O.Jh)(this,function(n){switch(n.label){case 0:return e=ri(t),Yr("RemoteStore","RemoteStore shutting down."),e.Or.add(5),[4,oh(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}})})}(this.remoteStore)},t}(),Cl=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},t}(),Rl=(function(){function t(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new Vs,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then(function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))},function(t){return n.metadata.reject(t)})}t.prototype.close=function(){return this.Go.cancel()},t.prototype.getMetadata=function(){return(0,O.mG)(this,void 0,void 0,function(){return(0,O.Jh)(this,function(t){return[2,this.metadata.promise]})})},t.prototype.Lo=function(){return(0,O.mG)(this,void 0,void 0,function(){return(0,O.Jh)(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}})})},t.prototype.Ho=function(){return(0,O.mG)(this,void 0,void 0,function(){var t,e,n,r;return(0,O.Jh)(this,function(i){switch(i.label){case 0:return[4,this.Jo()];case 1:return null===(t=i.sent())?[2,null]:(e=this.zo.decode(t),n=Number(e),isNaN(n)&&this.Yo("length string ("+e+") is not valid number"),[4,this.Xo(n)]);case 2:return r=i.sent(),[2,new jh(JSON.parse(r),t.length+n)]}})})},t.prototype.Zo=function(){return this.buffer.findIndex(function(t){return t==="{".charCodeAt(0)})},t.prototype.Jo=function(){return(0,O.mG)(this,void 0,void 0,function(){var t,e;return(0,O.Jh)(this,function(n){switch(n.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}})})},t.prototype.Xo=function(t){return(0,O.mG)(this,void 0,void 0,function(){var e;return(0,O.Jh)(this,function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:n.sent()&&this.Yo("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}})})},t.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},t.prototype.tc=function(){return(0,O.mG)(this,void 0,void 0,function(){var t,e;return(0,O.Jh)(this,function(n){switch(n.label){case 0:return[4,this.Go.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}})})}}(),function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return(0,O.mG)(this,void 0,void 0,function(){var e,n=this;return(0,O.Jh)(this,function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new zr(Qr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return(0,O.mG)(this,void 0,void 0,function(){var n,r,i,o,a,s;return(0,O.Jh)(this,function(u){switch(u.label){case 0:return n=ri(t),r=Xa(n.R)+"/documents",i={documents:e.map(function(t){return za(n.R,t)})},[4,n.$i("BatchGetDocuments",r,i)];case 1:return o=u.sent(),a=new Map,o.forEach(function(t){var e=function(t,e){return"found"in e?function(t,e){ni(!!e.found);var n=Ha(t,e.found.name),r=Ka(e.found.updateTime),i=new Ki({mapValue:{fields:e.found.fields}});return Qi.newFoundDocument(n,r,i)}(t,e):"missing"in e?function(t,e){ni(!!e.missing),ni(!!e.readTime);var n=Ha(t,e.missing),r=Ka(e.readTime);return Qi.newNoDocument(n,r)}(t,e):ei()}(n.R,t);a.set(e.key.toString(),e)}),s=[],[2,(e.forEach(function(t){var e=a.get(t.toString());ni(!!e),s.push(e)}),s)]}})})}(this.datastore,t)];case 1:return[2,((e=r.sent()).forEach(function(t){return n.recordVersion(t)}),e)]}})})},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new ha(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return(0,O.mG)(this,void 0,void 0,function(){var t,e=this;return(0,O.Jh)(this,function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach(function(e){t.delete(e.key.toString())}),t.forEach(function(t,n){var r=xi.fromPath(n);e.mutations.push(new la(r,e.precondition(r)))}),[4,function(t,e){return(0,O.mG)(this,void 0,void 0,function(){var n,r,i;return(0,O.Jh)(this,function(o){switch(o.label){case 0:return n=ri(t),r=Xa(n.R)+"/documents",i={writes:e.map(function(t){return ns(n.R,t)})},[4,n.Ni("Commit",r,i)];case 1:return o.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}})})},t.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw ei();e=hi.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new zr(Qr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?Ho.updateTime(e):Ho.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(hi.min()))throw new zr(Qr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ho.updateTime(e)}return Ho.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}()),ql=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new Yc(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.ec-=1,this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji(function(){return(0,O.mG)(t,void 0,void 0,function(){var t,e,n=this;return(0,O.Jh)(this,function(r){return t=new Rl(this.datastore),(e=this.sc(t))&&e.then(function(e){n.asyncQueue.enqueueAndForget(function(){return t.commit().then(function(){n.deferred.resolve(e)}).catch(function(t){n.ic(t)})})}).catch(function(t){n.ic(t)}),[2]})})})},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!Si(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget(function(){return e.nc(),Promise.resolve()})):this.deferred.reject(t)},t.prototype.rc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!da(e)}return!1},t}(),Ul=function(){function t(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=Rc.UNAUTHENTICATED,this.clientId=oi.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(e,function(t){return(0,O.mG)(r,void 0,void 0,function(){return(0,O.Jh)(this,function(e){switch(e.label){case 0:return Yr("FirestoreClient","Received user=",t.uid),[4,this.credentialListener(t)];case 1:return e.sent(),this.user=t,[2]}})})})}return t.prototype.getConfiguration=function(){return(0,O.mG)(this,void 0,void 0,function(){return(0,O.Jh)(this,function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]})})},t.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new zr(Qr.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new Vs;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return(0,O.mG)(t,void 0,void 0,function(){var t,n;return(0,O.Jh)(this,function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=r.sent(),n=xh(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}})})}),e.promise},t}();function Ol(t,e){return(0,O.mG)(this,void 0,void 0,function(){var n,r,i=this;return(0,O.Jh)(this,function(o){switch(o.label){case 0:return t.asyncQueue.verifyOperationInProgress(),Yr("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=o.sent(),[4,e.initialize(n)];case 2:return o.sent(),r=n.initialUser,t.setCredentialChangeListener(function(t){return(0,O.mG)(i,void 0,void 0,function(){return(0,O.Jh)(this,function(n){switch(n.label){case 0:return r.isEqual(t)?[3,2]:[4,uc(e.localStore,t)];case 1:n.sent(),r=t,n.label=2;case 2:return[2]}})})}),e.persistence.setDatabaseDeletedListener(function(){return t.terminate()}),t.offlineComponents=e,[2]}})})}function Ll(t,e){return(0,O.mG)(this,void 0,void 0,function(){var n,r;return(0,O.Jh)(this,function(i){switch(i.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,Pl(t)];case 1:return n=i.sent(),Yr("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=i.sent(),[4,e.initialize(n,r)];case 3:return i.sent(),t.setCredentialChangeListener(function(t){return function(t,e){return(0,O.mG)(this,void 0,void 0,function(){var n,r;return(0,O.Jh)(this,function(i){switch(i.label){case 0:return(n=ri(t)).asyncQueue.verifyOperationInProgress(),Yr("RemoteStore","RemoteStore received new credentials"),r=fh(n),n.Or.add(3),[4,oh(n)];case 1:return i.sent(),r&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return i.sent(),n.Or.delete(3),[4,ih(n)];case 3:return i.sent(),[2]}})})}(e.remoteStore,t)}),t.onlineComponents=e,[2]}})})}function Pl(t){return(0,O.mG)(this,void 0,void 0,function(){return(0,O.Jh)(this,function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(Yr("FirestoreClient","Using default OfflineComponentProvider"),[4,Ol(t,new Sl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}})})}function Fl(t){return(0,O.mG)(this,void 0,void 0,function(){return(0,O.Jh)(this,function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(Yr("FirestoreClient","Using default OnlineComponentProvider"),[4,Ll(t,new xl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}})})}function Ml(t){return Pl(t).then(function(t){return t.persistence})}function Zl(t){return Pl(t).then(function(t){return t.localStore})}function Vl(t){return Fl(t).then(function(t){return t.remoteStore})}function jl(t){return Fl(t).then(function(t){return t.syncEngine})}function Bl(t){return(0,O.mG)(this,void 0,void 0,function(){var e,n;return(0,O.Jh)(this,function(r){switch(r.label){case 0:return[4,Fl(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=Wh.bind(null,e.syncEngine),n.onUnlisten=Xh.bind(null,e.syncEngine),n)]}})})}function Gl(t,e,n){var r=this;void 0===n&&(n={});var i=new Vs;return t.asyncQueue.enqueueAndForget(function(){return(0,O.mG)(r,void 0,void 0,function(){var r;return(0,O.Jh)(this,function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new Cl({next:function(o){e.enqueueAndForget(function(){return Ph(t,a)});var s=o.docs.has(n);!s&&o.fromCache?i.reject(new zr(Qr.UNAVAILABLE,"Failed to get document because the client is offline.")):s&&o.fromCache&&r&&"server"===r.source?i.reject(new zr(Qr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),a=new Vh(yo(n.path),o,{includeMetadataChanges:!0,so:!0});return Lh(t,a)},[4,Bl(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}})})}),i.promise}function Kl(t,e,n){var r=this;void 0===n&&(n={});var i=new Vs;return t.asyncQueue.enqueueAndForget(function(){return(0,O.mG)(r,void 0,void 0,function(){var r;return(0,O.Jh)(this,function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new Cl({next:function(n){e.enqueueAndForget(function(){return Ph(t,a)}),n.fromCache&&"server"===r.source?i.reject(new zr(Qr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),a=new Vh(n,o,{includeMetadataChanges:!0,so:!0});return Lh(t,a)},[4,Bl(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}})})}),i.promise}var Jl=function(t,e,n,r,i,o,a,s){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.useFetchStreams=s},Ql=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),zl=new Map,Hl=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},Wl=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){this.changeListener=e,t.enqueueRetryable(function(){return e(Rc.UNAUTHENTICATED)})},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),Yl=function(){function t(t){this.token=t,this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(this.token)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){var n=this;this.changeListener=e,t.enqueueRetryable(function(){return e(n.token.user)})},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),Xl=function(){function t(t){var e=this;this.currentUser=Rc.UNAUTHENTICATED,this.oc=new Vs,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){e.cc++,e.currentUser=e.ac(),e.oc.resolve(),e.changeListener&&e.asyncQueue.enqueueRetryable(function(){return e.changeListener(e.currentUser)})};var n=function(t){Yr("FirebaseCredentialsProvider","Auth detected"),e.auth=t,e.auth.addAuthTokenListener(e.uc)};t.onInit(function(t){return n(t)}),setTimeout(function(){if(!e.auth){var r=t.getImmediate({optional:!0});r?n(r):(Yr("FirebaseCredentialsProvider","Auth not yet detected"),e.oc.resolve())}},0)}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(function(n){return t.cc!==e?(Yr("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(ni("string"==typeof n.accessToken),new Hl(n.accessToken,t.currentUser)):null}):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t,e){var n=this;this.asyncQueue=t,this.asyncQueue.enqueueRetryable(function(){return(0,O.mG)(n,void 0,void 0,function(){return(0,O.Jh)(this,function(t){switch(t.label){case 0:return[4,this.oc.promise];case 1:return t.sent(),[4,e(this.currentUser)];case 2:return t.sent(),this.changeListener=e,[2]}})})})},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},t.prototype.ac=function(){var t=this.auth&&this.auth.getUid();return ni(null===t||"string"==typeof t),new Rc(t)},t}(),$l=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n,this.type="FirstParty",this.user=Rc.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.lc},e=this.hc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t},enumerable:!1,configurable:!0}),t}(),tf=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n}return t.prototype.getToken=function(){return Promise.resolve(new $l(this.hc,this.lc,this.fc))},t.prototype.setChangeListener=function(t,e){t.enqueueRetryable(function(){return e(Rc.FIRST_PARTY)})},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function ef(t,e,n){if(!n)throw new zr(Qr.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function nf(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new zr(Qr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function rf(t,e,n,r){if(!0===e&&!0===r)throw new zr(Qr.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function of(t){if(!xi.isDocumentKey(t))throw new zr(Qr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function af(t){if(xi.isDocumentKey(t))throw new zr(Qr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function sf(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":ei()}function uf(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new zr(Qr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=sf(t);throw new zr(Qr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function cf(t,e){if(e<=0)throw new zr(Qr.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var hf=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new zr(Qr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new zr(Qr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,rf("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams},t}(),lf=function(){function t(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new hf({}),this._settingsFrozen=!1,t instanceof Ql?(this._databaseId=t,this._credentials=new Wl):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new zr(Qr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ql(t.options.projectId)}(t),this._credentials=new Xl(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new zr(Qr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new zr(Qr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new hf(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new Wl;switch(t.type){case"gapi":var e=t.client;return ni(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new tf(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new zr(Qr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return(t=zl.get(this))&&(Yr("ComponentProvider","Removing Datastore"),zl.delete(this),t.terminate()),Promise.resolve();var t},t}(),ff=function(){function t(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new pf(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),df=function(){function t(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),pf=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,yo(r))||this)._path=r,i.type="collection",i}return(0,O.ZT)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new ff(this.firestore,null,new xi(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._path)},e}(df);function gf(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=(0,L.m9)(t),ef("collection","path",e),t instanceof lf)return af(n=gi.fromString.apply(gi,(0,O.ev)([e],r))),new pf(t,null,n);if(!(t instanceof ff||t instanceof pf))throw new zr(Qr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return af(n=gi.fromString.apply(gi,(0,O.ev)([t.path],r)).child(gi.fromString(e))),new pf(t.firestore,null,n)}function mf(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=(0,L.m9)(t),1===arguments.length&&(e=oi.u()),ef("doc","path",e),t instanceof lf)return of(n=gi.fromString.apply(gi,(0,O.ev)([e],r))),new ff(t,null,new xi(n));if(!(t instanceof ff||t instanceof pf))throw new zr(Qr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return of(n=t._path.child(gi.fromString.apply(gi,(0,O.ev)([e],r)))),new ff(t.firestore,t instanceof pf?t.converter:null,new xi(n))}function yf(t,e){return t=(0,L.m9)(t),e=(0,L.m9)(e),(t instanceof ff||t instanceof pf)&&(e instanceof ff||e instanceof pf)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function vf(t,e){return t=(0,L.m9)(t),e=(0,L.m9)(e),t instanceof df&&e instanceof df&&t.firestore===e.firestore&&Ao(t._query,e._query)&&t.converter===e.converter}var bf=function(){function t(){var t=this;this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.yc=null,this.gc=!1,this.Ec=[],this.Zi=new Yc(this,"async_queue_retry"),this.Tc=function(){var e=Hc();e&&Yr("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=Hc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Tc)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this._c},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ic(),this.Ac(t)},t.prototype.enterRestrictedMode=function(){if(!this._c){this._c=!0;var t=Hc();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Tc)}},t.prototype.enqueue=function(t){return this.Ic(),this._c?new Promise(function(t){}):this.Ac(t)},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget(function(){return e.wc.push(t),e.Rc()})},t.prototype.Rc=function(){return(0,O.mG)(this,void 0,void 0,function(){var t,e=this;return(0,O.Jh)(this,function(n){switch(n.label){case 0:if(0===this.wc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.wc[0]()];case 2:return n.sent(),this.wc.shift(),this.Zi.reset(),[3,4];case 3:if(!Qs(t=n.sent()))throw t;return Yr("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.wc.length>0&&this.Zi.ji(function(){return e.Rc()}),n.label=5;case 5:return[2]}})})},t.prototype.Ac=function(t){var e=this,n=this.dc.then(function(){return e.gc=!0,t().catch(function(t){throw e.yc=t,e.gc=!1,Xr("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(function(t){return e.gc=!1,t})});return this.dc=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Ic(),this.Ec.indexOf(t)>-1&&(e=0);var i=Nh.createAndSchedule(this,t,e,n,function(t){return r.bc(t)});return this.mc.push(i),i},t.prototype.Ic=function(){this.yc&&ei()},t.prototype.verifyOperationInProgress=function(){},t.prototype.vc=function(){return(0,O.mG)(this,void 0,void 0,function(){var t;return(0,O.Jh)(this,function(e){switch(e.label){case 0:return[4,t=this.dc];case 1:e.sent(),e.label=2;case 2:if(t!==this.dc)return[3,0];e.label=3;case 3:return[2]}})})},t.prototype.Pc=function(t){for(var e=0,n=this.mc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.Vc=function(t){var e=this;return this.vc().then(function(){e.mc.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var n=0,r=e.mc;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.vc()})},t.prototype.Sc=function(t){this.Ec.push(t)},t.prototype.bc=function(t){var e=this.mc.indexOf(t);this.mc.splice(e,1)},t}();function wf(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}!function(){function t(){this._progressObserver={},this._taskCompletionResolver=new Vs,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}t.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},t.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},t.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},t.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},t.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}();var Tf=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).type="firestore",r._queue=new bf,r._persistenceKey="name"in e?e.name:"[DEFAULT]",r}return(0,O.ZT)(e,t),e.prototype._terminate=function(){return this._firestoreClient||_f(this),this._firestoreClient.terminate()},e}(lf);function kf(t){return t._firestoreClient||_f(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function _f(t){var e,n=t._freezeSettings(),r=function(t,e,n,r){return new Jl(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new Ul(t._credentials,t._queue,r)}function If(t,e,n){var r=this,i=new Vs;return t.asyncQueue.enqueue(function(){return(0,O.mG)(r,void 0,void 0,function(){var r;return(0,O.Jh)(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,Ol(t,n)];case 1:return o.sent(),[4,Ll(t,e)];case 2:return o.sent(),i.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===Qr.FAILED_PRECONDITION||t.code===Qr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(r=o.sent()))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r),[3,4];case 4:return[2]}})})}).then(function(){return i.promise})}function Ef(t){if(t._initialized||t._terminated)throw new zr(Qr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Af=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new zr(Qr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new yi(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),Sf=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(bi.fromBase64String(e))}catch(e){throw new zr(Qr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(bi.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),Df=function(t){this._methodName=t},Nf=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new zr(Qr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new zr(Qr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return ai(this._lat,t._lat)||ai(this._long,t._long)},t}(),xf=/^__.*__$/,Cf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new ia(t,this.data,this.fieldMask,e,this.fieldTransforms):new ra(t,this.data,e,this.fieldTransforms)},t}(),Rf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new ia(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();function qf(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ei()}}var Uf=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Dc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Cc",{get:function(){return this.settings.Cc},enumerable:!1,configurable:!0}),t.prototype.Nc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.xc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Nc({path:n,Fc:!1});return r.kc(t),r},t.prototype.$c=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Nc({path:n,Fc:!1});return r.Dc(),r},t.prototype.Oc=function(t){return this.Nc({path:void 0,Fc:!0})},t.prototype.Mc=function(t){return td(t,this.settings.methodName,this.settings.Lc||!1,this.path,this.settings.Bc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})},t.prototype.Dc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.kc(this.path.get(t))},t.prototype.kc=function(t){if(0===t.length)throw this.Mc("Document fields must not be empty");if(qf(this.Cc)&&xf.test(t))throw this.Mc('Document fields cannot begin and end with "__"')},t}(),Of=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||Wc(t)}return t.prototype.qc=function(t,e,n,r){return void 0===r&&(r=!1),new Uf({Cc:t,methodName:e,Bc:n,path:yi.emptyPath(),Fc:!1,Lc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function Lf(t){var e=t._freezeSettings(),n=Wc(t._databaseId);return new Of(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Pf(t,e,n,r,i,o){void 0===o&&(o={});var a=t.qc(o.merge||o.mergeFields?2:0,e,n,i);Wf("Data must be an object, but it was:",a,r);var s,u,c=zf(r,a);if(o.merge)s=new vi(a.fieldMask),u=a.fieldTransforms;else if(o.mergeFields){for(var h=[],l=0,f=o.mergeFields;l<f.length;l++){var d=Yf(e,f[l],n);if(!a.contains(d))throw new zr(Qr.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");ed(h,d)||h.push(d)}s=new vi(h),u=a.fieldTransforms.filter(function(t){return s.covers(t.field)})}else s=null,u=a.fieldTransforms;return new Cf(new Ki(c),s,u)}var Ff=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,O.ZT)(e,t),e.prototype._toFieldTransform=function(t){if(2!==t.Cc)throw t.Mc(1===t.Cc?this._methodName+"() can only appear at the top level of your update data":this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(Df);function Mf(t,e,n){return new Uf({Cc:3,Bc:e.settings.Bc,methodName:t._methodName,Fc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var Zf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,O.ZT)(e,t),e.prototype._toFieldTransform=function(t){return new Qo(t.path,new Mo)},e.prototype.isEqual=function(t){return t instanceof e},e}(Df),Vf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Uc=n,r}return(0,O.ZT)(e,t),e.prototype._toFieldTransform=function(t){var e=Mf(this,t,!0),n=this.Uc.map(function(t){return Qf(t,e)}),r=new Zo(n);return new Qo(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(Df),jf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Uc=n,r}return(0,O.ZT)(e,t),e.prototype._toFieldTransform=function(t){var e=Mf(this,t,!0),n=this.Uc.map(function(t){return Qf(t,e)}),r=new jo(n);return new Qo(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(Df),Bf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return(0,O.ZT)(e,t),e.prototype._toFieldTransform=function(t){var e=new Go(t.R,Uo(t.R,this.Kc));return new Qo(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(Df);function Gf(t,e,n,r){var i=t.qc(1,e,n);Wf("Data must be an object, but it was:",i,r);var o=[],a=Ki.empty();fi(r,function(t,r){var s=$f(e,t,n);r=(0,L.m9)(r);var u=i.$c(s);if(r instanceof Ff)o.push(s);else{var c=Qf(r,u);null!=c&&(o.push(s),a.set(s,c))}});var s=new vi(o);return new Rf(a,s,i.fieldTransforms)}function Kf(t,e,n,r,i,o){var a=t.qc(1,e,n),s=[Yf(e,r,n)],u=[i];if(o.length%2!=0)throw new zr(Qr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)s.push(Yf(e,o[c])),u.push(o[c+1]);for(var h=[],l=Ki.empty(),f=s.length-1;f>=0;--f)if(!ed(h,s[f])){var d=s[f],p=u[f];p=(0,L.m9)(p);var g=a.$c(d);if(p instanceof Ff)h.push(d);else{var m=Qf(p,g);null!=m&&(h.push(d),l.set(d,m))}}var y=new vi(h);return new Rf(l,y,a.fieldTransforms)}function Jf(t,e,n,r){return void 0===r&&(r=!1),Qf(n,t.qc(r?4:3,e))}function Qf(t,e){if(Hf(t=(0,L.m9)(t)))return Wf("Unsupported field value:",e,t),zf(t,e);if(t instanceof Df)return function(t,e){if(!qf(e.Cc))throw e.Mc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Mc(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Fc&&4!==e.Cc)throw e.Mc("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var a=Qf(o[i],e.Oc(r));null==a&&(a={nullValue:"NULL_VALUE"}),n.push(a),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=(0,L.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Uo(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=ci.fromDate(t);return{timestampValue:ja(e.R,n)}}if(t instanceof ci)return n=new ci(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:ja(e.R,n)};if(t instanceof Nf)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Sf)return{bytesValue:Ba(e.R,t._byteString)};if(t instanceof ff){var r=t.firestore._databaseId;if(!r.isEqual(n=e.databaseId))throw e.Mc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:Ja(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Mc("Unsupported field value: "+sf(t))}(t,e)}function zf(t,e){var n={};return di(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):fi(t,function(t,r){var i=Qf(r,e.xc(t));null!=i&&(n[t]=i)}),{mapValue:{fields:n}}}function Hf(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof ci||t instanceof Nf||t instanceof Sf||t instanceof ff||t instanceof Df)}function Wf(t,e,n){if(!Hf(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=sf(n);throw e.Mc("an object"===r?t+" a custom object":t+" "+r)}}function Yf(t,e,n){if((e=(0,L.m9)(e))instanceof Af)return e._internalPath;if("string"==typeof e)return $f(t,e);throw td("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var Xf=new RegExp("[~\\*/\\[\\]]");function $f(t,e,n){if(e.search(Xf)>=0)throw td("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(Af.bind.apply(Af,(0,O.ev)([void 0],e.split(".")))))._internalPath}catch(tp){throw td("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function td(t,e,n,r,i){var o=r&&!r.isEmpty(),a=void 0!==i,s="Function "+e+"() called with invalid data";n&&(s+=" (via `toFirestore()`)");var u="";return(o||a)&&(u+=" (found",o&&(u+=" in field "+r),a&&(u+=" in document "+i),u+=")"),new zr(Qr.INVALID_ARGUMENT,(s+=". ")+t+u)}function ed(t,e){return t.some(function(t){return t.isEqual(e)})}var nd=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new ff(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new rd(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field(id("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),rd=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,O.ZT)(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(nd);function id(t,e){return"string"==typeof e?$f(t,e):e instanceof Af?e._internalPath:e._delegate._internalPath}var od=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),ad=function(t){function e(e,n,r,i,o,a){var s=this;return(s=t.call(this,e,n,r,i,a)||this)._firestore=e,s._firestoreImpl=e,s.metadata=o,s}return(0,O.ZT)(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new sd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field(id("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},e}(nd),sd=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,O.ZT)(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(ad),ud=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new od(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach(function(r){t.call(e,new sd(n._firestore,n._userDataWriter,r.key,r,new od(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))})},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new zr(Qr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map(function(e){return{type:"added",doc:new sd(t._firestore,t._userDataWriter,e.doc.key,e.doc,new od(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:n++}})}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter(function(t){return e||3!==t.type}).map(function(e){var n=new sd(t._firestore,t._userDataWriter,e.doc.key,e.doc,new od(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:cd(e.type),doc:n,oldIndex:i,newIndex:o}})}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function cd(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ei()}}function hd(t,e){return t instanceof ad&&e instanceof ad?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof ud&&e instanceof ud&&t._firestore===e._firestore&&vf(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function ld(t){if(bo(t)&&0===t.explicitOrderBy.length)throw new zr(Qr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var fd=function(){};function dd(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];t=o._apply(t)}return t}var pd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Qc=e,i.jc=n,i.Wc=r,i.type="where",i}return(0,O.ZT)(e,t),e.prototype._apply=function(t){var e=Lf(t.firestore),n=function(t,e,n,r,i,o,a){var s;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new zr(Qr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){Td(a,o);for(var u=[],c=0,h=a;c<h.length;c++)u.push(wd(r,t,h[c]));s={arrayValue:{values:u}}}else s=wd(r,t,a)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||Td(a,o),s=Jf(n,"where",a,"in"===o||"not-in"===o);var l=$i.create(i,o,s);return function(t,e){if(e.g()){var n=To(t);if(null!==n&&!n.isEqual(e.field))throw new zr(Qr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=wo(t);null!==r&&kd(0,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw new zr(Qr.INVALID_ARGUMENT,i===e.op?"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter.":"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,l),l}(t._query,0,e,t.firestore._databaseId,this.Qc,this.jc,this.Wc);return new df(t.firestore,t.converter,function(t,e){var n=t.filters.concat([e]);return new go(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))},e}(fd),gd=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Qc=e,r.Gc=n,r.type="orderBy",r}return(0,O.ZT)(e,t),e.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new zr(Qr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new zr(Qr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new ho(e,n);return function(t,e){if(null===wo(t)){var n=To(t);null!==n&&kd(0,n,e.field)}}(t,r),r}(t._query,this.Qc,this.Gc);return new df(t.firestore,t.converter,function(t,e){var n=t.explicitOrderBy.concat([e]);return new go(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))},e}(fd),md=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.zc=n,i.Hc=r,i}return(0,O.ZT)(e,t),e.prototype._apply=function(t){return new df(t.firestore,t.converter,Eo(t._query,this.zc,this.Hc))},e}(fd),yd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Jc=n,i.Yc=r,i}return(0,O.ZT)(e,t),e.prototype._apply=function(t){var e=bd(t,this.type,this.Jc,this.Yc);return new df(t.firestore,t.converter,function(t,e){return new go(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))},e}(fd),vd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Jc=n,i.Yc=r,i}return(0,O.ZT)(e,t),e.prototype._apply=function(t){var e=bd(t,this.type,this.Jc,this.Yc);return new df(t.firestore,t.converter,function(t,e){return new go(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))},e}(fd);function bd(t,e,n,r){if(n[0]=(0,L.m9)(n[0]),n[0]instanceof nd)return function(t,e,n,r,i){if(!r)throw new zr(Qr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],a=0,s=_o(t);a<s.length;a++){var u=s[a];if(u.field.isKeyField())o.push(Fi(e,r.key));else{var c=r.data.field(u.field);if(Ii(c))throw new zr(Qr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=u.field.canonicalString();throw new zr(Qr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new uo(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,r);var i=Lf(t.firestore);return function(t,e,n,r,i,o){var a=t.explicitOrderBy;if(i.length>a.length)throw new zr(Qr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var s=[],u=0;u<i.length;u++){var c=i[u];if(a[u].field.isKeyField()){if("string"!=typeof c)throw new zr(Qr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!ko(t)&&-1!==c.indexOf("/"))throw new zr(Qr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(gi.fromString(c));if(!xi.isDocumentKey(h))throw new zr(Qr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var l=new xi(h);s.push(Fi(e,l))}else{var f=Jf(n,r,c);s.push(f)}}return new uo(s,o)}(t._query,t.firestore._databaseId,i,e,n,r)}function wd(t,e,n){if("string"==typeof(n=(0,L.m9)(n))){if(""===n)throw new zr(Qr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!ko(e)&&-1!==n.indexOf("/"))throw new zr(Qr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(gi.fromString(n));if(!xi.isDocumentKey(r))throw new zr(Qr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return Fi(t,new xi(r))}if(n instanceof ff)return Fi(t,n._key);throw new zr(Qr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+sf(n)+".")}function Td(t,e){if(!Array.isArray(t)||0===t.length)throw new zr(Qr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new zr(Qr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function kd(t,e,n){if(!n.isEqual(e))throw new zr(Qr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}var _d=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),Ci(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ki(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(_i(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw ei()}},t.prototype.convertObject=function(t,e){var n=this,r={};return fi(t.fields,function(t,i){r[t]=n.convertValue(i,e)}),r},t.prototype.convertGeoPoint=function(t){return new Nf(ki(t.latitude),ki(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map(function(t){return n.convertValue(t,e)})},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=Ei(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Ai(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=Ti(t);return new ci(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=gi.fromString(t);ni(ys(n));var r=new Ql(n.get(1),n.get(3)),i=new xi(n.popFirst(5));return r.isEqual(e)||Xr("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();function Id(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Ed=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return(0,O.ZT)(e,t),e.prototype.convertBytes=function(t){return new Sf(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new ff(this.firestore,null,e)},e}(_d),Ad=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Lf(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=Sd(t,this._firestore),i=Id(r.converter,e,n),o=Pf(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(o.toMutation(r._key,Ho.none())),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();var o,a=Sd(t,this._firestore);return o="string"==typeof(e=(0,L.m9)(e))||e instanceof Af?Kf(this._dataReader,"WriteBatch.update",a._key,e,n,r):Gf(this._dataReader,"WriteBatch.update",a._key,e),this._mutations.push(o.toMutation(a._key,Ho.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=Sd(t,this._firestore);return this._mutations=this._mutations.concat(new ha(e._key,Ho.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new zr(Qr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function Sd(t,e){if((t=(0,L.m9)(t)).firestore!==e)throw new zr(Qr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var Dd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return(0,O.ZT)(e,t),e.prototype.convertBytes=function(t){return new Sf(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new ff(this.firestore,null,e)},e}(_d);function Nd(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=uf(t,ff);var o=uf(t.firestore,Tf),a=Lf(o);return Cd(o,[("string"==typeof(e=(0,L.m9)(e))||e instanceof Af?Kf(a,"updateDoc",t._key,e,n,r):Gf(a,"updateDoc",t._key,e)).toMutation(t._key,Ho.exists(!0))])}function xd(t){for(var e,n,r,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];t=(0,L.m9)(t);var a={includeMetadataChanges:!1},s=0;"object"!=typeof i[s]||wf(i[s])||(a=i[s],s++);var u,c,h,l={includeMetadataChanges:a.includeMetadataChanges};if(wf(i[s])){var f=i[s];i[s]=null===(e=f.next)||void 0===e?void 0:e.bind(f),i[s+1]=null===(n=f.error)||void 0===n?void 0:n.bind(f),i[s+2]=null===(r=f.complete)||void 0===r?void 0:r.bind(f)}if(t instanceof ff)c=uf(t.firestore,Tf),h=yo(t._key.path),u={next:function(e){i[s]&&i[s](Rd(c,t,e))},error:i[s+1],complete:i[s+2]};else{var d=uf(t,df);c=uf(d.firestore,Tf),h=d._query;var p=new Dd(c);u={next:function(t){i[s]&&i[s](new ud(c,p,d,t))},error:i[s+1],complete:i[s+2]},ld(t._query)}return function(t,e,n,r){var i=this,o=new Cl(r),a=new Vh(e,o,n);return t.asyncQueue.enqueueAndForget(function(){return(0,O.mG)(i,void 0,void 0,function(){var e;return(0,O.Jh)(this,function(n){switch(n.label){case 0:return e=Lh,[4,Bl(t)];case 1:return[2,e.apply(void 0,[n.sent(),a])]}})})}),function(){o.Wo(),t.asyncQueue.enqueueAndForget(function(){return(0,O.mG)(i,void 0,void 0,function(){var e;return(0,O.Jh)(this,function(n){switch(n.label){case 0:return e=Ph,[4,Bl(t)];case 1:return[2,e.apply(void 0,[n.sent(),a])]}})})})}}(kf(c),h,l,u)}function Cd(t,e){return function(t,e){var n=this,r=new Vs;return t.asyncQueue.enqueueAndForget(function(){return(0,O.mG)(n,void 0,void 0,function(){var n;return(0,O.Jh)(this,function(i){switch(i.label){case 0:return n=$h,[4,jl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(kf(t),e)}function Rd(t,e,n){var r=n.docs.get(e._key),i=new Dd(t);return new ad(t,i,e._key,r,new od(n.hasPendingWrites,n.fromCache),e.converter)}var qd=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return(0,O.ZT)(e,t),e.prototype.get=function(e){var n=this,r=Sd(e,this._firestore),i=new Dd(this._firestore);return t.prototype.get.call(this,e).then(function(t){return new ad(n._firestore,i,r._key,t._document,new od(!1,!1),r.converter)})},e}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=Lf(t)}return t.prototype.get=function(t){var e=this,n=Sd(t,this._firestore),r=new Ed(this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return ei();var i=t[0];if(i.isFoundDocument())return new nd(e._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new nd(e._firestore,r,n._key,null,n.converter);throw ei()})},t.prototype.set=function(t,e,n){var r=Sd(t,this._firestore),i=Id(r.converter,e,n),o=Pf(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o,a=Sd(t,this._firestore);return o="string"==typeof(e=(0,L.m9)(e))||e instanceof Af?Kf(this._dataReader,"Transaction.update",a._key,e,n,r):Gf(this._dataReader,"Transaction.update",a._key,e),this._transaction.update(a._key,o),this},t.prototype.delete=function(t){var e=Sd(t,this._firestore);return this._transaction.delete(e._key),this},t}());function Ud(){if("undefined"==typeof Uint8Array)throw new zr(Qr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Od(){if("undefined"==typeof atob)throw new zr(Qr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Ld=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return Od(),new t(Sf.fromBase64String(e))},t.fromUint8Array=function(e){return Ud(),new t(Sf.fromUint8Array(e))},t.prototype.toBase64=function(){return Od(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return Ud(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(),Pd=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){Ef(t=uf(t,Tf));var n=kf(t),r=t._freezeSettings(),i=new xl;return If(n,i,new Dl(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){Ef(t=uf(t,Tf));var e=kf(t),n=t._freezeSettings(),r=new xl;return If(e,r,new Nl(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new zr(Qr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new Vs;return t._queue.enqueueAndForgetEvenWhileRestricted(function(){return(0,O.mG)(e,void 0,void 0,function(){var e;return(0,O.Jh)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return(0,O.mG)(this,void 0,void 0,function(){return(0,O.Jh)(this,function(e){switch(e.label){case 0:return Gs.yt()?[4,Gs.delete(t+"main")]:[2,Promise.resolve()];case 1:return e.sent(),[2]}})})}(ec(t._databaseId,t._persistenceKey))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}})})}),n.promise}(t._delegate)},t}(),Fd=function(){function t(t,e,n){var r=this;this._delegate=e,this.Xc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof Ql||(this.Zc=t)}return Object.defineProperty(t.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){var e=this._delegate._getSettings();t.merge||e.host===t.host||$r("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e,n){void 0===n&&(n={}),function(t,e,n,r){void 0===r&&(r={});var i=(t=uf(t,lf))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&$r("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},i),{host:e+":"+n,ssl:!1})),r.mockUserToken){var o=(0,L.Sg)(r.mockUserToken),a=r.mockUserToken.sub||r.mockUserToken.user_id;if(!a)throw new zr(Qr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t._credentials=new Yl(new Hl(o,new Rc(a)))}}(this._delegate,t,e,n)},t.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return(0,O.mG)(e,void 0,void 0,function(){var e,n;return(0,O.Jh)(this,function(r){switch(r.label){case 0:return[4,Ml(t)];case 1:return e=r.sent(),[4,Vl(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),function(t){var e=ri(t);return e.Or.delete(0),ih(e)}(n))]}})})})}(kf(uf(this._delegate,Tf)))},t.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return(0,O.mG)(e,void 0,void 0,function(){var e,n;return(0,O.Jh)(this,function(r){switch(r.label){case 0:return[4,Ml(t)];case 1:return e=r.sent(),[4,Vl(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!1),function(t){return(0,O.mG)(this,void 0,void 0,function(){var e;return(0,O.Jh)(this,function(n){switch(n.label){case 0:return(e=ri(t)).Or.add(0),[4,oh(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}})})}(n))]}})})})}(kf(uf(this._delegate,Tf)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&rf("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Xc.enableMultiTabIndexedDbPersistence(this):this.Xc.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.Xc.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.Zc&&(this.Zc._removeServiceInstance("firestore"),this.Zc._removeServiceInstance("firestore-exp")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new Vs;return t.asyncQueue.enqueueAndForget(function(){return(0,O.mG)(e,void 0,void 0,function(){var e;return(0,O.Jh)(this,function(r){switch(r.label){case 0:return e=ol,[4,jl(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}})})}),n.promise}(kf(uf(this._delegate,Tf)))},t.prototype.onSnapshotsInSync=function(t){return function(t,e){return function(t,e){var n=this,r=new Cl(e);return t.asyncQueue.enqueueAndForget(function(){return(0,O.mG)(n,void 0,void 0,function(){var e;return(0,O.Jh)(this,function(n){switch(n.label){case 0:return e=function(t,e){ri(t).Gr.add(e),e.next()},[4,Bl(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})}),function(){r.Wo(),t.asyncQueue.enqueueAndForget(function(){return(0,O.mG)(n,void 0,void 0,function(){var e;return(0,O.Jh)(this,function(n){switch(n.label){case 0:return e=function(t,e){ri(t).Gr.delete(e)},[4,Bl(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})})}}(kf(t=uf(t,Tf)),wf(e)?e:{next:e})}(this._delegate,t)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.Zc)throw new zr(Qr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Zc},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new Xd(this,gf(this._delegate,t))}catch(t){throw Gd(t,"collection()","Firestore.collection()")}},t.prototype.doc=function(t){try{return new Bd(this,mf(this._delegate,t))}catch(t){throw Gd(t,"doc()","Firestore.doc()")}},t.prototype.collectionGroup=function(t){try{return new Hd(this,function(t,e){if(t=uf(t,lf),ef("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new zr(Qr.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new df(t,null,function(t){return new go(gi.emptyPath(),t)}(e))}(this._delegate,t))}catch(t){throw Gd(t,"collectionGroup()","Firestore.collectionGroup()")}},t.prototype.runTransaction=function(t){var e=this;return function(t,e){return function(t,e){var n=this,r=new Vs;return t.asyncQueue.enqueueAndForget(function(){return(0,O.mG)(n,void 0,void 0,function(){var n;return(0,O.Jh)(this,function(i){switch(i.label){case 0:return[4,function(t){return Fl(t).then(function(t){return t.datastore})}(t)];case 1:return n=i.sent(),new ql(t.asyncQueue,n,e,r).run(),[2]}})})}),r.promise}(kf(t),function(n){return e(new qd(t,n))})}(this._delegate,function(n){return t(new Zd(e,n))})},t.prototype.batch=function(){var t=this;return kf(this._delegate),new Vd(new Ad(this._delegate,function(e){return Cd(t._delegate,e)}))},t.prototype.loadBundle=function(t){throw new zr(Qr.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},t.prototype.namedQuery=function(t){throw new zr(Qr.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},t}(),Md=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return(0,O.ZT)(e,t),e.prototype.convertBytes=function(t){return new Ld(new Sf(t))},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return Bd.tu(e,this.firestore,null)},e}(_d),Zd=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new Md(t)}return t.prototype.get=function(t){var e=this,n=$d(t);return this._delegate.get(n).then(function(t){return new Qd(e._firestore,new ad(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n.converter))})},t.prototype.set=function(t,e,n){var r=$d(t);return n?(nf("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var a=$d(t);return 2===arguments.length?this._delegate.update(a,e):(r=this._delegate).update.apply(r,(0,O.ev)([a,e,n],i)),this},t.prototype.delete=function(t){var e=$d(t);return this._delegate.delete(e),this},t}(),Vd=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=$d(t);return n?(nf("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var a=$d(t);return 2===arguments.length?this._delegate.update(a,e):(r=this._delegate).update.apply(r,(0,O.ev)([a,e,n],i)),this},t.prototype.delete=function(t){var e=$d(t);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),jd=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new sd(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new zd(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.eu=function(e,n){var r=t.nu,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new Md(e),n),i.set(n,o)),o},t}();jd.nu=new WeakMap;var Bd=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Md(t)}return t.su=function(e,n,r){if(e.length%2!=0)throw new zr(Qr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(n,new ff(n._delegate,r,new xi(e)))},t.tu=function(e,n,r){return new t(n,new ff(n._delegate,r,e))},Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Xd(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new Xd(this.firestore,gf(this._delegate,t))}catch(t){throw Gd(t,"collection()","DocumentReference.collection()")}},t.prototype.isEqual=function(t){return(t=(0,L.m9)(t))instanceof ff&&yf(this._delegate,t)},t.prototype.set=function(t,e){e=nf("DocumentReference.set",e);try{return function(t,e,n){t=uf(t,ff);var r=uf(t.firestore,Tf),i=Id(t.converter,e,n);return Cd(r,[Pf(Lf(r),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,Ho.none())])}(this._delegate,t,e)}catch(t){throw Gd(t,"setDoc()","DocumentReference.set()")}},t.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?Nd(this._delegate,t):Nd.apply(void 0,(0,O.ev)([this._delegate,t,e],n))}catch(t){throw Gd(t,"updateDoc()","DocumentReference.update()")}},t.prototype.delete=function(){return Cd(uf((t=this._delegate).firestore,Tf),[new ha(t._key,Ho.none())]);var t},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Kd(e),i=Jd(e,function(e){return new Qd(t.firestore,new ad(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate.converter))});return xd(this._delegate,r,i)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=uf(t,ff);var e=uf(t.firestore,Tf),n=kf(e),r=new Dd(e);return function(t,e){var n=this,r=new Vs;return t.asyncQueue.enqueueAndForget(function(){return(0,O.mG)(n,void 0,void 0,function(){var n;return(0,O.Jh)(this,function(i){switch(i.label){case 0:return n=function(t,e,n){return(0,O.mG)(this,void 0,void 0,function(){var r,i;return(0,O.Jh)(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(t,e){var n=ri(t);return n.persistence.runTransaction("read document","readonly",function(t){return n.Mn.mn(t,e)})}(t,e)];case 1:return(i=o.sent()).isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new zr(Qr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=o.sent(),i=xh(r,"Failed to get document '"+e+" from cache"),n.reject(i),[3,3];case 3:return[2]}})})},[4,Zl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(n,t._key).then(function(n){return new ad(e,r,t._key,n,new od(null!==n&&n.hasLocalMutations,!0),t.converter)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=uf(t,ff);var e=uf(t.firestore,Tf);return Gl(kf(e),t._key,{source:"server"}).then(function(n){return Rd(e,t,n)})}(this._delegate):function(t){t=uf(t,ff);var e=uf(t.firestore,Tf);return Gl(kf(e),t._key).then(function(n){return Rd(e,t,n)})}(this._delegate)).then(function(t){return new Qd(e.firestore,new ad(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))})},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?jd.eu(this.firestore,e):null))},t}();function Gd(t,e,n){return t.message=t.message.replace(e,n),t}function Kd(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!wf(r))return r}return{}}function Jd(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=wf(t[0])?t[0]:wf(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var Qd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"ref",{get:function(){return new Bd(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return hd(this._delegate,t._delegate)},t}(),zd=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,O.ZT)(e,t),e.prototype.data=function(t){return this._delegate.data(t)},e}(Qd),Hd=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Md(t)}return t.prototype.where=function(e,n,r){try{return new t(this.firestore,dd(this._delegate,function(t,e,n){var r=e,i=id("where",t);return new pd(i,r,n)}(e,n,r)))}catch(e){throw Gd(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.orderBy=function(e,n){try{return new t(this.firestore,dd(this._delegate,function(t,e){void 0===e&&(e="asc");var n=e,r=id("orderBy",t);return new gd(r,n)}(e,n)))}catch(e){throw Gd(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.limit=function(e){try{return new t(this.firestore,dd(this._delegate,function(t){return cf("limit",t),new md("limit",t,"F")}(e)))}catch(e){throw Gd(e,"limit()","Query.limit()")}},t.prototype.limitToLast=function(e){try{return new t(this.firestore,dd(this._delegate,function(t){return cf("limitToLast",t),new md("limitToLast",t,"L")}(e)))}catch(e){throw Gd(e,"limitToLast()","Query.limitToLast()")}},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,dd(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new yd("startAt",t,!0)}).apply(void 0,e)))}catch(e){throw Gd(e,"startAt()","Query.startAt()")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,dd(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new yd("startAfter",t,!1)}).apply(void 0,e)))}catch(e){throw Gd(e,"startAfter()","Query.startAfter()")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,dd(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new vd("endBefore",t,!0)}).apply(void 0,e)))}catch(e){throw Gd(e,"endBefore()","Query.endBefore()")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,dd(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new vd("endAt",t,!1)}).apply(void 0,e)))}catch(e){throw Gd(e,"endAt()","Query.endAt()")}},t.prototype.isEqual=function(t){return vf(this._delegate,t._delegate)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=uf(t,df);var e=uf(t.firestore,Tf),n=kf(e),r=new Dd(e);return function(t,e){var n=this,r=new Vs;return t.asyncQueue.enqueueAndForget(function(){return(0,O.mG)(n,void 0,void 0,function(){var n;return(0,O.Jh)(this,function(i){switch(i.label){case 0:return n=function(t,e,n){return(0,O.mG)(this,void 0,void 0,function(){var r,i,o,a,s;return(0,O.Jh)(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,mc(t,e,!0)];case 1:return s=u.sent(),r=new Jh(e,s.Bn),i=r._o(s.documents),o=r.applyChanges(i,!1),n.resolve(o.snapshot),[3,3];case 2:return a=u.sent(),s=xh(a,"Failed to execute query '"+e+" against cache"),n.reject(s),[3,3];case 3:return[2]}})})},[4,Zl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(n,t._query).then(function(n){return new ud(e,r,t,n)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=uf(t,df);var e=uf(t.firestore,Tf),n=kf(e),r=new Dd(e);return Kl(n,t._query,{source:"server"}).then(function(n){return new ud(e,r,t,n)})}(this._delegate):function(t){t=uf(t,df);var e=uf(t.firestore,Tf),n=kf(e),r=new Dd(e);return ld(t._query),Kl(n,t._query).then(function(n){return new ud(e,r,t,n)})}(this._delegate)).then(function(t){return new Yd(e.firestore,new ud(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))})},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Kd(e),i=Jd(e,function(e){return new Yd(t.firestore,new ud(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))});return xd(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?jd.eu(this.firestore,e):null))},t}(),Wd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doc",{get:function(){return new zd(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),Yd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"query",{get:function(){return new Hd(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map(function(e){return new zd(t._firestore,e)})},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map(function(t){return new Wd(e._firestore,t)})},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach(function(r){t.call(e,new zd(n._firestore,r))})},t.prototype.isEqual=function(t){return hd(this._delegate,t._delegate)},t}(),Xd=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return(0,O.ZT)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new Bd(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new Bd(this.firestore,void 0===t?mf(this._delegate):mf(this._delegate,t))}catch(t){throw Gd(t,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e=this;return function(t,e){var n=uf(t.firestore,Tf),r=mf(t),i=Id(t.converter,e);return Cd(n,[Pf(Lf(t.firestore),"addDoc",r._key,i,null!==t.converter,{}).toMutation(r._key,Ho.exists(!1))]).then(function(){return r})}(this._delegate,t).then(function(t){return new Bd(e.firestore,t)})},e.prototype.isEqual=function(t){return yf(this._delegate,t._delegate)},e.prototype.withConverter=function(t){return new e(this.firestore,this._delegate.withConverter(t?jd.eu(this.firestore,t):null))},e}(Hd);function $d(t){return uf(t,ff)}var tp,ep=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(Af.bind.apply(Af,(0,O.ev)([void 0],t)))}return t.documentId=function(){return new t(yi.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=(0,L.m9)(t))instanceof Af&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),np=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new Zf("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new t(e)},t.delete=function(){var e=new Ff("deleteField");return e._methodName="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Vf("arrayUnion",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayUnion",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new jf("arrayRemove",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayRemove",new t(r)},t.increment=function(e){var n=function(t){return new Bf("increment",t)}(e);return n._methodName="FieldValue.increment",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}(),rp=n(5119),ip={Firestore:Fd,GeoPoint:Nf,Timestamp:ci,Blob:Ld,Transaction:Zd,WriteBatch:Vd,DocumentReference:Bd,DocumentSnapshot:Qd,Query:Hd,QueryDocumentSnapshot:zd,QuerySnapshot:Yd,CollectionReference:Xd,FieldPath:ep,FieldValue:np,setLogLevel:function(t){Hr.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};(function(t,e){t.INTERNAL.registerComponent(new rp.wA("firestore",function(t){return function(t,e){return new Fd(t,new Tf(t,e),new Pd)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))},"PUBLIC").setServiceProps(Object.assign({},ip)))})(tp=U.Z),tp.registerVersion("@firebase/firestore","2.3.8");var op=n(1428);function ap(t,e){return function(t,e=T.z){return new k.y(n=>{let r;return null!=e?e.schedule(()=>{r=t.onSnapshot({includeMetadataChanges:!0},n)}):r=t.onSnapshot({includeMetadataChanges:!0},n),()=>{null!=r&&r()}})}(t,e)}function sp(t,e){return ap(t,e).pipe((0,S.U)(t=>({payload:t,type:"query"})))}function up(t,e){return sp(t,e).pipe((0,E.O)(void 0),(0,A.G)(),(0,S.U)(([t,e])=>{const n=e.payload.docChanges(),r=n.map(t=>({type:t.type,payload:t}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(e.payload.metadata)&&e.payload.docs.forEach((e,i)=>{const o=n.find(t=>t.doc.ref.isEqual(e.ref)),a=null==t?void 0:t.payload.docs.find(t=>t.ref.isEqual(e.ref));o&&JSON.stringify(o.doc.metadata)===JSON.stringify(e.metadata)||!o&&a&&JSON.stringify(a.metadata)===JSON.stringify(e.metadata)||r.push({type:"modified",payload:{oldIndex:i,newIndex:i,type:"modified",doc:e}})}),r}))}function cp(t,e,n){return up(t,n).pipe((0,D.R)((t,n)=>function(t,e,n){return e.forEach(e=>{n.indexOf(e.type)>-1&&(t=function(t,e){switch(e.type){case"added":if(!t[e.newIndex]||!t[e.newIndex].doc.ref.isEqual(e.doc.ref))return hp(t,e.newIndex,0,e);break;case"modified":if(null==t[e.oldIndex]||t[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const n=t.slice();return n.splice(e.oldIndex,1),n.splice(e.newIndex,0,e),n}return hp(t,e.newIndex,1,e)}break;case"removed":if(t[e.oldIndex]&&t[e.oldIndex].doc.ref.isEqual(e.doc.ref))return hp(t,e.oldIndex,1)}return t}(t,e))}),t}(t,n.map(t=>t.payload),e),[]),(0,N.x)(),(0,S.U)(t=>t.map(t=>({type:t.type,payload:t}))))}function hp(t,e,n,...r){const i=t.slice();return i.splice(e,n,...r),i}function lp(t){return t&&0!==t.length||(t=["added","removed","modified"]),t}class fp{constructor(t,e,n){this.ref=t,this.query=e,this.afs=n}stateChanges(t){let e=up(this.query,this.afs.schedulers.outsideAngular);return t&&t.length>0&&(e=e.pipe((0,S.U)(e=>e.filter(e=>t.indexOf(e.type)>-1)))),e.pipe((0,E.O)(void 0),(0,A.G)(),(0,x.h)(([t,e])=>e.length>0||!t),(0,S.U)(([t,e])=>e),this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe((0,D.R)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=lp(t);return cp(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return sp(this.query,this.afs.schedulers.outsideAngular).pipe((0,S.U)(e=>e.payload.docs.map(e=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return(0,_.D)(this.query.get(t)).pipe((0,C.QV)(this.afs.schedulers.insideAngular))}add(t){return this.ref.add(t)}doc(t){return new dp(this.ref.doc(t),this.afs)}}class dp{constructor(t,e){this.ref=t,this.afs=e}set(t,e){return this.ref.set(t,e)}update(t){return this.ref.update(t)}delete(){return this.ref.delete()}collection(t,e){const n=this.ref.collection(t),{ref:r,query:i}=bp(n,e);return new fp(r,i,this.afs)}snapshotChanges(){return ap(this.ref,this.afs.schedulers.outsideAngular).pipe((0,E.O)(void 0),(0,A.G)(),(0,S.U)(([t,e])=>e.exists?(null==t?void 0:t.exists)?{payload:e,type:"modified"}:{payload:e,type:"added"}:{payload:e,type:"removed"})).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return this.snapshotChanges().pipe((0,S.U)(({payload:e})=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data()))}get(t){return(0,_.D)(this.ref.get(t)).pipe((0,C.QV)(this.afs.schedulers.insideAngular))}}class pp{constructor(t,e){this.query=t,this.afs=e}stateChanges(t){return t&&0!==t.length?up(this.query,this.afs.schedulers.outsideAngular).pipe((0,S.U)(e=>e.filter(e=>t.indexOf(e.type)>-1)),(0,x.h)(t=>t.length>0),this.afs.keepUnstableUntilFirst):up(this.query,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe((0,D.R)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=lp(t);return cp(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return sp(this.query,this.afs.schedulers.outsideAngular).pipe((0,S.U)(e=>e.payload.docs.map(e=>t.idField?Object.assign({[t.idField]:e.id},e.data()):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return(0,_.D)(this.query.get(t)).pipe((0,C.QV)(this.afs.schedulers.insideAngular))}}const gp=new i.OlP("angularfire2.enableFirestorePersistence"),mp=new i.OlP("angularfire2.firestore.persistenceSettings"),yp=new i.OlP("angularfire2.firestore.settings"),vp=new i.OlP("angularfire2.firestore.use-emulator");function bp(t,e=(t=>t)){return{query:e(t),ref:t}}let wp=(()=>{class t{constructor(t,e,n,i,o,a,s,u,c){this.schedulers=new R.HU(a),this.keepUnstableUntilFirst=(0,R.ss)(this.schedulers);const h=(0,R.on)(t,a,e);!q.Z.auth&&c&&(0,R.yq)();const l=u;[this.firestore,this.persistenceEnabled$]=(0,R.sI)(`${h.name}.firestore`,"AngularFirestore",h,()=>{const t=a.runOutsideAngular(()=>h.firestore());if(i&&t.settings(i),l&&t.useEmulator(...l),n&&!(0,r.PM)(o)){const e=()=>{try{return(0,_.D)(t.enablePersistence(s||void 0).then(()=>!0,()=>!1))}catch(tp){return"undefined"!=typeof console&&console.warn(tp),(0,I.of)(!1)}};return[t,a.runOutsideAngular(e)]}return[t,(0,I.of)(!1)]},[i,l,n])}collection(t,e){let n;n="string"==typeof t?this.firestore.collection(t):t;const{ref:r,query:i}=bp(n,e),o=this.schedulers.ngZone.run(()=>r);return new fp(o,i,this)}collectionGroup(t,e){const n=e||(t=>t),r=this.firestore.collectionGroup(t);return new pp(n(r),this)}doc(t){let e;e="string"==typeof t?this.firestore.doc(t):t;const n=this.schedulers.ngZone.run(()=>e);return new dp(n,this)}createId(){return this.firestore.collection("_").doc().id}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(R.Dh),i.LFG(R.xv,8),i.LFG(gp,8),i.LFG(yp,8),i.LFG(i.Lbi),i.LFG(i.R0b),i.LFG(mp,8),i.LFG(vp,8),i.LFG(op.Qv,8))},t.\u0275prov=i.Yz7({factory:function(){return new t(i.LFG(R.Dh),i.LFG(R.xv,8),i.LFG(gp,8),i.LFG(yp,8),i.LFG(i.Lbi),i.LFG(i.R0b),i.LFG(mp,8),i.LFG(vp,8),i.LFG(op.Qv,8))},token:t,providedIn:"any"}),t})();var Tp=n(3070),kp=n(9550);let _p=(()=>{class t{constructor(t,e,n,r,i){this.dialogRef=t,this.data=e,this.api=n,this.db=r,this.auth=i,this.userData={},this.loading=!1}ngOnInit(){this.auth.user.subscribe(t=>{this.userData=t})}saveData(){if(this.loading=!0,null==this.data.id){let t=(new Date).getTime().toString();this.data.uid=this.userData.uid,this.db.collection("books").doc(t).set(this.data).then(t=>{this.dialogRef.close(this.data),this.loading=!1}).catch(t=>{console.log(t),this.loading=!1,alert("Tidak dapat menyimpan data")})}else this.db.collection("books").doc(this.data.id).update(this.data).then(t=>{this.dialogRef.close(!1),this.loading=!1}).catch(t=>{console.log(t),this.loading=!1,alert("Tidak dapat menyimpan data")})}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(v.so),i.Y36(v.WI),i.Y36(b.s),i.Y36(wp),i.Y36(op.zQ))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-product-detail"]],decls:20,vars:5,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["appearance","outline",2,"width","100%"],["matInput","",3,"ngModel","ngModelChange"],["mat-dialog-actions","","align","end"],["mat-button","","mat-dialog-close",""],["mat-flat-button","",3,"disabled","click"]],template:function(t,e){1&t&&(i.TgZ(0,"h3",0),i._uU(1," Detail Penulis\n"),i.qZA(),i.TgZ(2,"div",1),i.TgZ(3,"mat-form-field",2),i.TgZ(4,"mat-label"),i._uU(5,"Judul"),i.qZA(),i.TgZ(6,"input",3),i.NdJ("ngModelChange",function(t){return e.data.title=t}),i.qZA(),i.qZA(),i.TgZ(7,"mat-form-field",2),i.TgZ(8,"mat-label"),i._uU(9,"Penulis"),i.qZA(),i.TgZ(10,"input",3),i.NdJ("ngModelChange",function(t){return e.data.author=t}),i.qZA(),i.qZA(),i.TgZ(11,"mat-form-field",2),i.TgZ(12,"mat-label"),i._uU(13,"Tahun Terbit"),i.qZA(),i.TgZ(14,"input",3),i.NdJ("ngModelChange",function(t){return e.data.year=t}),i.qZA(),i.qZA(),i.qZA(),i.TgZ(15,"div",4),i.TgZ(16,"button",5),i._uU(17,"Batal"),i.qZA(),i.TgZ(18,"button",6),i.NdJ("click",function(){return e.saveData()}),i._uU(19),i.qZA(),i.qZA()),2&t&&(i.xp6(6),i.Q6J("ngModel",e.data.title),i.xp6(4),i.Q6J("ngModel",e.data.author),i.xp6(4),i.Q6J("ngModel",e.data.year),i.xp6(4),i.Q6J("disabled",e.loading),i.xp6(1),i.Oqu(e.loading?"Menyimpan..":"Simpan"))},directives:[v.uh,v.xY,Tp.KE,Tp.hX,kp.Nt,m.Fj,m.JJ,m.On,v.H8,s.lW,v.ZT],styles:[""]}),t})();var Ip=n(7672);function Ep(t,e){1&t&&(i.TgZ(0,"div",2),i._UZ(1,"mat-spinner"),i.qZA())}function Ap(t,e){1&t&&i._UZ(0,"button",12)}function Sp(t,e){if(1&t){const t=i.EpF();i.TgZ(0,"tr"),i.TgZ(1,"td"),i.YNc(2,Ap,1,0,"button",9),i.qZA(),i.TgZ(3,"td"),i._uU(4),i.qZA(),i.TgZ(5,"td"),i._uU(6),i.qZA(),i.TgZ(7,"td"),i._uU(8),i.qZA(),i.TgZ(9,"td"),i._uU(10),i.qZA(),i.TgZ(11,"td",7),i.TgZ(12,"button",10),i.NdJ("click",function(){const e=i.CHM(t),n=e.$implicit,r=e.index;return i.oxw(2).productDetail(n,r)}),i._uU(13,"Edit"),i.qZA(),i.TgZ(14,"button",11),i.NdJ("click",function(){const e=i.CHM(t),n=e.$implicit,r=e.index;return i.oxw(2).deleteProduct(n.id,r)}),i._uU(15),i.qZA(),i.qZA(),i.qZA()}if(2&t){const t=e.$implicit,n=e.index,r=i.oxw(2);i.xp6(2),i.Q6J("ngIf",""!=t.url),i.xp6(2),i.Oqu(n+1),i.xp6(2),i.Oqu(t.title),i.xp6(2),i.Oqu(t.author),i.xp6(2),i.Oqu(t.year),i.xp6(4),i.Q6J("disabled",r.loadingDelete[n]),i.xp6(1),i.Oqu(r.loadingDelete[n]?"Menghapus..":"Delete")}}function Dp(t,e){if(1&t){const t=i.EpF();i.TgZ(0,"mat-card"),i.TgZ(1,"mat-card-header"),i.TgZ(2,"mat-card-title"),i._uU(3),i.qZA(),i.qZA(),i.TgZ(4,"mat-card-content"),i.TgZ(5,"div",3),i._UZ(6,"span",4),i.TgZ(7,"button",5),i.NdJ("click",function(){return i.CHM(t),i.oxw().productDetail({},-1)}),i._uU(8,"Tambah Penulis"),i.qZA(),i.qZA(),i.TgZ(9,"table",6),i.TgZ(10,"thead"),i._UZ(11,"th"),i.TgZ(12,"th"),i._uU(13,"No"),i.qZA(),i.TgZ(14,"th"),i._uU(15,"Judul"),i.qZA(),i.TgZ(16,"th"),i._uU(17,"Penulis"),i.qZA(),i.TgZ(18,"th"),i._uU(19,"Tahun Terbit"),i.qZA(),i.TgZ(20,"th",7),i._uU(21,"#"),i.qZA(),i.qZA(),i.TgZ(22,"tbody"),i.YNc(23,Sp,16,7,"tr",8),i.qZA(),i.qZA(),i.qZA(),i.qZA()}if(2&t){const t=i.oxw();i.xp6(3),i.Oqu(t.title),i.xp6(20),i.Q6J("ngForOf",t.books)}}const Np=[{path:"",component:f,children:[{path:"dashboard",component:p},{path:"product",component:(()=>{class t{constructor(t,e,n,r){this.dialog=t,this.api=e,this.db=n,this.auth=r,this.books=[],this.userData={},this.loading=!1,this.loadingDelete={}}ngOnInit(){this.title="Daftar Resep Kue",this.auth.user.subscribe(t=>{this.userData=t,this.getBooks()})}getBooks(){this.loading=!0,this.db.collection("books",t=>t.where("uid","==",this.userData.uid)).valueChanges({idField:"id"}).subscribe(t=>{console.log(t),this.books=t,this.loading=!1},t=>{this.loading=!1})}productDetail(t,e){this.dialog.open(_p,{width:"400px",data:t}).afterClosed().subscribe(t=>{})}deleteProduct(t,e){confirm("Delete item?")&&this.db.collection("books").doc(t).delete().then(t=>{this.books.splice(e,1),this.loadingDelete[e]=!1}).catch(t=>{this.loadingDelete[e]=!1,alert("Tidak dapat menghapus data")})}uploadFile(t){this.dialog.open(w,{width:"400px",data:t}).afterClosed().subscribe(t=>{})}downloadFile(t){y.saveAs("http://api.sunhouse.co.id/bookstore/"+t.url)}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(v.uw),i.Y36(b.s),i.Y36(wp),i.Y36(op.zQ))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-product"]],decls:2,vars:2,consts:[["style","height: 300px;","class","uk-flex uk-flex-center uk-flex-middle",4,"ngIf"],[4,"ngIf"],[1,"uk-flex","uk-flex-center","uk-flex-middle",2,"height","300px"],[1,"uk-flex"],[1,"uk-width-expand"],["mat-flat-button","","color","primary",3,"click"],[1,"uk-table","uk-table-middle","uk-table-divider"],["align","right"],[4,"ngFor","ngForOf"],["mat-icon-button","",4,"ngIf"],["mat-button","","color","primary",3,"click"],["mat-button","","color","warn",3,"disabled","click"],["mat-icon-button",""]],template:function(t,e){1&t&&(i.YNc(0,Ep,2,0,"div",0),i.YNc(1,Dp,24,2,"mat-card",1)),2&t&&(i.Q6J("ngIf",e.loading),i.xp6(1),i.Q6J("ngIf",!e.loading))},directives:[r.O5,Ip.$g,d.a8,d.dk,d.n5,d.dn,s.lW,r.sg],styles:[""]}),t})()},{path:"",pathMatch:"full",redirectTo:"/admin/dashboard"}]}];let xp=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[[r.ez,o.Bz.forChild(Np),g.M,m.u5]]}),t})()}}]);